<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MDAnalysis.analysis.helanal &mdash; MDAnalysis 0.11.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.11.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within MDAnalysis 0.11.0 documentation"
          href="../../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../../_static/mdanalysis-logo.ico"/>
    <link rel="top" title="MDAnalysis 0.11.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">MDAnalysis 0.11.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/mdanalysis-logo-200x150.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for MDAnalysis.analysis.helanal</h1><div class="highlight"><pre>
<span class="c"># -*- Mode: python; tab-width: 4; indent-tabs-mode:nil; coding:utf-8 -*-</span>
<span class="c"># vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4 fileencoding=utf-8</span>
<span class="c">#</span>
<span class="c"># MDAnalysis --- http://www.MDAnalysis.org</span>
<span class="c"># Copyright (c) 2006-2015 Naveen Michaud-Agrawal, Elizabeth J. Denning, Oliver Beckstein</span>
<span class="c"># and contributors (see AUTHORS for the full list)</span>
<span class="c">#</span>
<span class="c"># Released under the GNU Public Licence, v2 or any higher version</span>
<span class="c">#</span>
<span class="c"># Please cite your use of MDAnalysis in published work:</span>
<span class="c">#</span>
<span class="c"># N. Michaud-Agrawal, E. J. Denning, T. B. Woolf, and O. Beckstein.</span>
<span class="c"># MDAnalysis: A Toolkit for the Analysis of Molecular Dynamics Simulations.</span>
<span class="c"># J. Comput. Chem. 32 (2011), 2319--2327, doi:10.1002/jcc.21787</span>
<span class="c">#</span>
<span class="c"># Python implementation of FORTRAN HELANAL</span>
<span class="c"># [Bansal et al, J Biomol Struct Dyn. 17 (2000), 811]</span>
<span class="c"># Copyright (c) 2009 Benjamin Hall &lt;benjamin.hall@bioch.ox.ac.uk&gt;</span>
<span class="c"># Published under the GNU General Public License v2 or higher</span>
<span class="c">#</span>
<span class="c"># Copyright (c) 2011 Oliver Beckstein &lt;orbeckst@gmail.com&gt;</span>
<span class="c"># Integrated into MDAnalysis and NumPy-fied</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">HELANAL --- analysis of protein helices</span>
<span class="sd">=======================================</span>

<span class="sd">:Author:  Benjamin Hall &lt;benjamin.a.hall@ucl.ac.uk&gt;, Oliver Beckstein, Xavier Deupi</span>
<span class="sd">:Year:    2009, 2011, 2013</span>
<span class="sd">:License: GNU General Public License v2 (or higher)</span>

<span class="sd">The :mod:`MDAnalysis.analysis.helanal` module is a Python implementation of the</span>
<span class="sd">HELANAL_ algorithm [Bansal2000]_ in `helanal.f`_, which is also available</span>
<span class="sd">through the `HELANAL webserver`_.</span>

<span class="sd">Please cite the paper [Bansal2000]_ (and possibly [Kumar1996]_ and</span>
<span class="sd">[Kumar1998]_) in published work when using</span>
<span class="sd">:mod:`~MDAnalysis.analysis.helanal.helanal_trajectory` or</span>
<span class="sd">:mod:`~MDAnalysis.analysis.helanal.helanal_main`.</span>

<span class="sd">HELANAL_ quantifies the geometry of helices in proteins on the basis of their CÎ±</span>
<span class="sd">atoms alone. It can extract the helices from the structure files and then</span>
<span class="sd">characterises the overall geometry of each helix as being linear, curved or</span>
<span class="sd">kinked, in terms of its local structural features, viz. local helical twist and</span>
<span class="sd">rise, virtual torsion angle, local helix origins and bending angles between</span>
<span class="sd">successive local helix axes. Even helices with large radius of curvature are</span>
<span class="sd">unambiguously identified as being linear or curved. The program can also be</span>
<span class="sd">used to differentiate a kinked helix and other motifs, such as helix-loop-helix</span>
<span class="sd">or a helix-turn-helix (with a single residue linker) with the help of local</span>
<span class="sd">bending angles. In addition to these, the program can also be used to</span>
<span class="sd">characterise the helix start and end as well as other types of secondary</span>
<span class="sd">structures.</span>

<span class="sd">.. _HELANAL: http://www.ccrnp.ncifcrf.gov/users/kumarsan/HELANAL/helanal.html</span>
<span class="sd">.. _Helanal webserver: http://nucleix.mbu.iisc.ernet.in/helanal/helanal.shtml</span>
<span class="sd">.. `helanal.f`: http://www.webcitation.org/5y1RpVJtF</span>
<span class="sd">.. _`helanal.f`: http://www.ccrnp.ncifcrf.gov/users/kumarsan/HELANAL/helanal.f</span>

<span class="sd">Background</span>
<span class="sd">----------</span>

<span class="sd">From the HELANAL_ home page:</span>

<span class="sd">HELANAL_ can be used to characterize the geometry of helices with a minimum 9</span>
<span class="sd">residues. The geometry of an alpha helix is characterized by computing local</span>
<span class="sd">helix axes and local helix origins for four contiguous C-Alpha atoms, using the</span>
<span class="sd">procedure of Sugeta and Miyazawa [Sugeta1967]_ and sliding this window over</span>
<span class="sd">the length of the helix in steps of one C-alpha atom.</span>

<span class="sd">The angles between successive local helix axes can identify *local bends* or</span>
<span class="sd">*kinks* as well as occurrence of *smooth curvature* in the helix. A matrix, whose</span>
<span class="sd">elements *M(I, J)* are the *bending angles* between local helix axes *I* and *J*,</span>
<span class="sd">is obtained to get an idea about the overall geometry of the helix.</span>

<span class="sd">*Unit twist* and *unit height* of the alpha helix are also computed to analyze the</span>
<span class="sd">uniformity of the helix. The *local helix origins* trace out the path described</span>
<span class="sd">by the helix in three dimensional space. The local helix origins are reoriented</span>
<span class="sd">in *X-Y* plane and the reoriented points are used to fit a circle as well as a</span>
<span class="sd">line, by least squares method. Based on the relative goodness of line and</span>
<span class="sd">circle fit to local helix origins, the helix is *classified as being linear or</span>
<span class="sd">curved*. A helix is classified as being *kinked*, if at least one local bending</span>
<span class="sd">angle in the middle of the helix is greater than 20 degrees.</span>


<span class="sd">References</span>
<span class="sd">----------</span>

<span class="sd">.. [Sugeta1967] Sugeta, H. and Miyazawa, T. 1967. General method for</span>
<span class="sd">   calculating helical parameters of polymer chains from bond lengths, bond</span>
<span class="sd">   angles and internal rotation angles. *Biopolymers* 5 673 - 679</span>

<span class="sd">.. [Kumar1996] Kumar, S. and Bansal, M. 1996. Structural and sequence</span>
<span class="sd">   characteristics of long alpha-helices in globular proteins. *Biophysical</span>
<span class="sd">   Journal* 71(3):1574-1586.</span>

<span class="sd">.. [Kumar1998] Kumar, S. and Bansal, M. 1998. Geometrical and sequence</span>
<span class="sd">   characteristics of alpha helices in globular proteins. *Biophysical Journal*</span>
<span class="sd">   75(4):1935-1944.</span>

<span class="sd">.. [Bansal2000] Bansal M, Kumar S, Velavan R. 2000.</span>
<span class="sd">   HELANAL - A program to characterise helix geometry in proteins.</span>
<span class="sd">   *J Biomol Struct Dyn.*  17(5):811-819.</span>

<span class="sd">Functions</span>
<span class="sd">---------</span>

<span class="sd">.. autofunction:: helanal_trajectory</span>
<span class="sd">.. autofunction:: helanal_main</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="c"># replace CartesianToolkit with NumPy</span>
<span class="c"># - vecscale(v,a) --&gt; a*c</span>
<span class="c"># - vecadd(a,b) --&gt; a+b</span>
<span class="c"># - vecsub(a,b) --&gt; a-b</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">rad2deg</span><span class="p">,</span> <span class="n">deg2rad</span>  <span class="c"># numpy 1.3+</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">rad2deg</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>  <span class="c"># no need for the numpy out=[] argument</span>
        <span class="k">return</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>

    <span class="k">def</span> <span class="nf">deg2rad</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>  <span class="c"># no need for the numpy out=[] argument</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span>

<span class="kn">import</span> <span class="nn">MDAnalysis</span>
<span class="kn">from</span> <span class="nn">MDAnalysis</span> <span class="kn">import</span> <span class="n">FinishTimeException</span>


<span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="n">coordinates</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the geometric center (centroid) of the coordinates.</span>

<span class="sd">    Coordinates must be &quot;list of cartesians&quot;, i.e. a Nx3 array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">veclength</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Length of vector *v*.&quot;&quot;&quot;</span>
    <span class="c"># note: this is 3 times faster than numpy.linalg.norm</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>


<span class="n">vecscaler</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span>


<span class="k">def</span> <span class="nf">vecnorm</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a/|a|&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">veclength</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">vecangle</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Angle between two vectors *a* and *b* in radians.</span>

<span class="sd">    If one of the lengths is 0 then the angle is returned as 0</span>
<span class="sd">    (instead of `nan`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">veclength</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">veclength</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">angle</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">angle</span>


<span class="k">def</span> <span class="nf">vecdist</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return |a-b|&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">veclength</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>


<span class="n">veccross</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cross</span>


<span class="k">def</span> <span class="nf">wrapangle</span><span class="p">(</span><span class="n">angle</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wrap angle (in radians) to be within -pi &lt; angle =&lt; pi&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">elif</span> <span class="n">angle</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">return</span> <span class="n">angle</span>


<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">mean</span>


<span class="k">def</span> <span class="nf">sample_sd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dummy</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">mean_abs_dev</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">mean_a</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mean_a</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">mean_a</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mean</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">mean_a</span><span class="p">))</span>


<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">psyco</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="helanal_trajectory"><a class="viewcode-back" href="../../../documentation_pages/analysis/helanal.html#MDAnalysis.analysis.helanal.helanal_trajectory">[docs]</a><span class="k">def</span> <span class="nf">helanal_trajectory</span><span class="p">(</span><span class="n">universe</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="s">&quot;name CA&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">begin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                       <span class="n">matrix_filename</span><span class="o">=</span><span class="s">&quot;bending_matrix.dat&quot;</span><span class="p">,</span> <span class="n">origin_pdbfile</span><span class="o">=</span><span class="s">&quot;origin.pdb&quot;</span><span class="p">,</span>
                       <span class="n">summary_filename</span><span class="o">=</span><span class="s">&quot;summary.txt&quot;</span><span class="p">,</span> <span class="n">screw_filename</span><span class="o">=</span><span class="s">&quot;screw.xvg&quot;</span><span class="p">,</span>
                       <span class="n">tilt_filename</span><span class="o">=</span><span class="s">&quot;local_tilt.xvg&quot;</span><span class="p">,</span> <span class="n">fitted_tilt_filename</span><span class="o">=</span><span class="s">&quot;fit_tilt.xvg&quot;</span><span class="p">,</span>
                       <span class="n">bend_filename</span><span class="o">=</span><span class="s">&quot;local_bend.xvg&quot;</span><span class="p">,</span> <span class="n">twist_filename</span><span class="o">=</span><span class="s">&quot;unit_twist.xvg&quot;</span><span class="p">,</span>
                       <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;helanal_&quot;</span><span class="p">,</span> <span class="n">ref_axis</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Perform HELANAL_ helix analysis on all frames in *universe*.</span>

<span class="sd">    .. Note::</span>

<span class="sd">       Only a single helix is analyzed. Use the selection to specify the</span>
<span class="sd">       helix, e.g. with &quot;name CA and resid 1:20&quot; or use start=1, stop=20.</span>

<span class="sd">    :Arguments:</span>
<span class="sd">       *universe*</span>
<span class="sd">          :class:`~MDAnalysis.core.AtomGroup.Universe`</span>

<span class="sd">    :Keywords:</span>
<span class="sd">       *selection*</span>
<span class="sd">          selection string that selects Calpha atoms [``&quot;name CA&quot;``]</span>
<span class="sd">       *start*</span>
<span class="sd">          start residue</span>
<span class="sd">       *end*</span>
<span class="sd">          end residue</span>
<span class="sd">       *begin*</span>
<span class="sd">          start analysing for time (ps) &gt;= *begin*; ``None`` starts from the</span>
<span class="sd">          beginning [``None``]</span>
<span class="sd">       *finish*</span>
<span class="sd">          stop analysis for time (ps) =&lt; *finish*; ``None`` goes to the</span>
<span class="sd">          end of the trajectory [``None``]</span>
<span class="sd">       *matrix_filename*</span>
<span class="sd">          Output file- bending matrix [``&quot;bending_matrix.dat&quot;``]</span>
<span class="sd">       *origin_pdbfile*</span>
<span class="sd">          Output file- origin pdb file [``&quot;origin.pdb&quot;``]</span>
<span class="sd">       *summary_filename*</span>
<span class="sd">          Output file- all of the basic data [``&quot;summary.txt&quot;``]</span>
<span class="sd">       *screw_filename*</span>
<span class="sd">          Output file- local tilts of individual residues from 2 to n-1</span>
<span class="sd">          [``&quot;screw.xvg&quot;``]</span>
<span class="sd">       *tilt_filename*</span>
<span class="sd">          Output file- tilt of line of best fit applied to origin axes</span>
<span class="sd">          [``&quot;local_tilt.xvg&quot;``]</span>
<span class="sd">       *bend_filename*</span>
<span class="sd">          Output file- local bend angles between successive local helix axes</span>
<span class="sd">          [``&quot;local_bend.xvg&quot;``]</span>
<span class="sd">       *twist_filename*</span>
<span class="sd">          Output file- local unit twist between successive helix turns</span>
<span class="sd">          [``&quot;unit_twist.xvg&quot;``]</span>
<span class="sd">       *prefix*</span>
<span class="sd">          Prefix to add to all output file names; set to ``None`` to disable</span>
<span class="sd">          [``&quot;helanal__&quot;``]</span>
<span class="sd">       *ref_axis*</span>
<span class="sd">          Calculate tilt angle relative to the axis; if ``None`` then ``[0,0,1]``</span>
<span class="sd">          is chosen [``None``]</span>

<span class="sd">    :Raises:</span>
<span class="sd">       FinishTimeException</span>
<span class="sd">        If the specified finish time precedes the specified start time or current time stamp of trajectory object.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ref_axis</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_axis</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># enable MDA API so that one can use a tuple of atoms or AtomGroup with</span>
        <span class="c"># two atoms</span>
        <span class="n">ref_axis</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">universe</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resid</span>
        <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">universe</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">resid</span>
        <span class="n">selection</span> <span class="o">+=</span> <span class="s">&quot; and resid </span><span class="si">%(start)d</span><span class="s">:</span><span class="si">%(end)d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">vars</span><span class="p">()</span>
    <span class="n">ca</span> <span class="o">=</span> <span class="n">universe</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
    <span class="n">trajectory</span> <span class="o">=</span> <span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span>

    <span class="k">if</span> <span class="n">finish</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">finish</span><span class="p">:</span>  <span class="c"># you&#39;d be starting with a finish time (in ps) that has already passed or not</span>
        <span class="c"># available</span>
            <span class="k">raise</span> <span class="n">FinishTimeException</span><span class="p">(</span>
                <span class="s">&#39;The input finish time ({finish} ps) precedes the current trajectory time of {traj_time} ps.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">finish</span><span class="o">=</span><span class="n">finish</span><span class="p">,</span> <span class="n">traj_time</span><span class="o">=</span><span class="n">trajectory</span><span class="o">.</span><span class="n">time</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Analysing from residue&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="s">&quot;to&quot;</span><span class="p">,</span> <span class="n">end</span>
    <span class="k">elif</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Analysing from residue&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="s">&quot;to the C termini&quot;</span>
    <span class="k">elif</span> <span class="n">start</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Analysing from the N termini to&quot;</span><span class="p">,</span> <span class="n">end</span>
    <span class="k">print</span> <span class="s">&quot;Analysing </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> residues&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ca</span><span class="o">.</span><span class="n">n_atoms</span><span class="p">,</span> <span class="n">universe</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">n_residues</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="n">matrix_filename</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">matrix_filename</span>
        <span class="n">origin_pdbfile</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">origin_pdbfile</span>
        <span class="n">summary_filename</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">summary_filename</span>
        <span class="n">screw_filename</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">screw_filename</span>
        <span class="n">tilt_filename</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">tilt_filename</span>
        <span class="n">fitted_tilt_filename</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">fitted_tilt_filename</span>
        <span class="n">bend_filename</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">bend_filename</span>
        <span class="n">twist_filename</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">twist_filename</span>
    <span class="n">backup_file</span><span class="p">(</span><span class="n">matrix_filename</span><span class="p">)</span>
    <span class="n">backup_file</span><span class="p">(</span><span class="n">origin_pdbfile</span><span class="p">)</span>
    <span class="n">backup_file</span><span class="p">(</span><span class="n">summary_filename</span><span class="p">)</span>
    <span class="n">backup_file</span><span class="p">(</span><span class="n">screw_filename</span><span class="p">)</span>
    <span class="n">backup_file</span><span class="p">(</span><span class="n">tilt_filename</span><span class="p">)</span>
    <span class="n">backup_file</span><span class="p">(</span><span class="n">fitted_tilt_filename</span><span class="p">)</span>
    <span class="n">backup_file</span><span class="p">(</span><span class="n">bend_filename</span><span class="p">)</span>
    <span class="n">backup_file</span><span class="p">(</span><span class="n">twist_filename</span><span class="p">)</span>

    <span class="n">global_height</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">global_twist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">global_rnou</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">global_bending</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">global_bending_matrix</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">global_tilt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">global_fitted_tilts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">global_screw</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">trajectory</span><span class="p">:</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">frame</span>
        <span class="k">if</span> <span class="n">begin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">begin</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">if</span> <span class="n">finish</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">finish</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">ca_positions</span> <span class="o">=</span> <span class="n">ca</span><span class="o">.</span><span class="n">coordinates</span><span class="p">()</span>
        <span class="n">twist</span><span class="p">,</span> <span class="n">bending_angles</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">rnou</span><span class="p">,</span> <span class="n">origins</span><span class="p">,</span> <span class="n">local_helix_axes</span><span class="p">,</span> <span class="n">local_screw_angles</span> <span class="o">=</span> \
            <span class="n">main_loop</span><span class="p">(</span><span class="n">ca_positions</span><span class="p">,</span> <span class="n">ref_axis</span><span class="o">=</span><span class="n">ref_axis</span><span class="p">)</span>

        <span class="n">origin_pdb</span><span class="p">(</span><span class="n">origins</span><span class="p">,</span> <span class="n">origin_pdbfile</span><span class="p">)</span>

        <span class="c">#calculate local bending matrix( it is looking at all i, j combinations)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">global_bending_matrix</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">global_bending_matrix</span> <span class="o">=</span> <span class="p">[[[]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">local_helix_axes</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">local_helix_axes</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">local_helix_axes</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">local_helix_axes</span><span class="p">)):</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="n">rad2deg</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">vecscaler</span><span class="p">(</span><span class="n">local_helix_axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">local_helix_axes</span><span class="p">[</span><span class="n">j</span><span class="p">])))</span>
                <span class="n">global_bending_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                <span class="c">#global_bending_matrix[j][i].append(angle)</span>
                <span class="c">#global_bending_matrix[i][i].append(0.)</span>

        <span class="n">fit_vector</span><span class="p">,</span> <span class="n">fit_tilt</span> <span class="o">=</span> <span class="n">vector_of_best_fit</span><span class="p">(</span><span class="n">origins</span><span class="p">)</span>
        <span class="n">global_height</span> <span class="o">+=</span> <span class="n">height</span>
        <span class="n">global_twist</span> <span class="o">+=</span> <span class="n">twist</span>
        <span class="n">global_rnou</span> <span class="o">+=</span> <span class="n">rnou</span>
        <span class="c">#global_screw.append(local_screw_angles)</span>
        <span class="n">global_fitted_tilts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">fit_tilt</span><span class="p">))</span>

        <span class="c">#print out rotations across the helix to a file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">twist_filename</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">twist_output</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">twist_output</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span>
            <span class="k">for</span> <span class="n">loc_twist</span> <span class="ow">in</span> <span class="n">twist</span><span class="p">:</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">twist_output</span><span class="p">,</span> <span class="n">loc_twist</span><span class="p">,</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">twist_output</span><span class="p">,</span> <span class="s">&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">bend_filename</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">bend_output</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">bend_output</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span>
            <span class="k">for</span> <span class="n">loc_bend</span> <span class="ow">in</span> <span class="n">bending_angles</span><span class="p">:</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">bend_output</span><span class="p">,</span> <span class="n">loc_bend</span><span class="p">,</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">bend_output</span><span class="p">,</span> <span class="s">&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">screw_filename</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rot_output</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">rot_output</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span>
            <span class="k">for</span> <span class="n">rotation</span> <span class="ow">in</span> <span class="n">local_screw_angles</span><span class="p">:</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">rot_output</span><span class="p">,</span> <span class="n">rotation</span><span class="p">,</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">rot_output</span><span class="p">,</span> <span class="s">&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tilt_filename</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tilt_output</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">tilt_output</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span>
            <span class="k">for</span> <span class="n">tilt</span> <span class="ow">in</span> <span class="n">local_helix_axes</span><span class="p">:</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">tilt_output</span><span class="p">,</span> <span class="n">rad2deg</span><span class="p">(</span><span class="n">vecangle</span><span class="p">(</span><span class="n">tilt</span><span class="p">,</span> <span class="n">ref_axis</span><span class="p">)),</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">tilt_output</span><span class="p">,</span> <span class="s">&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fitted_tilt_filename</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tilt_output</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">tilt_output</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">rad2deg</span><span class="p">(</span><span class="n">fit_tilt</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">global_bending</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">global_bending</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bending_angles</span><span class="p">]</span>
            <span class="c">#global_tilt = [ [] for item in local_helix_axes ]</span>
        <span class="k">for</span> <span class="n">store</span><span class="p">,</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">global_bending</span><span class="p">,</span> <span class="n">bending_angles</span><span class="p">):</span>
            <span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="c">#for store,tmp in zip(global_tilt,local_helix_axes): store.append(vecangle(tmp,ref_axis))</span>

        <span class="c">#simple ticker</span>
        <span class="n">formated_time</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%20.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">time</span>
        <span class="n">frame</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">formated_frame</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%10d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">frame</span>

        <span class="k">print</span> <span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">formated_time</span><span class="p">,</span> <span class="s">&#39; ps&#39;</span><span class="p">,</span> <span class="n">formated_frame</span><span class="p">,</span>

        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Complete&#39;</span>
    <span class="n">twist_mean</span><span class="p">,</span> <span class="n">twist_sd</span><span class="p">,</span> <span class="n">twist_abdev</span> <span class="o">=</span> <span class="n">stats</span><span class="p">(</span><span class="n">global_twist</span><span class="p">)</span>
    <span class="n">height_mean</span><span class="p">,</span> <span class="n">height_sd</span><span class="p">,</span> <span class="n">height_abdev</span> <span class="o">=</span> <span class="n">stats</span><span class="p">(</span><span class="n">global_height</span><span class="p">)</span>
    <span class="n">rnou_mean</span><span class="p">,</span> <span class="n">rnou_sd</span><span class="p">,</span> <span class="n">rnou_abdev</span> <span class="o">=</span> <span class="n">stats</span><span class="p">(</span><span class="n">global_rnou</span><span class="p">)</span>
    <span class="n">ftilt_mean</span><span class="p">,</span> <span class="n">ftilt_sd</span><span class="p">,</span> <span class="n">ftilt_abdev</span> <span class="o">=</span> <span class="n">stats</span><span class="p">(</span><span class="n">global_fitted_tilts</span><span class="p">)</span>

    <span class="n">bending_statistics</span> <span class="o">=</span> <span class="p">[</span><span class="n">stats</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">global_bending</span><span class="p">]</span>
    <span class="c">#tilt_statistics =    [ stats(item) for item in global_tilt]</span>

    <span class="n">bending_statistics_matrix</span> <span class="o">=</span> <span class="p">[[</span><span class="n">stats</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">global_bending_matrix</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">matrix_filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mat_output</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">mat_output</span><span class="p">,</span> <span class="s">&quot;Mean&quot;</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">bending_statistics_matrix</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                <span class="n">formatted_angle</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%6.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">mat_output</span><span class="p">,</span> <span class="n">formatted_angle</span><span class="p">,</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">mat_output</span><span class="p">,</span> <span class="s">&#39;&#39;</span>

        <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">mat_output</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">SD&quot;</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">bending_statistics_matrix</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                <span class="n">formatted_angle</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%6.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">mat_output</span><span class="p">,</span> <span class="n">formatted_angle</span><span class="p">,</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">mat_output</span><span class="p">,</span> <span class="s">&#39;&#39;</span>

        <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">mat_output</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">ABDEV&quot;</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">bending_statistics_matrix</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                <span class="n">formatted_angle</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%6.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">mat_output</span><span class="p">,</span> <span class="n">formatted_angle</span><span class="p">,</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">mat_output</span><span class="p">,</span> <span class="s">&#39;&#39;</span>

    <span class="k">print</span> <span class="s">&quot;Height:&quot;</span><span class="p">,</span> <span class="n">height_mean</span><span class="p">,</span> <span class="s">&quot;SD&quot;</span><span class="p">,</span> <span class="n">height_sd</span><span class="p">,</span> <span class="s">&quot;ABDEV&quot;</span><span class="p">,</span> <span class="n">height_abdev</span><span class="p">,</span> <span class="s">&#39;(Angstroem)&#39;</span>
    <span class="k">print</span> <span class="s">&quot;Twist:&quot;</span><span class="p">,</span> <span class="n">twist_mean</span><span class="p">,</span> <span class="s">&quot;SD&quot;</span><span class="p">,</span> <span class="n">twist_sd</span><span class="p">,</span> <span class="s">&quot;ABDEV&quot;</span><span class="p">,</span> <span class="n">twist_abdev</span>
    <span class="k">print</span> <span class="s">&quot;Residues/turn:&quot;</span><span class="p">,</span> <span class="n">rnou_mean</span><span class="p">,</span> <span class="s">&quot;SD&quot;</span><span class="p">,</span> <span class="n">rnou_sd</span><span class="p">,</span> <span class="s">&quot;ABDEV&quot;</span><span class="p">,</span> <span class="n">rnou_abdev</span>
    <span class="k">print</span> <span class="s">&quot;Fitted tilt:&quot;</span><span class="p">,</span> <span class="n">ftilt_mean</span><span class="p">,</span> <span class="s">&quot;SD&quot;</span><span class="p">,</span> <span class="n">ftilt_sd</span><span class="p">,</span> <span class="s">&quot;ABDEV&quot;</span><span class="p">,</span> <span class="n">ftilt_abdev</span>
    <span class="k">print</span> <span class="s">&quot;Local bending angles:&quot;</span>
    <span class="n">residue_statistics</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">bending_statistics</span><span class="p">)</span>
    <span class="n">measure_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Mean &quot;</span><span class="p">,</span> <span class="s">&quot;SD   &quot;</span><span class="p">,</span> <span class="s">&quot;ABDEV&quot;</span><span class="p">]</span>
    <span class="k">print</span> <span class="s">&quot;ResID&quot;</span><span class="p">,</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">residue_statistics</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%8d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">item</span>
            <span class="k">print</span> <span class="n">output</span><span class="p">,</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">residue_statistics</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%8d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">item</span>
            <span class="k">print</span> <span class="n">output</span><span class="p">,</span>
    <span class="k">print</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">measure</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">residue_statistics</span><span class="p">,</span> <span class="n">measure_names</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">name</span><span class="p">,</span>
        <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">measure</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%8.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">residue</span>
            <span class="k">print</span> <span class="n">output</span><span class="p">,</span>
        <span class="k">print</span> <span class="s">&#39;&#39;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">summary_filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">summary_output</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">summary_output</span><span class="p">,</span> <span class="s">&quot;Height:&quot;</span><span class="p">,</span> <span class="n">height_mean</span><span class="p">,</span> <span class="s">&quot;SD&quot;</span><span class="p">,</span> <span class="n">height_sd</span><span class="p">,</span> <span class="s">&quot;ABDEV&quot;</span><span class="p">,</span> <span class="n">height_abdev</span><span class="p">,</span> <span class="s">&#39;(nm)&#39;</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">summary_output</span><span class="p">,</span> <span class="s">&quot;Twist:&quot;</span><span class="p">,</span> <span class="n">twist_mean</span><span class="p">,</span> <span class="s">&quot;SD&quot;</span><span class="p">,</span> <span class="n">twist_sd</span><span class="p">,</span> <span class="s">&quot;ABDEV&quot;</span><span class="p">,</span> <span class="n">twist_abdev</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">summary_output</span><span class="p">,</span> <span class="s">&quot;Residues/turn:&quot;</span><span class="p">,</span> <span class="n">rnou_mean</span><span class="p">,</span> <span class="s">&quot;SD&quot;</span><span class="p">,</span> <span class="n">rnou_sd</span><span class="p">,</span> <span class="s">&quot;ABDEV&quot;</span><span class="p">,</span> <span class="n">rnou_abdev</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">summary_output</span><span class="p">,</span> <span class="s">&quot;Local bending angles:&quot;</span>
        <span class="n">residue_statistics</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">bending_statistics</span><span class="p">)</span>
        <span class="n">measure_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Mean &quot;</span><span class="p">,</span> <span class="s">&quot;SD   &quot;</span><span class="p">,</span> <span class="s">&quot;ABDEV&quot;</span><span class="p">]</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">summary_output</span><span class="p">,</span> <span class="s">&quot;ResID&quot;</span><span class="p">,</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">residue_statistics</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">4</span><span class="p">):</span>
                <span class="n">output</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%8d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">item</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">summary_output</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">residue_statistics</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">output</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%8d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">item</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">summary_output</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">summary_output</span><span class="p">,</span> <span class="s">&quot;&quot;</span>

        <span class="k">for</span> <span class="n">measure</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">residue_statistics</span><span class="p">,</span> <span class="n">measure_names</span><span class="p">):</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">summary_output</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
            <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">measure</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%8.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">residue</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">summary_output</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">summary_output</span><span class="p">,</span> <span class="s">&#39;&#39;</span>

</div>
<span class="k">def</span> <span class="nf">tilt_correct</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Changes an angle (in degrees) so that it is between 0Âº and 90Âº&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mf">90.</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">number</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">180.</span> <span class="o">-</span> <span class="n">number</span>


<span class="k">def</span> <span class="nf">backup_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">target_name</span> <span class="o">=</span> <span class="s">&quot;#&quot;</span> <span class="o">+</span> <span class="n">filename</span>
        <span class="n">failure</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">target_name</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">target_name</span><span class="p">)</span>
            <span class="n">failure</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
                <span class="n">alt_target_name</span> <span class="o">=</span> <span class="n">target_name</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">alt_target_name</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">alt_target_name</span><span class="p">)</span>
                    <span class="n">failure</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="n">failure</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Too many backups. Clean up and try again&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">stats</span><span class="p">(</span><span class="n">some_list</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">some_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">list_mean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">some_list</span><span class="p">)</span>
    <span class="n">list_sd</span> <span class="o">=</span> <span class="n">sample_sd</span><span class="p">(</span><span class="n">some_list</span><span class="p">,</span> <span class="n">list_mean</span><span class="p">)</span>
    <span class="n">list_abdev</span> <span class="o">=</span> <span class="n">mean_abs_dev</span><span class="p">(</span><span class="n">some_list</span><span class="p">,</span> <span class="n">list_mean</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">list_mean</span><span class="p">,</span> <span class="n">list_sd</span><span class="p">,</span> <span class="n">list_abdev</span><span class="p">]</span>


<div class="viewcode-block" id="helanal_main"><a class="viewcode-back" href="../../../documentation_pages/analysis/helanal.html#MDAnalysis.analysis.helanal.helanal_main">[docs]</a><span class="k">def</span> <span class="nf">helanal_main</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="s">&quot;name CA&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ref_axis</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">permissive</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simple HELANAL run on a single frame PDB/GRO.</span>

<span class="sd">    .. Note:: Only a single helix is analyzed. Use the selection to specify</span>
<span class="sd">              the helix, e.g. with &quot;name CA and resid 1:20&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">universe</span> <span class="o">=</span> <span class="n">MDAnalysis</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">,</span> <span class="n">permissive</span><span class="o">=</span><span class="n">permissive</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">universe</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resid</span>
        <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">universe</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">resid</span>
        <span class="n">selection</span> <span class="o">+=</span> <span class="s">&quot; and resid </span><span class="si">%(start)d</span><span class="s">:</span><span class="si">%(end)d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">vars</span><span class="p">()</span>
    <span class="n">ca</span> <span class="o">=</span> <span class="n">universe</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;Analysing </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> residues&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ca</span><span class="o">.</span><span class="n">n_atoms</span><span class="p">,</span> <span class="n">universe</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">n_residues</span><span class="p">)</span>

    <span class="n">twist</span><span class="p">,</span> <span class="n">bending_angles</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">rnou</span><span class="p">,</span> <span class="n">origins</span><span class="p">,</span> <span class="n">local_helix_axes</span><span class="p">,</span> <span class="n">local_screw_angles</span> <span class="o">=</span> \
        <span class="n">main_loop</span><span class="p">(</span><span class="n">ca</span><span class="o">.</span><span class="n">coordinates</span><span class="p">(),</span> <span class="n">ref_axis</span><span class="o">=</span><span class="n">ref_axis</span><span class="p">)</span>

    <span class="c">#TESTED- origins are correct</span>
    <span class="c">#print current_origin</span>
    <span class="c">#print origins</span>

    <span class="n">max_angle</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">bending_angles</span><span class="p">)</span>
    <span class="n">mean_angle</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">bending_angles</span><span class="p">)</span>
    <span class="c">#sd calculated using n-1 to replicate original fortran- assumes a limited sample so uses the sample standard</span>
    <span class="c"># deviation</span>
    <span class="n">sd_angle</span> <span class="o">=</span> <span class="n">sample_sd</span><span class="p">(</span><span class="n">bending_angles</span><span class="p">,</span> <span class="n">mean_angle</span><span class="p">)</span>
    <span class="n">mean_absolute_deviation_angle</span> <span class="o">=</span> <span class="n">mean_abs_dev</span><span class="p">(</span><span class="n">bending_angles</span><span class="p">,</span> <span class="n">mean_angle</span><span class="p">)</span>
    <span class="c">#TESTED- stats correct</span>
    <span class="c">#print max_angle, mean_angle, sd_angle, mean_absolute_deviation_angle</span>

    <span class="c">#calculate local bending matrix(now it is looking at all i, j combinations)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">local_helix_axes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">local_helix_axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="n">rad2deg</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">vecscaler</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)))</span>
            <span class="n">string_angle</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%6.0f</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">angle</span>
            <span class="c">#print string_angle,</span>
            <span class="c">#print &#39;&#39;</span>
            <span class="c">#TESTED- local bending matrix!</span>

    <span class="c">#Average helical parameters</span>
    <span class="n">mean_twist</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">twist</span><span class="p">)</span>
    <span class="n">sd_twist</span> <span class="o">=</span> <span class="n">sample_sd</span><span class="p">(</span><span class="n">twist</span><span class="p">,</span> <span class="n">mean_twist</span><span class="p">)</span>
    <span class="n">abdev_twist</span> <span class="o">=</span> <span class="n">mean_abs_dev</span><span class="p">(</span><span class="n">twist</span><span class="p">,</span> <span class="n">mean_twist</span><span class="p">)</span>
    <span class="c">#TESTED-average twists</span>
    <span class="c">#print mean_twist, sd_twist, abdev_twist</span>
    <span class="n">mean_rnou</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">rnou</span><span class="p">)</span>
    <span class="n">sd_rnou</span> <span class="o">=</span> <span class="n">sample_sd</span><span class="p">(</span><span class="n">rnou</span><span class="p">,</span> <span class="n">mean_rnou</span><span class="p">)</span>
    <span class="n">abdev_rnou</span> <span class="o">=</span> <span class="n">mean_abs_dev</span><span class="p">(</span><span class="n">rnou</span><span class="p">,</span> <span class="n">mean_rnou</span><span class="p">)</span>
    <span class="c">#TESTED-average residues per turn</span>
    <span class="c">#print mean_rnou, sd_rnou, abdev_rnou</span>
    <span class="n">mean_height</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">height</span><span class="p">)</span>
    <span class="n">sd_height</span> <span class="o">=</span> <span class="n">sample_sd</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">mean_height</span><span class="p">)</span>
    <span class="n">abdev_height</span> <span class="o">=</span> <span class="n">mean_abs_dev</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">mean_height</span><span class="p">)</span>
    <span class="c">#TESTED- average rises</span>

    <span class="k">print</span> <span class="s">&quot;Height:&quot;</span><span class="p">,</span> <span class="n">mean_height</span><span class="p">,</span> <span class="n">sd_height</span><span class="p">,</span> <span class="n">abdev_height</span>
    <span class="k">print</span> <span class="s">&quot;Twist:&quot;</span><span class="p">,</span> <span class="n">mean_twist</span><span class="p">,</span> <span class="n">sd_twist</span><span class="p">,</span> <span class="n">abdev_twist</span>
    <span class="k">print</span> <span class="s">&quot;Residues/turn:&quot;</span><span class="p">,</span> <span class="n">mean_rnou</span><span class="p">,</span> <span class="n">sd_rnou</span><span class="p">,</span> <span class="n">abdev_rnou</span>
    <span class="c">#print mean_height, sd_height, abdev_height</span>
    <span class="k">print</span> <span class="s">&quot;Local bending angles:&quot;</span>
    <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">bending_angles</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%8.1f</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">angle</span>
        <span class="k">print</span> <span class="n">output</span><span class="p">,</span>
    <span class="k">print</span> <span class="s">&#39;&#39;</span>
    <span class="k">print</span> <span class="s">&quot;Unit twist angles:&quot;</span>
    <span class="k">for</span> <span class="n">twist_ang</span> <span class="ow">in</span> <span class="n">twist</span><span class="p">:</span>
        <span class="n">outputtwist</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%8.1f</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">twist_ang</span>
        <span class="k">print</span> <span class="n">outputtwist</span><span class="p">,</span>
    <span class="k">print</span> <span class="s">&#39;&#39;</span>

    <span class="c">#calculate best fit vector and tilt of said vector</span>
    <span class="n">fit_vector</span><span class="p">,</span> <span class="n">fit_tilt</span> <span class="o">=</span> <span class="n">vector_of_best_fit</span><span class="p">(</span><span class="n">origins</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;Best fit tilt =&quot;</span><span class="p">,</span> <span class="n">fit_tilt</span>
    <span class="k">print</span> <span class="s">&quot;Rotation Angles from 1 to n-1&quot;</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">local_screw_angles</span><span class="p">:</span>
        <span class="k">print</span> <span class="nb">round</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>

</div>
<span class="k">def</span> <span class="nf">origin_pdb</span><span class="p">(</span><span class="n">origins</span><span class="p">,</span> <span class="n">pdbfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write origins to PDB (multi-frame).</span>

<span class="sd">    This PDB can be loaded together with the trajectory into, e.g. VMD_, to</span>
<span class="sd">    view the helix axis together with all the atoms.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="n">origins</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s">&quot;ATOM    </span><span class="si">%3d</span><span class="s">  CA  ALA   </span><span class="si">%3d</span><span class="s">    </span><span class="si">%8.3f%8.3f%8.3f</span><span class="s">  1.00  0.00&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">output</span><span class="p">,</span> <span class="n">tmp</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">output</span><span class="p">,</span> <span class="s">&quot;TER</span><span class="se">\n</span><span class="s">ENDMDL&quot;</span>


<span class="k">def</span> <span class="nf">main_loop</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">ref_axis</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c"># rewrite in cython?</span>

    <span class="k">if</span> <span class="n">ref_axis</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_axis</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ref_axis</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">)</span>
    <span class="n">twist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rnou</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">height</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">origins</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]]</span>
    <span class="n">local_helix_axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">location_rotation_vectors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">vec12</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">vec23</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">vec34</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>

        <span class="n">dv13</span> <span class="o">=</span> <span class="n">vec12</span> <span class="o">-</span> <span class="n">vec23</span>
        <span class="n">dv24</span> <span class="o">=</span> <span class="n">vec23</span> <span class="o">-</span> <span class="n">vec34</span>

        <span class="c">#direction of the local helix axis</span>
        <span class="n">current_uloc</span> <span class="o">=</span> <span class="n">vecnorm</span><span class="p">(</span><span class="n">veccross</span><span class="p">(</span><span class="n">dv13</span><span class="p">,</span> <span class="n">dv24</span><span class="p">))</span>
        <span class="n">local_helix_axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_uloc</span><span class="p">)</span>

        <span class="c">#TESTED- Axes correct</span>
        <span class="c">#print current_uloc</span>

        <span class="n">dmag</span> <span class="o">=</span> <span class="n">veclength</span><span class="p">(</span><span class="n">dv13</span><span class="p">)</span>
        <span class="n">emag</span> <span class="o">=</span> <span class="n">veclength</span><span class="p">(</span><span class="n">dv24</span><span class="p">)</span>

        <span class="n">costheta</span> <span class="o">=</span> <span class="n">vecscaler</span><span class="p">(</span><span class="n">dv13</span><span class="p">,</span> <span class="n">dv24</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">dmag</span> <span class="o">*</span> <span class="n">emag</span><span class="p">)</span>
        <span class="c">#rnou is the number of residues per turn</span>
        <span class="n">current_twist</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">costheta</span><span class="p">)</span>
        <span class="n">twist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">current_twist</span><span class="p">))</span>
        <span class="n">rnou</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">current_twist</span><span class="p">)</span>
        <span class="c">#radius of local helix cylinder radmag</span>

        <span class="n">costheta1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">costheta</span>
        <span class="n">radmag</span> <span class="o">=</span> <span class="p">(</span><span class="n">dmag</span> <span class="o">*</span> <span class="n">emag</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">costheta1</span><span class="p">)</span>

        <span class="c">#Height of local helix cylinder</span>
        <span class="n">current_height</span> <span class="o">=</span> <span class="n">vecscaler</span><span class="p">(</span><span class="n">vec23</span><span class="p">,</span> <span class="n">current_uloc</span><span class="p">)</span>
        <span class="n">height</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_height</span><span class="p">)</span>
        <span class="c">#TESTED- Twists etc correct</span>
        <span class="c">#print current_twist*180/numpy.pi, 2*numpy.pi/current_twist, height</span>

        <span class="n">dv13</span> <span class="o">=</span> <span class="n">vecnorm</span><span class="p">(</span><span class="n">dv13</span><span class="p">)</span>
        <span class="n">dv24</span> <span class="o">=</span> <span class="n">vecnorm</span><span class="p">(</span><span class="n">dv24</span><span class="p">)</span>

        <span class="c">#record local rotation</span>
        <span class="n">location_rotation_vectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dv13</span><span class="p">)</span>

        <span class="n">rad</span> <span class="o">=</span> <span class="p">[</span><span class="n">radmag</span> <span class="o">*</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dv13</span><span class="p">]</span>
        <span class="n">current_origin</span> <span class="o">=</span> <span class="p">[(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rad</span><span class="p">)]</span>
        <span class="n">origins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_origin</span>

        <span class="c">#TESTED- origins are correct</span>
        <span class="c">#print current_origin</span>

        <span class="n">rad</span> <span class="o">=</span> <span class="p">[</span><span class="n">radmag</span> <span class="o">*</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dv24</span><span class="p">]</span>
        <span class="n">current_origin</span> <span class="o">=</span> <span class="p">[(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span> <span class="n">rad</span><span class="p">)]</span>
        <span class="n">origins</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_origin</span>
    <span class="c">#Record final rotation vector</span>
    <span class="n">location_rotation_vectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dv24</span><span class="p">)</span>

    <span class="c">#local bending angles (eg i &gt; i+3, i+3 &gt; i+6)</span>

    <span class="n">bending_angles</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">local_helix_axes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">local_helix_axes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">vecscaler</span><span class="p">(</span><span class="n">local_helix_axes</span><span class="p">[</span><span class="n">axis</span><span class="p">],</span> <span class="n">local_helix_axes</span><span class="p">[</span><span class="n">axis</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]))</span>
        <span class="n">bending_angles</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">rad2deg</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="c">#TESTED- angles are correct</span>
        <span class="c">#print rad2deg(angle)</span>

    <span class="n">local_screw_angles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c">#Calculate rotation angles for (+1) to (n-1)</span>
    <span class="n">fit_vector</span><span class="p">,</span> <span class="n">fit_tilt</span> <span class="o">=</span> <span class="n">vector_of_best_fit</span><span class="p">(</span><span class="n">origins</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">location_rotation_vectors</span><span class="p">:</span>
        <span class="n">local_screw_tmp</span> <span class="o">=</span> <span class="n">rad2deg</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">(</span><span class="n">fit_vector</span><span class="p">,</span> <span class="n">ref_axis</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
        <span class="c">#print local_screw_tmp</span>
        <span class="n">local_screw_angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_screw_tmp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">twist</span><span class="p">,</span> <span class="n">bending_angles</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">rnou</span><span class="p">,</span> <span class="n">origins</span><span class="p">,</span> <span class="n">local_helix_axes</span><span class="p">,</span> <span class="n">local_screw_angles</span>


<span class="k">def</span> <span class="nf">rotation_angle</span><span class="p">(</span><span class="n">helix_vector</span><span class="p">,</span> <span class="n">axis_vector</span><span class="p">,</span> <span class="n">rotation_vector</span><span class="p">):</span>
    <span class="n">reference_vector</span> <span class="o">=</span> <span class="n">veccross</span><span class="p">(</span><span class="n">veccross</span><span class="p">(</span><span class="n">helix_vector</span><span class="p">,</span> <span class="n">axis_vector</span><span class="p">),</span> <span class="n">helix_vector</span><span class="p">)</span>
    <span class="n">second_reference_vector</span> <span class="o">=</span> <span class="n">veccross</span><span class="p">(</span><span class="n">axis_vector</span><span class="p">,</span> <span class="n">helix_vector</span><span class="p">)</span>
    <span class="n">screw_angle</span> <span class="o">=</span> <span class="n">vecangle</span><span class="p">(</span><span class="n">reference_vector</span><span class="p">,</span> <span class="n">rotation_vector</span><span class="p">)</span>
    <span class="n">alt_screw_angle</span> <span class="o">=</span> <span class="n">vecangle</span><span class="p">(</span><span class="n">second_reference_vector</span><span class="p">,</span> <span class="n">rotation_vector</span><span class="p">)</span>
    <span class="n">updown</span> <span class="o">=</span> <span class="n">veccross</span><span class="p">(</span><span class="n">reference_vector</span><span class="p">,</span> <span class="n">rotation_vector</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">screw_angle</span> <span class="o">&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">screw_angle</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">screw_angle</span> <span class="o">&lt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">alt_screw_angle</span> <span class="o">&lt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">screw_angle</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">alt_screw_angle</span>
        <span class="k">elif</span> <span class="n">screw_angle</span> <span class="o">&lt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">alt_screw_angle</span> <span class="o">&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">screw_angle</span> <span class="o">=</span> <span class="n">alt_screw_angle</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">screw_angle</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">alt_screw_angle</span> <span class="o">&lt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">screw_angle</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">alt_screw_angle</span>
        <span class="k">elif</span> <span class="n">screw_angle</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">alt_screw_angle</span> <span class="o">&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">screw_angle</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">alt_screw_angle</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Big Screw Up&quot;</span>

    <span class="k">if</span> <span class="n">veclength</span><span class="p">(</span><span class="n">updown</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c">#vector is at 0 or 180</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">PROBLEM (vector is at 0 or 180)&quot;</span>

    <span class="n">helix_dot_rehelix</span> <span class="o">=</span> <span class="n">vecangle</span><span class="p">(</span><span class="n">updown</span><span class="p">,</span> <span class="n">helix_vector</span><span class="p">)</span>

    <span class="c">#if ( helix_dot_rehelix &lt; numpy.pi/2 and helix_dot_rehelix &gt;= 0 )or helix_dot_rehelix &lt;-numpy.pi/2:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="n">helix_dot_rehelix</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">helix_dot_rehelix</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">screw_angle</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">screw_angle</span>
        <span class="c">#print &quot;Same     &quot;, helix_dot_rehelix*180/numpy.pi</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#print &quot;Different&quot;, helix_dot_rehelix*180/numpy.pi</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">screw_angle</span>


<span class="k">def</span> <span class="nf">vector_of_best_fit</span><span class="p">(</span><span class="n">origins</span><span class="p">):</span>
    <span class="n">origins</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">origins</span><span class="p">)</span>
    <span class="n">centroids</span> <span class="o">=</span> <span class="n">center</span><span class="p">(</span><span class="n">origins</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">origins</span> <span class="o">-</span> <span class="n">centroids</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">*</span> <span class="n">M</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">vh</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">vector</span> <span class="o">=</span> <span class="n">vh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c">#Correct vector to face towards first residues</span>
    <span class="n">rough_helix</span> <span class="o">=</span> <span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">centroids</span>
    <span class="n">agreement</span> <span class="o">=</span> <span class="n">vecangle</span><span class="p">(</span><span class="n">rough_helix</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">agreement</span> <span class="o">&lt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">agreement</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vector</span> <span class="o">=</span> <span class="n">vh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">vector</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">best_fit_tilt</span> <span class="o">=</span> <span class="n">vecangle</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">vector</span><span class="p">,</span> <span class="n">best_fit_tilt</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">MDAnalysis 0.11.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2005-2015, Naveen Michaud-Agrawal, Elizabeth J. Denning, Joshua Adelman,
    Christian Beckstein (logo), Alejandro Bernardin, SÃ©bastien Buchoux,
    David Caplan, Matthieu Chavent, Xavier Deupi, Jan DomaÅski, David L. Dotson
    Lennard van der Feltz, Philip Fowler, Joseph Goose, Richard J. Gowers, Lukas Grossar,
    Benjamin Hall, Joe Jordan, Jinju Lu, Robert McGibbon, Alex Nesterenko,
    Manuel Nuno Melo, Caio S. Souza, Danny Parton, Joshua L. Phillips, Tyler Reddy,
    Paul Rigor, Sean L. Seyler, Andy Somogyi, Lukas Stelzl, Gorman Stock, Isaac Virshup,
    Zhuyi Xue, Carlos YÃ¡Ã±ez S.,
    and Oliver Beckstein.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>