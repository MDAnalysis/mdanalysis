


  
    
  




<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css" integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="shortcut icon" href="../../../../_static/logo/mda_favicon.ico">
</head>

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MDAnalysis.analysis.hole2.utils &mdash; MDAnalysis 2.7.0-dev0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/site.css" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=542471e5"></script>
        <script src="../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../_static/js/versions.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within MDAnalysis 2.7.0-dev0 documentation"
          href="../../../../_static/opensearch.xml"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >




  




<a href="../../../../index.html">
  
    <img src="../../../../_static/logo/mda_logo.png" class="logo" alt="Logo"/>
</a>


  
  
  
    <div class="version">
      2.7.0-dev0
    </div>
  



<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div>
<div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
    <!-- <p class="caption" role="heading"></p> -->
    <ul>
        
        <li class="toctree-l1"><a class="reference internal" href="http://mdanalysis.org">MDAnalysis</a></li>
        
        <li class="toctree-l1"><a class="reference internal" href="http://userguide.mdanalysis.org">User guide</a></li>
        
        <li class="toctree-l1"><a class="reference internal" href="https://mdakits.mdanalysis.org/">MDAKits</a></li>
        
    </ul>
    
        <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/overview.html">1. Overview over MDAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/topology.html">2. The topology system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/selections.html">3. Selection commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/analysis_modules.html">4. Analysis modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/topology_modules.html">5. Topology modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/coordinates_modules.html">6. Coordinates modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/converters.html">7. Converter modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/trajectory_transformations.html">8. Trajectory transformations (“on-the-fly” transformations)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/selections_modules.html">9. Selection exporters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/auxiliary_modules.html">10. Auxiliary modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/core_modules.html">11. Core modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/visualization_modules.html">12. Visualization modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/lib_modules.html">13. Library functions — <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.lib</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/version.html">14. Version information for MDAnalysis - <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.version</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/units.html">15. Constants and unit conversion — <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.units</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/exceptions.html">16. Custom exceptions and warnings — <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.exceptions</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/references.html">17. References</a></li>
</ul>

</div>

      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">MDAnalysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">MDAnalysis.analysis.hole2.utils</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for MDAnalysis.analysis.hole2.utils</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- Mode: python; tab-width: 4; indent-tabs-mode:nil; coding:utf-8 -*-</span>
<span class="c1"># vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4</span>
<span class="c1">#</span>
<span class="c1"># MDAnalysis --- https://www.mdanalysis.org</span>
<span class="c1"># Copyright (c) 2006-2020 The MDAnalysis Development Team and contributors</span>
<span class="c1"># (see the file AUTHORS for the full list of names)</span>
<span class="c1">#</span>
<span class="c1"># Released under the GNU Public Licence, v2 or any higher version</span>
<span class="c1">#</span>
<span class="c1"># Please cite your use of MDAnalysis in published work:</span>
<span class="c1">#</span>
<span class="c1"># R. J. Gowers, M. Linke, J. Barnoud, T. J. E. Reddy, M. N. Melo, S. L. Seyler,</span>
<span class="c1"># D. L. Dotson, J. Domanski, S. Buchoux, I. M. Kenney, and O. Beckstein.</span>
<span class="c1"># MDAnalysis: A Python package for the rapid analysis of molecular dynamics</span>
<span class="c1"># simulations. In S. Benthall and S. Rostrup editors, Proceedings of the 15th</span>
<span class="c1"># Python in Science Conference, pages 102-109, Austin, TX, 2016. SciPy.</span>
<span class="c1"># doi: 10.25080/majora-629e541a-00e</span>
<span class="c1">#</span>
<span class="c1"># N. Michaud-Agrawal, E. J. Denning, T. B. Woolf, and O. Beckstein.</span>
<span class="c1"># MDAnalysis: A Toolkit for the Analysis of Molecular Dynamics Simulations.</span>
<span class="c1"># J. Comput. Chem. 32 (2011), 2319--2327, doi:10.1002/jcc.21787</span>
<span class="c1">#</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">HOLE Analysis --- :mod:`MDAnalysis.analysis.hole2.helper`</span>
<span class="sd">=========================================================</span>

<span class="sd">:Author: Lily Wang</span>
<span class="sd">:Year: 2020</span>
<span class="sd">:Copyright: GNU Public License v3</span>

<span class="sd">.. versionadded:: 1.0</span>

<span class="sd">Helper functions used in :mod:`MDAnalysis.analysis.hole2.hole`</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">errno</span>

<span class="kn">from</span> <span class="nn">...lib</span> <span class="kn">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">...exceptions</span> <span class="kn">import</span> <span class="n">ApplicationError</span>
<span class="kn">from</span> <span class="nn">.templates</span> <span class="kn">import</span> <span class="p">(</span><span class="n">SIMPLE2_RAD</span><span class="p">,</span> <span class="n">IGNORE_RESIDUES</span><span class="p">,</span> <span class="n">hole_input</span><span class="p">,</span>
                        <span class="n">hole_lines</span><span class="p">,</span> <span class="n">exe_err</span><span class="p">)</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="write_simplerad2">
<a class="viewcode-back" href="../../../../documentation_pages/analysis/hole2.html#MDAnalysis.analysis.hole2.utils.write_simplerad2">[docs]</a>
<span class="k">def</span> <span class="nf">write_simplerad2</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;simple2.rad&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write the built-in radii in :data:`SIMPLE2_RAD` to `filename`.</span>

<span class="sd">    Does nothing if `filename` already exists.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str, optional</span>
<span class="sd">       output file name; the default is &quot;simple2.rad&quot;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    filename : str</span>
<span class="sd">       returns the name of the data file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rad</span><span class="p">:</span>
            <span class="n">rad</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SIMPLE2_RAD</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Created simple radii file </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">filename</span></div>



<div class="viewcode-block" id="check_and_fix_long_filename">
<a class="viewcode-back" href="../../../../documentation_pages/analysis/hole2.html#MDAnalysis.analysis.hole2.utils.check_and_fix_long_filename">[docs]</a>
<span class="k">def</span> <span class="nf">check_and_fix_long_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tmpdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span>
                                <span class="n">max_length</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span>
                                <span class="n">make_symlink</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a file name suitable for HOLE.</span>

<span class="sd">    HOLE is limited to filenames &lt;= ``max_length``. This method</span>

<span class="sd">    1. returns `filename` if HOLE can process it</span>
<span class="sd">    2. returns a relative path (see :func:`os.path.relpath`) if that shortens the</span>
<span class="sd">        path sufficiently</span>
<span class="sd">    3. creates a symlink to `filename` (:func:`os.symlink`) in a safe temporary</span>
<span class="sd">        directory and returns the path of the symlink.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        file name to be processed</span>
<span class="sd">    tmpdir : str, optional</span>
<span class="sd">        By default the temporary directory is created inside the current</span>
<span class="sd">        directory in order to keep that path name short. This can be changed</span>
<span class="sd">        with the `tmpdir` keyword (e.g. one can use &quot;/tmp&quot;). The default is</span>
<span class="sd">        the current directory :data:`os.path.curdir`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        path to the file that has a length less than</span>
<span class="sd">        ``max_length``</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    RuntimeError</span>
<span class="sd">        If none of the tricks for filename shortening worked. In this case,</span>
<span class="sd">        manually rename the file or recompile your version of HOLE.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_length</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">filename</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;HOLE will not read </span><span class="si">{}</span><span class="s1"> &#39;</span>
           <span class="s1">&#39;because it has more than </span><span class="si">{}</span><span class="s1"> characters.&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">max_length</span><span class="p">))</span>

    <span class="c1"># try a relative path</span>
    <span class="n">new_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_length</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Using relative path: </span><span class="si">{}</span><span class="s1"> -&gt; </span><span class="si">{}</span><span class="s1">&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">new_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">new_name</span>

    <span class="k">if</span> <span class="n">make_symlink</span><span class="p">:</span>
        <span class="c1"># shorten path by creating a symlink inside a safe temp dir</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">))</span>
        <span class="n">newname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_length</span><span class="p">:</span>
            <span class="n">fd</span><span class="p">,</span> <span class="n">newname</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">dirname</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_length</span><span class="p">:</span>
            <span class="n">newname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_length</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Using symlink: </span><span class="si">{}</span><span class="s1"> -&gt; </span><span class="si">{}</span><span class="s1">&#39;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">newname</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">newname</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Failed to shorten filename </span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span></div>



<span class="k">def</span> <span class="nf">set_up_hole_input</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">,</span>
                      <span class="n">infile_text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">infile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">sphpdb_file</span><span class="o">=</span><span class="s1">&#39;hole.sph&#39;</span><span class="p">,</span>
                      <span class="n">vdwradii_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">tmpdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span>
                      <span class="n">sample</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                      <span class="n">end_radius</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span>
                      <span class="n">cpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">cvect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">ignore_residues</span><span class="o">=</span><span class="n">IGNORE_RESIDUES</span><span class="p">,</span>
                      <span class="n">output_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">dcd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">dcd_iniskip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">dcd_step</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate HOLE input for the parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pdbfile : str</span>
<span class="sd">        The `filename` is used as input for HOLE in the &quot;COORD&quot; card of the</span>
<span class="sd">        input file.  It specifies the name of a PDB coordinate file to be</span>
<span class="sd">        used. This must be in Brookhaven protein databank format or</span>
<span class="sd">        something closely approximating this. Both ATOM and HETATM records</span>
<span class="sd">        are read.</span>

<span class="sd">    infile_text: str, optional</span>
<span class="sd">        HOLE input text or template. If set to ``None``, the function will</span>
<span class="sd">        create the input text from the other parameters.</span>
<span class="sd">        Default: ``None``</span>

<span class="sd">    infile: str, optional</span>
<span class="sd">        File to write the HOLE input text for later inspection. If set to</span>
<span class="sd">        ``None``, the input text is not written out.</span>
<span class="sd">        Default: ``None``</span>

<span class="sd">    sphpdb_file : str, optional</span>
<span class="sd">        path to the HOLE sph file, a PDB-like file containing the</span>
<span class="sd">        coordinates of the pore centers.</span>
<span class="sd">        The coordinates are set to the sphere centres and the occupancies</span>
<span class="sd">        are the sphere radii. All centres are assigned the atom name QSS and</span>
<span class="sd">        residue name SPH and the residue number is set to the storage</span>
<span class="sd">        number of the centre. In VMD, sph</span>
<span class="sd">        objects are best displayed as &quot;Points&quot;. Displaying .sph objects</span>
<span class="sd">        rather than rendered or dot surfaces can be useful to analyze the</span>
<span class="sd">        distance of particular atoms from the sphere-centre line.</span>
<span class="sd">        .sph files can be used to produce molecular graphical</span>
<span class="sd">        output from a hole run, by using the</span>
<span class="sd">        :program:`sph_process` program to read the .sph file.</span>
<span class="sd">        Default: &#39;hole.sph&#39;</span>

<span class="sd">    vdwradii_file: str, optional</span>
<span class="sd">        path to the file specifying van der Waals radii for each atom. If</span>
<span class="sd">        set to ``None``, then a set of default radii,</span>
<span class="sd">        :data:`SIMPLE2_RAD`, is used (an extension of ``simple.rad`` from</span>
<span class="sd">        the HOLE distribution). Default: ``None``</span>

<span class="sd">    tmpdir: str, optional</span>
<span class="sd">        The temporary directory that files can be symlinked to, to shorten</span>
<span class="sd">        the path name. HOLE can only read filenames up to a certain length.</span>
<span class="sd">        Default: current working directory</span>

<span class="sd">    sample : float, optional</span>
<span class="sd">        distance of sample points in Å.</span>
<span class="sd">        Specifies the distance between the planes used in the HOLE</span>
<span class="sd">        procedure. The default value should be reasonable for most</span>
<span class="sd">        purposes. However, if you wish to visualize a very tight</span>
<span class="sd">        constriction then specify a smaller value.</span>
<span class="sd">        This value determines how many points in the pore profile are</span>
<span class="sd">        calculated. Default: 0.2</span>

<span class="sd">    end_radius : float, optional</span>
<span class="sd">        Radius in Å, which is considered to be the end of the pore. This</span>
<span class="sd">        keyword can be used to specify the radius above which the</span>
<span class="sd">        program regards a result as indicating that the end of the pore</span>
<span class="sd">        has been reached. This may need to be increased for large channels,</span>
<span class="sd">        or reduced for small channels. Default: 22.0</span>

<span class="sd">    cpoint : array_like, &#39;center_of_geometry&#39; or None, optional</span>
<span class="sd">        coordinates of a point inside the pore, e.g. ``[12.3, 0.7,</span>
<span class="sd">        18.55]``. If set to ``None`` (the default) then HOLE&#39;s own search</span>
<span class="sd">        algorithm is used.</span>
<span class="sd">        ``cpoint`` specifies a point which lies within the channel. For</span>
<span class="sd">        simple channels (e.g. gramicidin), results do not show great</span>
<span class="sd">        sensitivity to the exact point taken. An easy way to produce an</span>
<span class="sd">        initial point is to use molecular graphics to find two atoms which</span>
<span class="sd">        lie either side of the pore and to average their coordinates. Or</span>
<span class="sd">        if the channel structure contains water molecules or counter ions</span>
<span class="sd">        then take the coordinates of one of these (and use the</span>
<span class="sd">        `ignore_residues` keyword to ignore them in the pore radius</span>
<span class="sd">        calculation).</span>
<span class="sd">        If this card is not specified, then HOLE (from version 2.2)</span>
<span class="sd">        attempts to guess where the channel will be. The procedure</span>
<span class="sd">        assumes the channel is reasonably symmetric. The initial guess on</span>
<span class="sd">        cpoint will be the centroid of all alpha carbon atoms (name &#39;CA&#39;</span>
<span class="sd">        in pdb file). This is then refined by a crude grid search up to 5</span>
<span class="sd">        Å from the original position. This procedure works most of the</span>
<span class="sd">        time but is far from infallible — results should be</span>
<span class="sd">        carefully checked (with molecular graphics) if it is used.</span>
<span class="sd">        Default: None</span>

<span class="sd">    cvect : array_like, optional</span>
<span class="sd">        Search direction, should be parallel to the pore axis,</span>
<span class="sd">        e.g. ``[0,0,1]`` for the z-axis.</span>
<span class="sd">        If this keyword is ``None`` (the default), then HOLE attempts to guess</span>
<span class="sd">        where the channel will be. The procedure assumes that the channel is</span>
<span class="sd">        reasonably symmetric. The guess will be either along the X axis</span>
<span class="sd">        (1,0,0), Y axis (0,1,0) or Z axis (0,0,1). If the structure is not</span>
<span class="sd">        aligned on one of these axis the results will clearly be</span>
<span class="sd">        approximate. If a guess is used then results should be carefully</span>
<span class="sd">        checked. Default: None</span>

<span class="sd">    random_seed : int, optional</span>
<span class="sd">        integer number to start the random number generator.</span>
<span class="sd">        By default,</span>
<span class="sd">        :program:`hole` will use the time of the day.</span>
<span class="sd">        For reproducible runs (e.g., for testing) set ``random_seed``</span>
<span class="sd">        to an integer. Default: ``None``</span>

<span class="sd">    ignore_residues : array_like, optional</span>
<span class="sd">        sequence of three-letter residues that are not taken into</span>
<span class="sd">        account during the calculation; wildcards are *not*</span>
<span class="sd">        supported. Note that all residues must have 3 letters. Pad</span>
<span class="sd">        with space on the right-hand side if necessary.</span>
<span class="sd">        Default: {}.</span>

<span class="sd">    output_level : int, optional</span>
<span class="sd">        Determines the output of output in the ``outfile``.</span>
<span class="sd">        For automated processing, this must be &lt; 3.</span>
<span class="sd">        0: Full text output,</span>
<span class="sd">        1: All text output given except &quot;run in progress&quot; (i.e.,</span>
<span class="sd">        detailed contemporary description of what HOLE is doing).</span>
<span class="sd">        2: Ditto plus no graph type output - only leaving minimum</span>
<span class="sd">        radius and conductance calculations.</span>
<span class="sd">        3: All text output other than input card mirroring and error messages</span>
<span class="sd">        turned off.</span>
<span class="sd">        Default: 0</span>

<span class="sd">    dcd : str, optional</span>
<span class="sd">        File name of DCD trajectory (must be supplied together with a</span>
<span class="sd">        matching PDB file `filename`) and then HOLE runs its analysis on</span>
<span class="sd">        each frame.</span>
<span class="sd">        It does multiple HOLE runs on positions taken from a CHARMM binary</span>
<span class="sd">        dynamics format DCD trajectory file. The ``dcd`` file must have</span>
<span class="sd">        exactly the same number of atoms in exactly the same order as the</span>
<span class="sd">        pdb file specified by ``pdbfile``. Note that if this option is used</span>
<span class="sd">        the pdb file is used as a template only - the coordinates are</span>
<span class="sd">        ignored. Note that structural parameters determined for each</span>
<span class="sd">        individual structure are written in a tagged format so that it is</span>
<span class="sd">        possible to extract the information from the text output file using</span>
<span class="sd">        a :program:`grep` command. The reading of the file can be</span>
<span class="sd">        controlled by the ``dcd_step`` keyword and/or setting</span>
<span class="sd">        ``dcd_iniskip`` to the number of frames to be skipped</span>
<span class="sd">        initially.</span>

<span class="sd">    dcd_step : int, optional</span>
<span class="sd">        step size for going through the trajectory (skips ``dcd_step-1``</span>
<span class="sd">        frames). Default: 1</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        input text to run HOLE</span>


<span class="sd">    .. versionadded:: 1.0</span>

<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">IGNORE_RESIDUES</span><span class="p">)</span>

    <span class="n">short_filename</span> <span class="o">=</span> <span class="n">check_and_fix_long_filename</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">,</span> <span class="n">tmpdir</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vdwradii_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vdwradii_file</span> <span class="o">=</span> <span class="n">check_and_fix_long_filename</span><span class="p">(</span><span class="n">vdwradii_file</span><span class="p">,</span>
                                                    <span class="n">tmpdir</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vdwradii_file</span> <span class="o">=</span> <span class="n">write_simplerad2</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">dcd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dcd</span> <span class="o">=</span> <span class="n">check_and_fix_long_filename</span><span class="p">(</span><span class="n">dcd</span><span class="p">,</span> <span class="n">tmpdir</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">infile_text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">infile_text</span> <span class="o">=</span> <span class="n">hole_input</span>

    <span class="n">residues</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ignore_residues</span><span class="p">)</span>

    <span class="n">infile_text</span> <span class="o">=</span> <span class="n">infile_text</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">pdbfile</span><span class="p">,</span>
                                     <span class="n">coordinates</span><span class="o">=</span><span class="n">short_filename</span><span class="p">,</span>
                                     <span class="n">radius</span><span class="o">=</span><span class="n">vdwradii_file</span><span class="p">,</span>
                                     <span class="n">sphpdb</span><span class="o">=</span><span class="n">sphpdb_file</span><span class="p">,</span>
                                     <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
                                     <span class="n">end_radius</span><span class="o">=</span><span class="n">end_radius</span><span class="p">,</span>
                                     <span class="n">ignore</span><span class="o">=</span><span class="n">residues</span><span class="p">,</span>
                                     <span class="n">output_level</span><span class="o">=</span><span class="n">output_level</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">random_seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">random_seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
        <span class="n">infile_text</span> <span class="o">+=</span> <span class="n">hole_lines</span><span class="p">[</span><span class="s1">&#39;random_seed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fixed random number seed </span><span class="si">{}</span><span class="s2"> for reproducible &quot;</span>
                    <span class="s2">&quot;runs.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">random_seed</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">cpoint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cpoint</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">infile_text</span> <span class="o">+=</span> <span class="s1">&#39;CPOINT &#39;</span> <span class="o">+</span> <span class="n">cpoint</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">infile_text</span> <span class="o">+=</span> <span class="n">hole_lines</span><span class="p">[</span><span class="s1">&#39;cpoint&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">cpoint</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;HOLE will guess CPOINT&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cvect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">infile_text</span> <span class="o">+=</span> <span class="n">hole_lines</span><span class="p">[</span><span class="s1">&#39;cvect&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">cvect</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;HOLE will guess CVECT&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dcd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">infile_text</span> <span class="o">+=</span> <span class="n">hole_lines</span><span class="p">[</span><span class="s1">&#39;dcd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dcd</span><span class="o">=</span><span class="n">dcd</span><span class="p">,</span>
                                                <span class="n">iniskip</span><span class="o">=</span><span class="n">dcd_iniskip</span><span class="p">,</span>
                                                <span class="n">step</span><span class="o">=</span><span class="n">dcd_step</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">infile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">infile_text</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Wrote HOLE input file </span><span class="si">{}</span><span class="s1"> for inspection&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">infile</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">infile_text</span>


<div class="viewcode-block" id="run_hole">
<a class="viewcode-back" href="../../../../documentation_pages/analysis/hole2.html#MDAnalysis.analysis.hole2.utils.run_hole">[docs]</a>
<span class="k">def</span> <span class="nf">run_hole</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">infile_text</span><span class="p">,</span> <span class="n">executable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the HOLE program.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    outfile: str</span>
<span class="sd">        Output file name</span>
<span class="sd">    infile_text: str</span>
<span class="sd">        HOLE input text</span>
<span class="sd">        (typically generated by :func:`set_up_hole_input`)</span>
<span class="sd">    executable: str</span>
<span class="sd">        HOLE executable</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Output file name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">executable</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                <span class="n">stdout</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">infile_text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

    <span class="c1"># check output in case of errors</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;*** ERROR ***&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)):</span>
                <span class="n">proc</span><span class="o">.</span><span class="n">returncode</span> <span class="o">=</span> <span class="mi">255</span>
                <span class="k">break</span>

    <span class="c1"># die in case of error</span>
    <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;HOLE failure (</span><span class="si">{}</span><span class="s1">). Check output </span><span class="si">{}</span><span class="s1">&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">proc</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">outfile</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">stderr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ApplicationError</span><span class="p">(</span><span class="n">proc</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span>
                               <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">executable</span><span class="p">,</span> <span class="n">outfile</span><span class="p">))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;HOLE finished. Output: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outfile</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">outfile</span></div>



<div class="viewcode-block" id="collect_hole">
<a class="viewcode-back" href="../../../../documentation_pages/analysis/hole2.html#MDAnalysis.analysis.hole2.utils.collect_hole">[docs]</a>
<span class="k">def</span> <span class="nf">collect_hole</span><span class="p">(</span><span class="n">outfile</span><span class="o">=</span><span class="s1">&#39;hole.out&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collect data from HOLE output</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    outfile: str, optional</span>
<span class="sd">        HOLE output file to read. Default: &#39;hole.out&#39;</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Dictionary of HOLE profiles as record arrays</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">FORTRANReader</span><span class="p">(</span><span class="s1">&#39;3F12&#39;</span><span class="p">)</span>
    <span class="n">recarrays</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">toggle_read</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>  <span class="c1"># preserve columns in FORTRAN output</span>
            <span class="c1"># multiple frames from dcd in?</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot; Starting calculation for position number&quot;</span><span class="p">):</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">profile</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Started reading profile </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">profile</span><span class="p">))</span>
                <span class="k">continue</span>

            <span class="c1"># found data</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39; cenxyz.cvec&#39;</span><span class="p">):</span>
                <span class="n">toggle_read</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Started reading data&#39;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">toggle_read</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">rxncoord</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">cenlineD</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Problem parsing line: </span><span class="si">{}</span><span class="s1">. Check output file </span><span class="si">{}</span><span class="s1">&#39;</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">outfile</span><span class="p">))</span>
                        <span class="k">raise</span>
                    <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rxncoord</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">cenlineD</span><span class="p">))</span>
                    <span class="k">continue</span>
                <span class="c1"># end of data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">toggle_read</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rxn_coord&#39;</span><span class="p">,</span> <span class="s1">&#39;radius&#39;</span><span class="p">,</span> <span class="s1">&#39;cen_line_D&#39;</span><span class="p">]</span>
                    <span class="n">recarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">fromrecords</span><span class="p">(</span><span class="n">records</span><span class="p">,</span>
                                                <span class="n">formats</span><span class="o">=</span><span class="s1">&#39;f8, f8, f8&#39;</span><span class="p">,</span>
                                                <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
                    <span class="n">recarrays</span><span class="p">[</span><span class="n">profile</span><span class="p">]</span> <span class="o">=</span> <span class="n">recarr</span>

        <span class="k">return</span> <span class="n">recarrays</span></div>



<div class="viewcode-block" id="create_vmd_surface">
<a class="viewcode-back" href="../../../../documentation_pages/analysis/hole2.html#MDAnalysis.analysis.hole2.utils.create_vmd_surface">[docs]</a>
<span class="k">def</span> <span class="nf">create_vmd_surface</span><span class="p">(</span><span class="n">sphpdb</span><span class="o">=</span><span class="s1">&#39;hole.sph&#39;</span><span class="p">,</span>
                       <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">sph_process</span><span class="o">=</span><span class="s1">&#39;sph_process&#39;</span><span class="p">,</span>
                       <span class="n">sos_triangle</span><span class="o">=</span><span class="s1">&#39;sos_triangle&#39;</span><span class="p">,</span>
                       <span class="n">dot_density</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create VMD surface file from sphpdb file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sphpdb: str, optional</span>
<span class="sd">        sphpdb file to read. Default: &#39;hole.sph&#39;</span>
<span class="sd">    filename: str, optional</span>
<span class="sd">        output VMD surface file. If ``None``, a temporary file</span>
<span class="sd">        is generated. Default: ``None``</span>
<span class="sd">    sph_process: str, optional</span>
<span class="sd">        Executable for ``sph_process`` program. Default: &#39;sph_process&#39;</span>
<span class="sd">    sos_triangle: str, optional</span>
<span class="sd">        Executable for ``sos_triangle`` program. Default: &#39;sos_triangle&#39;</span>
<span class="sd">    dot_density: int, optional</span>
<span class="sd">        density of facets for generating a 3D pore representation.</span>
<span class="sd">        The number controls the density of dots that will be used.</span>
<span class="sd">        A sphere of dots is placed on each centre determined in the</span>
<span class="sd">        Monte Carlo procedure. The actual number of dots written is</span>
<span class="sd">        controlled by ``dot_density`` and the ``sample`` level of the</span>
<span class="sd">        original analysis. ``dot_density`` should be set between 5</span>
<span class="sd">        (few dots per sphere) and 35 (many dots per sphere).</span>
<span class="sd">        Default: 15</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        the output filename for the VMD surface</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fd</span><span class="p">,</span> <span class="n">tmp_sos</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.sos&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>

    <span class="n">sph_process_path</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">sph_process</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sph_process_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">,</span> <span class="n">exe_err</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">sph_process</span><span class="p">,</span>
                                                   <span class="n">kw</span><span class="o">=</span><span class="s1">&#39;sph_process&#39;</span><span class="p">))</span>
    <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sph_process_path</span><span class="p">)</span>

    <span class="n">sos_triangle_path</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">sos_triangle</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sos_triangle_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">sos_triangle</span><span class="p">)</span>
        <span class="n">sos_triangle_path</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sos_triangle_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">,</span> <span class="n">exe_err</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">sos_triangle</span><span class="p">,</span>
                                                   <span class="n">kw</span><span class="o">=</span><span class="s1">&#39;sos_triangle&#39;</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="n">sph_process_path</span><span class="p">,</span> <span class="s2">&quot;-sos&quot;</span><span class="p">,</span> <span class="s2">&quot;-dotden&quot;</span><span class="p">,</span>
                                          <span class="nb">str</span><span class="p">(</span><span class="n">dot_density</span><span class="p">),</span> <span class="s2">&quot;-color&quot;</span><span class="p">,</span> <span class="n">sphpdb</span><span class="p">,</span>
                                          <span class="n">tmp_sos</span><span class="p">],</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmp_sos</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;sph_process failed (</span><span class="si">{0}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">returncode</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="s2">&quot;sph_process failed&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmp_sos</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fd</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.sos&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Could check: os.devnull if subprocess.DEVNULL not available (&gt;3.3)</span>
        <span class="c1"># Suppress stderr messages of sos_triangle</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmp_sos</span><span class="p">)</span> <span class="k">as</span> <span class="n">sos</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">triangles</span><span class="p">,</span> \
                <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">FNULL</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span>
                <span class="p">[</span><span class="n">sos_triangle_path</span><span class="p">,</span> <span class="s2">&quot;-s&quot;</span><span class="p">],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">sos</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">triangles</span><span class="p">,</span>
                <span class="n">stderr</span><span class="o">=</span><span class="n">FNULL</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;sos_triangle failed (</span><span class="si">{0}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">returncode</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="s2">&quot;sos_triangle failed&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmp_sos</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">filename</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2005-2023, Naveen Michaud-Agrawal, Elizabeth J. Denning, Christian Beckstein (logo), Joshua L. Adelman, Henok Ademtew, Shobhit Agarwal, Aya M. Alaa, Irfan Alibay, Kazi Shudipto Amin, Anshul Angaria, Luís Pedro Borges Araújo, Balasubramanian, Utkarsh Bansal, Patricio Barletta, Leonardo Barneschi, Jonathan Barnoud, Estefania Barreto-Ojeda, Tone Bengtsen, Alejandro Bernardin, Ninad Bhat, Mateusz Bieniek, Kavya Bisht, Wouter Boomsma, Jose Borreguero, Cédric Bouysset, Kevin Boyd, Meet Brijwani, Bart Bruininks, Sébastien Buchoux, Sören von Bülow, Yantong Cai, David Caplan, Yuanyu Chang, Pratham Chauhan, Matthieu Chavent, Haochuan Chen, Xu Hong Chen, Kathleen Clark, Jennifer A Clark, Orion Cohen, Charlie Cook, Ruggero Cortini, Nicholas Craven, Ramon Crehuet, Davide Cruz, Robert Delgado, John Detlefs, Xavier Deupi, Bradley Dice, Jan Domanski, David L. Dotson, Mark D. Driver, Ali Ehlen, Daniel J. Evans, Shujie Fan, Bjarne Feddersen, Lennard van der Feltz, Jake Fennick, Philip Fowler, Guillaume Fraux, Anirvinya G, Michael Gecht, Ahmed Salah Ghoneim, Mikhail Glagolev, William Glass, Jenna M. Swarthout Goddard, Joseph Goose, Alexander Gorfer, Richard J. Gowers, Lukas Grossar, Abhinav Gupta, Akshay Gupta, Pratik Gupta, Sumit Gupta, Benjamin Hall, Ameya Harmalkar, Ivan Hristov, Eugen Hruska, Kyle J. Huston, Siddharth Jain, Edis Jakupovic, Joe Jordan, Henrik Jäger, Uma D Kadam, Aditya Kamath, Jon Kapla, Ian M. Kenney, Haleema Khan, Navya Khare, Utsav Khatu, Andrew William King, Henry Kobin, Abhishek A. Kognole, Kosuke Kudo, Atharva Kulkarni, Manish Kumar, Mohit Kumar, Shubham Kumar, Alia Lescoulie, Zhenbo Li, Max Linke, Philip Loche, Jinju Lu, Hugo MacDermott-Opeskin, Shaivi Malik, Egor Marin, Domenico Marson, Micaela Matta, Andrew R. McCluskey, Robert McGibbon, Rocco Meli, Manuel Nuno Melo, Marcelo C. R. Melo, Dominik &#39;Rathann&#39; Mierzejewski, David Minh, Geongi Moon, Henry Mull, Morgan L. Nance, Fiona B. Naughton, Alex Nesterenko, Hai Nguyen, Sang Young Noh, Meghan Osato, Daniele Padula, Nabarun Pal, Mattia F. Palermo, Dimitrios Papageorgiou, Rafael R. Pappalardo, Vishal Parmar, Danny Parton, Shakul Pathak, Christian Pfaendner, Joshua L. Phillips, Marcelo D. Poleto, Hannah Pollak, Kashish Punjani, Michael Quevillon, Vedant Rathore, Tyler Reddy, Pedro Reis, Paul Rigor, Andrea Rizzi, Xiaoxu Ruan, Carlos Yanez S., Utkarsh Saxena, Moritz Schaeffler, Alexander Schlaich, Marcello Sega, Ricky Sexton, Sean L. Seyler, Faraaz Shah, Sulay Shah, Abhishek Shandilya, Shubham Sharma, Rishabh Shukla, Karthikeyan Singaravelan, Tamandeep Singh, Brigitta Sipőcz, Paul Smith, Andy Somogyi, Caio S. Souza, David van der Spoel, Shantanu Srivastava, Lukas Stelzl, Jan Stevens, Gorman Stock, Johannes Stöckelmaier, Fenil Suchak, Ayush Suhane, Filip T. Szczypiński, Sukeerti T, Matthijs Tadema, Joao Miguel Correia Teixeira, Paarth Thadani, Matthew W. Thompson, Hao Tian, Matteo Tiberti, Zaheer Timol, Wiep van der Toorn, Mieczyslaw Torchala, Aditi Tripathi, Heet Vekariya, Mark Verma, Josh Vermaas, Isaac Virshup, Lily Wang, Nestor Wendt, Lawson Woods, Zhiyi Wu, Tengyu Xie, Zhuyi Xue, Mingyi Xue, Alexander Yang, Juan Eiros Zamora, Johannes Zeman, Yibo Zhang, Raymond Zhao, Yuxuan Zhuang, and Oliver Beckstein.</p>
  </div>

  

<div class="footer"><p>Please see
    our <a href="https://www.mdanalysis.org/pages/privacy/">Privacy Policy</a>
    to learn how <a href="https://www.mdanalysis.org">MDAnalysis</a> collects data.</p>
    <script data-goatcounter="https://mdanalysis.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
</div>



</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
    var versions_json_url = 'https://docs.mdanalysis.org/versions.json'
</script>

<div class="rst-versions" data-toggle="rst-versions" role="note"
     aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"></span>
        2.7.0-dev0
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
        <dl id="versionselector">
            <dt>Other Versions</dt>
        </dl>

    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>