


  
    
  




<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css" integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="shortcut icon" href="../../../_static/logo/mda_favicon.ico">
</head>

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MDAnalysis.topology.TOPParser &mdash; MDAnalysis 2.7.0-dev0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/site.css" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=542471e5"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/js/versions.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within MDAnalysis 2.7.0-dev0 documentation"
          href="../../../_static/opensearch.xml"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >




  




<a href="../../../index.html">
  
    <img src="../../../_static/logo/mda_logo.png" class="logo" alt="Logo"/>
</a>


  
  
  
    <div class="version">
      2.7.0-dev0
    </div>
  



<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div>
<div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
    <!-- <p class="caption" role="heading"></p> -->
    <ul>
        
        <li class="toctree-l1"><a class="reference internal" href="http://mdanalysis.org">MDAnalysis</a></li>
        
        <li class="toctree-l1"><a class="reference internal" href="http://userguide.mdanalysis.org">User guide</a></li>
        
        <li class="toctree-l1"><a class="reference internal" href="https://mdakits.mdanalysis.org/">MDAKits</a></li>
        
    </ul>
    
        <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/overview.html">1. Overview over MDAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/topology.html">2. The topology system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/selections.html">3. Selection commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/analysis_modules.html">4. Analysis modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/topology_modules.html">5. Topology modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/coordinates_modules.html">6. Coordinates modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/converters.html">7. Converter modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/trajectory_transformations.html">8. Trajectory transformations (“on-the-fly” transformations)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/selections_modules.html">9. Selection exporters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/auxiliary_modules.html">10. Auxiliary modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/core_modules.html">11. Core modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/visualization_modules.html">12. Visualization modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/lib_modules.html">13. Library functions — <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.lib</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/version.html">14. Version information for MDAnalysis - <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.version</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/units.html">15. Constants and unit conversion — <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.units</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/exceptions.html">16. Custom exceptions and warnings — <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.exceptions</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/references.html">17. References</a></li>
</ul>

</div>

      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MDAnalysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">MDAnalysis.topology.TOPParser</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for MDAnalysis.topology.TOPParser</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- Mode: python; tab-width: 4; indent-tabs-mode:nil; coding:utf-8 -*-</span>
<span class="c1"># vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4</span>
<span class="c1">#</span>
<span class="c1"># MDAnalysis --- https://www.mdanalysis.org</span>
<span class="c1"># Copyright (c) 2006-2017 The MDAnalysis Development Team and contributors</span>
<span class="c1"># (see the file AUTHORS for the full list of names)</span>
<span class="c1">#</span>
<span class="c1"># Released under the GNU Public Licence, v2 or any higher version</span>
<span class="c1">#</span>
<span class="c1"># Please cite your use of MDAnalysis in published work:</span>
<span class="c1">#</span>
<span class="c1"># R. J. Gowers, M. Linke, J. Barnoud, T. J. E. Reddy, M. N. Melo, S. L. Seyler,</span>
<span class="c1"># D. L. Dotson, J. Domanski, S. Buchoux, I. M. Kenney, and O. Beckstein.</span>
<span class="c1"># MDAnalysis: A Python package for the rapid analysis of molecular dynamics</span>
<span class="c1"># simulations. In S. Benthall and S. Rostrup editors, Proceedings of the 15th</span>
<span class="c1"># Python in Science Conference, pages 102-109, Austin, TX, 2016. SciPy.</span>
<span class="c1"># doi: 10.25080/majora-629e541a-00e</span>
<span class="c1">#</span>
<span class="c1"># N. Michaud-Agrawal, E. J. Denning, T. B. Woolf, and O. Beckstein.</span>
<span class="c1"># MDAnalysis: A Toolkit for the Analysis of Molecular Dynamics Simulations.</span>
<span class="c1"># J. Comput. Chem. 32 (2011), 2319--2327, doi:10.1002/jcc.21787</span>
<span class="c1">#</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">AMBER PRMTOP topology parser</span>
<span class="sd">============================</span>

<span class="sd">Reads an AMBER top file to build the system.</span>

<span class="sd">Amber keywords are turned into the following attributes:</span>

<span class="sd">+----------------------------+----------------------+</span>
<span class="sd">| AMBER flag                 | MDAnalysis attribute |</span>
<span class="sd">+============================+======================+</span>
<span class="sd">| ATOM_NAME                  | names                |</span>
<span class="sd">+----------------------------+----------------------+</span>
<span class="sd">| CHARGE                     | charges              |</span>
<span class="sd">+----------------------------+----------------------+</span>
<span class="sd">| ATOMIC_NUMBER              | elements             |</span>
<span class="sd">+----------------------------+----------------------+</span>
<span class="sd">| MASS                       | masses               |</span>
<span class="sd">+----------------------------+----------------------+</span>
<span class="sd">| BONDS_INC_HYDROGEN         | bonds                |</span>
<span class="sd">| BONDS_WITHOUT_HYDROGEN     |                      |</span>
<span class="sd">+----------------------------+----------------------+</span>
<span class="sd">| ANGLES_INC_HYDROGEN        | angles               |</span>
<span class="sd">| ANGLES_WITHOUT_HYDROGEN    |                      |</span>
<span class="sd">+----------------------------+----------------------+</span>
<span class="sd">| DIHEDRALS_INC_HYDROGEN     | dihedrals / improper |</span>
<span class="sd">| DIHEDRALS_WITHOUT_HYDROGEN |                      |</span>
<span class="sd">+----------------------------+----------------------+</span>
<span class="sd">| ATOM_TYPE_INDEX            | type_indices         |</span>
<span class="sd">+----------------------------+----------------------+</span>
<span class="sd">| AMBER_ATOM_TYPE            | types                |</span>
<span class="sd">+----------------------------+----------------------+</span>
<span class="sd">| RESIDUE_LABEL              | resnames             |</span>
<span class="sd">+----------------------------+----------------------+</span>
<span class="sd">| RESIDUE_POINTER            | residues             |</span>
<span class="sd">+----------------------------+----------------------+</span>

<span class="sd">TODO:</span>
<span class="sd">  Add support for Chamber-style topologies</span>
<span class="sd">  More stringent tests</span>

<span class="sd">.. Note::</span>

<span class="sd">   The Amber charge is converted to electron charges as used in</span>
<span class="sd">   MDAnalysis and other packages. To get back Amber charges, multiply</span>
<span class="sd">   by 18.2223.</span>

<span class="sd">   Chamber-style Amber topologies (i.e. topologies generated via parmed</span>
<span class="sd">   conversion of a CHARMM topology to an AMBER one) are not currently</span>
<span class="sd">   supported. Support will likely be added in future MDAnalysis releases.</span>

<span class="sd">   As of version 2.0.0, elements are no longer guessed if ATOMIC_NUMBER records</span>
<span class="sd">   are missing. In those scenarios, if elements are necessary, users will have</span>
<span class="sd">   to invoke the element guessers after parsing the topology file. Please see</span>
<span class="sd">   :mod:`MDAnalysis.topology.guessers` for more details.</span>

<span class="sd">.. _`PARM parameter/topology file specification`:</span>
<span class="sd">   https://ambermd.org/FileFormats.php#topo.cntrl</span>

<span class="sd">Classes</span>
<span class="sd">-------</span>

<span class="sd">.. autoclass:: TOPParser</span>
<span class="sd">   :members:</span>
<span class="sd">   :inherited-members:</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">itertools</span>

<span class="kn">from</span> <span class="nn">.tables</span> <span class="kn">import</span> <span class="n">Z2SYMB</span>
<span class="kn">from</span> <span class="nn">..lib.util</span> <span class="kn">import</span> <span class="n">openany</span><span class="p">,</span> <span class="n">FORTRANReader</span>
<span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">TopologyReaderBase</span><span class="p">,</span> <span class="n">change_squash</span>
<span class="kn">from</span> <span class="nn">..core.topology</span> <span class="kn">import</span> <span class="n">Topology</span>
<span class="kn">from</span> <span class="nn">..core.topologyattrs</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Atomnames</span><span class="p">,</span>
    <span class="n">Atomtypes</span><span class="p">,</span>
    <span class="n">Atomids</span><span class="p">,</span>
    <span class="n">Charges</span><span class="p">,</span>
    <span class="n">Elements</span><span class="p">,</span>
    <span class="n">Masses</span><span class="p">,</span>
    <span class="n">Resnames</span><span class="p">,</span>
    <span class="n">Resids</span><span class="p">,</span>
    <span class="n">Resnums</span><span class="p">,</span>
    <span class="n">Segids</span><span class="p">,</span>
    <span class="n">ChainIDs</span><span class="p">,</span>
    <span class="n">AtomAttr</span><span class="p">,</span>
    <span class="n">Bonds</span><span class="p">,</span>
    <span class="n">Angles</span><span class="p">,</span>
    <span class="n">Dihedrals</span><span class="p">,</span>
    <span class="n">Impropers</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;MDAnalysis.topology.TOPParser&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TypeIndices</span><span class="p">(</span><span class="n">AtomAttr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Numerical type of each Atom&quot;&quot;&quot;</span>
    <span class="n">attrname</span> <span class="o">=</span> <span class="s1">&#39;type_indices&#39;</span>
    <span class="n">singular</span> <span class="o">=</span> <span class="s1">&#39;type_index&#39;</span>
    <span class="n">level</span> <span class="o">=</span> <span class="s1">&#39;atom&#39;</span>


<div class="viewcode-block" id="TOPParser">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser">[docs]</a>
<span class="k">class</span> <span class="nc">TOPParser</span><span class="p">(</span><span class="n">TopologyReaderBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads topology information from an AMBER top file.</span>

<span class="sd">    Reads the following Attributes if in topology:</span>
<span class="sd">    - Atomnames</span>
<span class="sd">    - Charges</span>
<span class="sd">    - Masses</span>
<span class="sd">    - Elements</span>
<span class="sd">    - Atomtypes</span>
<span class="sd">    - Resnames</span>
<span class="sd">    - Type_indices</span>
<span class="sd">    - Bonds</span>
<span class="sd">    - Angles</span>
<span class="sd">    - Dihedrals (inc. impropers)</span>
<span class="sd">    - ChainIDs (from %RESIDUE_CHAINID)</span>
<span class="sd">    - Segids (from %RESIDUE_CHAINID)</span>

<span class="sd">    The format is defined in `PARM parameter/topology file</span>
<span class="sd">    specification`_.  The reader tries to detect if it is a newer</span>
<span class="sd">    (AMBER 12?) file format by looking for the flag &quot;ATOMIC_NUMBER&quot;.</span>

<span class="sd">    .. _`PARM parameter/topology file specification`:</span>
<span class="sd">       https://ambermd.org/FileFormats.php#topo.cntrl</span>

<span class="sd">    Additionally, the RESIDUE_CHAINID non-standard flag is supported. This</span>
<span class="sd">    can be added with the `addPDB`_ command from parmed:</span>

<span class="sd">    .. _`addPDB`: https://parmed.github.io/ParmEd/html/parmed.html#addpdb</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Elements are obtained from the atomic numbers (if present). If a given</span>
<span class="sd">    input atomic number does not belong to an element (usually either -1 or 0),</span>
<span class="sd">    the element will be assigned an empty record.</span>

<span class="sd">    .. versionchanged:: 0.7.6</span>
<span class="sd">      parses both amber10 and amber12 formats</span>
<span class="sd">    .. versionchanged:: 0.19.0</span>
<span class="sd">      parses bonds, angles, dihedrals, and impropers</span>
<span class="sd">    .. versionchanged:: 1.0.0</span>
<span class="sd">      warns users that chamber-style topologies are not currently supported</span>
<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">      no longer guesses elements if missing</span>
<span class="sd">    .. versionchanged:: 2.7.0</span>
<span class="sd">      gets Segments and chainIDs from flag RESIDUE_CHAINID, when present</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TOP&#39;</span><span class="p">,</span> <span class="s1">&#39;PRMTOP&#39;</span><span class="p">,</span> <span class="s1">&#39;PARM7&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="TOPParser.parse">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser.parse">[docs]</a>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse Amber PRMTOP topology file *filename*.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A MDAnalysis Topology object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Sections that we grab as we parse the file</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ATOM_NAME&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_names</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;CHARGE&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_charges</span><span class="p">,</span> <span class="s2">&quot;charge&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;ATOMIC_NUMBER&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_elements</span><span class="p">,</span> <span class="s2">&quot;elements&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;MASS&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_masses</span><span class="p">,</span> <span class="s2">&quot;mass&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;ATOM_TYPE_INDEX&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_type_indices</span><span class="p">,</span> <span class="s2">&quot;type_indices&quot;</span><span class="p">,</span>
                                <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;AMBER_ATOM_TYPE&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_types</span><span class="p">,</span> <span class="s2">&quot;types&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;RESIDUE_LABEL&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_resnames</span><span class="p">,</span> <span class="s2">&quot;resname&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
            <span class="s2">&quot;RESIDUE_POINTER&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_residx</span><span class="p">,</span> <span class="s2">&quot;respoint&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
            <span class="s2">&quot;BONDS_INC_HYDROGEN&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_bonded</span><span class="p">,</span> <span class="s2">&quot;bondh&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s2">&quot;BONDS_WITHOUT_HYDROGEN&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_bonded</span><span class="p">,</span> <span class="s2">&quot;bonda&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="s2">&quot;ANGLES_INC_HYDROGEN&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_bonded</span><span class="p">,</span> <span class="s2">&quot;angh&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="s2">&quot;ANGLES_WITHOUT_HYDROGEN&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_bonded</span><span class="p">,</span> <span class="s2">&quot;anga&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="s2">&quot;DIHEDRALS_INC_HYDROGEN&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_bonded</span><span class="p">,</span> <span class="s2">&quot;dihh&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="s2">&quot;DIHEDRALS_WITHOUT_HYDROGEN&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_bonded</span><span class="p">,</span> <span class="s2">&quot;diha&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
            <span class="s2">&quot;RESIDUE_CHAINID&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_chainids</span><span class="p">,</span> <span class="s2">&quot;segids&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># empty dict for attrs that we&#39;ll fill</span>

        <span class="c1"># Open and check top validity</span>
        <span class="c1"># Reading header info POINTERS</span>
        <span class="k">with</span> <span class="n">openany</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="bp">self</span><span class="o">.</span><span class="n">topfile</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">header</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;%VE&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> is not a valid TOP file. %VE Missing in header&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">title</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topfile</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">title</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TITLE&quot;</span><span class="p">):</span>
                <span class="c1"># Raise a separate warning if Chamber-style TOP is detected</span>
                <span class="k">if</span> <span class="n">title</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CTITLE&quot;</span><span class="p">:</span>
                    <span class="n">emsg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> is detected as a Chamber-style TOP file. &quot;</span>
                            <span class="s2">&quot;At this time MDAnalysis does not support such &quot;</span>
                            <span class="s2">&quot;topologies&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">emsg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> is not a valid TOP file. &quot;</span>
                            <span class="s2">&quot;&#39;TITLE&#39; missing in header&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">emsg</span><span class="p">)</span>

            <span class="k">while</span> <span class="ow">not</span> <span class="n">header</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%F</span><span class="s1">LAG POINTERS&#39;</span><span class="p">):</span>
                <span class="n">header</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topfile</span><span class="p">)</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topfile</span><span class="p">)</span>

            <span class="n">topremarks</span> <span class="o">=</span> <span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topfile</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
            <span class="n">sys_info</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">topremarks</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

            <span class="n">header</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topfile</span><span class="p">)</span>
            <span class="c1"># grab the next section title</span>
            <span class="n">next_section</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%F</span><span class="s2">LAG&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="k">while</span> <span class="n">next_section</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">num_per_record</span><span class="p">,</span> <span class="n">per_line</span><span class="p">,</span>
                     <span class="n">func</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sect_num</span><span class="p">)</span> <span class="o">=</span> <span class="n">sections</span><span class="p">[</span><span class="n">next_section</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">def</span> <span class="nf">next_getter</span><span class="p">():</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipper</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">num</span> <span class="o">=</span> <span class="n">sys_info</span><span class="p">[</span><span class="n">sect_num</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_per_record</span>
                    <span class="n">numlines</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">//</span> <span class="n">per_line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">num</span> <span class="o">%</span> <span class="n">per_line</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">numlines</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="n">attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">num_per_record</span><span class="p">,</span> <span class="n">numlines</span><span class="p">)</span>

                    <span class="k">def</span> <span class="nf">next_getter</span><span class="p">():</span>
                        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topfile</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">next_getter</span><span class="p">()</span>
                    <span class="c1"># Capture case where section is empty w/ 1 empty line</span>
                    <span class="k">if</span> <span class="n">numlines</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">next_getter</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="n">next_section</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">next_section</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%F</span><span class="s2">LAG&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">errmsg</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;%FLAG section not found, formatting error &quot;</span>
                                  <span class="sa">f</span><span class="s2">&quot;for PARM7 file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>

        <span class="c1"># strip out a few values to play with them</span>
        <span class="n">n_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

        <span class="n">resptrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;respoint&#39;</span><span class="p">)</span>
        <span class="n">resptrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">)</span>
        <span class="n">residx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">resptrs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">resptrs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])):</span>
            <span class="n">residx</span><span class="p">[</span><span class="n">x</span><span class="p">:</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

        <span class="n">n_res</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;resname&#39;</span><span class="p">])</span>

        <span class="c1"># Deal with recreating bonds and angle records here</span>
        <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;bonds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Bonds</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                                <span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;bonda&#39;</span><span class="p">),</span> <span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;bondh&#39;</span><span class="p">))])</span>

        <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;angles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Angles</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                                <span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;anga&#39;</span><span class="p">),</span> <span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;angh&#39;</span><span class="p">))])</span>

        <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dihedrals&#39;</span><span class="p">],</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;impropers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_dihedrals</span><span class="p">(</span>
                              <span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;diha&#39;</span><span class="p">),</span> <span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dihh&#39;</span><span class="p">))</span>

        <span class="c1"># Warn user if elements not in topology</span>
        <span class="k">if</span> <span class="s1">&#39;elements&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ATOMIC_NUMBER record not found, elements attribute will &quot;</span>
                   <span class="s2">&quot;not be populated. If needed these can be guessed using &quot;</span>
                   <span class="s2">&quot;MDAnalysis.topology.guessers.&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;elements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="c1"># only send out one warning that some elements are unknown</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Unknown ATOMIC_NUMBER value found for some atoms, these &quot;</span>
                   <span class="s2">&quot;have been given an empty element record. If needed these &quot;</span>
                   <span class="s2">&quot;can be guessed using MDAnalysis.topology.guessers.&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># atom ids are mandatory</span>
        <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;atomids&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Atomids</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;resids&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Resids</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_res</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;resnums&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Resnums</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_res</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Amber&#39;s &#39;RESIDUE_CHAINID&#39; is a by-residue attribute, turn it into</span>
        <span class="c1"># a by-atom attribute when present. See PR #4007.</span>
        <span class="k">if</span> <span class="s2">&quot;segids&quot;</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;segids&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="n">n_res</span><span class="p">:</span>
            <span class="n">segidx</span><span class="p">,</span> <span class="p">(</span><span class="n">segids</span><span class="p">,)</span> <span class="o">=</span> <span class="n">change_squash</span><span class="p">((</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;segids&quot;</span><span class="p">],),</span> <span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;segids&quot;</span><span class="p">],))</span>
            <span class="n">chainids</span> <span class="o">=</span> <span class="p">[</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;segids&quot;</span><span class="p">][</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">residx</span><span class="p">]</span>

            <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;segids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Segids</span><span class="p">(</span><span class="n">segids</span><span class="p">)</span>
            <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChainIDs</span><span class="p">(</span><span class="n">chainids</span><span class="p">)</span>
            <span class="n">n_segs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">segids</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;segids&quot;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Number of residues (</span><span class="si">{</span><span class="n">n_res</span><span class="si">}</span><span class="s2">) does not match number of &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;%RESIDUE_CHAINID (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;segids&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">). Skipping section.&quot;</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;segids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Segids</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;SYSTEM&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
            <span class="n">segidx</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">n_segs</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">top</span> <span class="o">=</span> <span class="n">Topology</span><span class="p">(</span>
            <span class="n">n_atoms</span><span class="p">,</span>
            <span class="n">n_res</span><span class="p">,</span>
            <span class="n">n_segs</span><span class="p">,</span>
            <span class="n">attrs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">attrs</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
            <span class="n">atom_resindex</span><span class="o">=</span><span class="n">residx</span><span class="p">,</span>
            <span class="n">residue_segindex</span><span class="o">=</span><span class="n">segidx</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">top</span></div>


<div class="viewcode-block" id="TOPParser.skipper">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser.skipper">[docs]</a>
    <span class="k">def</span> <span class="nf">skipper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TOPParser :class: helper function, skips lines of input parm7 file</span>
<span class="sd">        until we find the next %FLAG entry and return that</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        line : string</span>
<span class="sd">            String containing the current line of the parm7 file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topfile</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%F</span><span class="s2">LAG&quot;</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">line</span></div>


<div class="viewcode-block" id="TOPParser.parse_names">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser.parse_names">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_per_record</span><span class="p">,</span> <span class="n">numlines</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts atoms names from parm7 file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_per_record : int</span>
<span class="sd">            The number of entries for each record in the section (unused input)</span>
<span class="sd">        numlines : int</span>
<span class="sd">            The number of lines to be parsed in current section</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attr : :class:`Atomnames`</span>
<span class="sd">            A :class:`Atomnames` instance containing the names of each atom as</span>
<span class="sd">            defined in the parm7 file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsesection_mapper</span><span class="p">(</span><span class="n">numlines</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">Atomnames</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">attr</span></div>


<div class="viewcode-block" id="TOPParser.parse_resnames">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser.parse_resnames">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_resnames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_per_record</span><span class="p">,</span> <span class="n">numlines</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the names of each residue</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_per_record : int</span>
<span class="sd">            The number of entries for each recrod in section (unused input)</span>
<span class="sd">        numlines : int</span>
<span class="sd">            The number of lines to be parsed in current section</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attr : :class:`Resnames`</span>
<span class="sd">            A :class:`Resnames` instance containing the names of each residue</span>
<span class="sd">            as defined in the parm7 file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsesection_mapper</span><span class="p">(</span><span class="n">numlines</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">Resnames</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">attr</span></div>


<div class="viewcode-block" id="TOPParser.parse_charges">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser.parse_charges">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_charges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_per_record</span><span class="p">,</span> <span class="n">numlines</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the partial charges for each atom</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_per_record : int</span>
<span class="sd">            The number of entries for each record in section (unused input)</span>
<span class="sd">        numlines : int</span>
<span class="sd">            The number of lines to be parsed in current section</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attr : :class:`Charges`</span>
<span class="sd">            A :class:`Charges` instance containing the partial charges of each</span>
<span class="sd">            atom as defined in the parm7 file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsesection_mapper</span><span class="p">(</span><span class="n">numlines</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">charges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">charges</span> <span class="o">/=</span> <span class="mf">18.2223</span>  <span class="c1"># to electron charge units</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">Charges</span><span class="p">(</span><span class="n">charges</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">attr</span></div>


<div class="viewcode-block" id="TOPParser.parse_masses">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser.parse_masses">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_masses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_per_record</span><span class="p">,</span> <span class="n">numlines</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the mass of each atom</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_per_record : int</span>
<span class="sd">            The number of entries for each record in section (unused input)</span>
<span class="sd">        numlines : int</span>
<span class="sd">            The number of lines to be parsed in current section</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attr : :class:`Masses`</span>
<span class="sd">            A :class:`Masses` instance containing the mass of each atom as</span>
<span class="sd">            defined in the parm7 file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsesection_mapper</span><span class="p">(</span><span class="n">numlines</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">Masses</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">attr</span></div>


<div class="viewcode-block" id="TOPParser.parse_elements">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser.parse_elements">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_per_record</span><span class="p">,</span> <span class="n">numlines</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the atomic numbers of each atom and converts to element type</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_per_record : int</span>
<span class="sd">            The number of entries for each record in section(unused input)</span>
<span class="sd">        numlines : int</span>
<span class="sd">            The number of lines to be pasred in current section</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attr : :class:`Elements`</span>
<span class="sd">            A :class:`Elements` instance containing the element of each atom</span>
<span class="sd">            as defined in the parm7 file</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        If the record contains unknown atomic numbers (e.g. &lt;= 0), these will</span>
<span class="sd">        be treated as unknown elements and assigned an empty string value. See</span>
<span class="sd">        issues #2306 and #2651 for more details.</span>

<span class="sd">        .. versionchanged:: 2.0.0</span>
<span class="sd">           Unrecognised elements will now return a empty string. The parser</span>
<span class="sd">           will no longer attempt to guess the element by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsesection_mapper</span><span class="p">(</span>
                <span class="n">numlines</span><span class="p">,</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Z2SYMB</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">attr</span></div>


<div class="viewcode-block" id="TOPParser.parse_types">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser.parse_types">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_per_record</span><span class="p">,</span> <span class="n">numlines</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the force field atom types of each atom</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_per_record : int</span>
<span class="sd">            The number of entries for each record in section (unused input)</span>
<span class="sd">        numlines : int</span>
<span class="sd">            The number of lines to be parsed in current section</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attr : :class:`Atomtypes`</span>
<span class="sd">            A :class:`Atomtypes` instance containing the atom types for each</span>
<span class="sd">            atom as defined in the parm7 file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsesection_mapper</span><span class="p">(</span><span class="n">numlines</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">Atomtypes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">attr</span></div>


<div class="viewcode-block" id="TOPParser.parse_type_indices">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser.parse_type_indices">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_type_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_per_record</span><span class="p">,</span> <span class="n">numlines</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the index of atom types of the each atom involved in Lennard</span>
<span class="sd">        Jones (6-12) interactions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_per_record : int</span>
<span class="sd">            The number of entries for each record in section (unused input)</span>
<span class="sd">        numlines : int</span>
<span class="sd">            The number of lines to be parsed in current section</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attr :class:`TypeIndices`</span>
<span class="sd">            A :class:`TypeIndices` instance containing the LJ 6-12 atom type</span>
<span class="sd">            index for each atom</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsesection_mapper</span><span class="p">(</span><span class="n">numlines</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">TypeIndices</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">attr</span></div>


<div class="viewcode-block" id="TOPParser.parse_residx">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser.parse_residx">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_residx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_per_record</span><span class="p">,</span> <span class="n">numlines</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the residue pointers for each atom</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_per_record : int</span>
<span class="sd">            The number of entries for each record in section (unused input)</span>
<span class="sd">        numlines : int</span>
<span class="sd">            The number of lines to be parsed in current section</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        vals : list of int</span>
<span class="sd">            A list of zero-formatted residue pointers for each atom</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsesection_mapper</span><span class="p">(</span><span class="n">numlines</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vals</span></div>


<div class="viewcode-block" id="TOPParser.parse_chunks">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser.parse_chunks">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function to parse AMBER PRMTOP bonds/angles.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list of int</span>
<span class="sd">            Input list of the parm7 bond/angle section, zero-indexed</span>
<span class="sd">        num_per_record : int</span>
<span class="sd">            The number of entries for each record in the input list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        vals : list of int tuples</span>
<span class="sd">            A list of tuples containing the atoms involved in a given bonded</span>
<span class="sd">            interaction</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        In the parm7 format this information is structured in the following</span>
<span class="sd">        format: [ atoms 1:n, internal index ]</span>
<span class="sd">        Where 1:n represent the ids of the n atoms involved in the bond/angle</span>
<span class="sd">        and the internal index links to a given set of FF parameters.</span>
<span class="sd">        Therefore, to extract the required information, we split out the list</span>
<span class="sd">        into chunks of size num_per_record, and only extract the atom ids.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="n">chunksize</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">chunksize</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">vals</span></div>


<div class="viewcode-block" id="TOPParser.parse_bonded">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser.parse_bonded">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_bonded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_per_record</span><span class="p">,</span> <span class="n">numlines</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts bond information from PARM7 format files</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_per_record : int</span>
<span class="sd">            The number of entries for each record in section</span>
<span class="sd">        numlines : int</span>
<span class="sd">            The number of lines to be parsed for this section</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        For the bond/angle sections of parm7 files, the atom numbers are set to</span>
<span class="sd">        coordinate array index values. As detailed in `the specification`_,</span>
<span class="sd">        to recover the actual atom number, one</span>
<span class="sd">        should divide the values by 3 and add 1. Here, since we want to satisfy</span>
<span class="sd">        zero-indexing, we only divide by 3.</span>

<span class="sd">        .. _`the specification`: https://ambermd.org/FileFormats.php#topo.cntrl</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsesection_mapper</span><span class="p">(</span><span class="n">numlines</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">//</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_chunks</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">num_per_record</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">section</span></div>


<div class="viewcode-block" id="TOPParser.parsesection_mapper">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser.parsesection_mapper">[docs]</a>
    <span class="k">def</span> <span class="nf">parsesection_mapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numlines</span><span class="p">,</span> <span class="n">mapper</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parses FORTRAN formatted section, and returns a list of all entries</span>
<span class="sd">        in each line</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        numlines : int</span>
<span class="sd">            The number of lines to be parsed in this section</span>
<span class="sd">        mapper : lambda operator</span>
<span class="sd">            Operator to format entries in current section</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        section : list</span>
<span class="sd">            A list of all entries in a given parm7 section</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">section</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">get_fmt</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot; Skips &#39;%COMMENT&#39; lines until it gets the FORMAT specification</span>
<span class="sd">            for the section.&quot;&quot;&quot;</span>
            <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="si">%F</span><span class="s2">ORMAT&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">line</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">line</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;%COMMENT&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">get_fmt</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid header line. Does not begin with either </span><span class="si">%F</span><span class="s2">LAG, </span><span class="si">%F</span><span class="s2">ORMAT &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;nor %COMMENT:</span><span class="se">\n</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="c1"># There may be %COMMENT lines between %FLAG and %FORMAT statements. Skip them.</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">get_fmt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topfile</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">FORTRANReader</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numlines</span><span class="p">):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topfile</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">entries</span><span class="p">)):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                    <span class="n">section</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapper</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">section</span></div>


<div class="viewcode-block" id="TOPParser.parse_dihedrals">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser.parse_dihedrals">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_dihedrals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diha</span><span class="p">,</span> <span class="n">dihh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Combines hydrogen and non-hydrogen containing AMBER dihedral lists</span>
<span class="sd">        and extracts sublists for conventional dihedrals and improper angles</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        diha : list of tuples</span>
<span class="sd">            The atom ids of dihedrals not involving hydrogens</span>
<span class="sd">        dihh : list of tuples</span>
<span class="sd">            The atom ids of dihedrals involving hydrogens</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dihedrals : :class:`Dihedrals`</span>
<span class="sd">            A :class:`Dihedrals` instance containing a list of all unique</span>
<span class="sd">            dihedrals as defined by the parm7 file</span>
<span class="sd">        impropers : :class:`Impropers`</span>
<span class="sd">            A :class:`Impropers` instance containing a list of all unique</span>
<span class="sd">            improper dihedrals as defined by the parm7 file</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        As detailed in `the specification`_, the dihedral sections</span>
<span class="sd">        of parm7 files contain information about both conventional dihedrals</span>
<span class="sd">        and impropers. The following must be accounted for:</span>
<span class="sd">        1) If the fourth atom in a dihedral entry is given a negative value,</span>
<span class="sd">        this indicates that it is an improper.</span>
<span class="sd">        2) If the third atom in a dihedral entry is given a negative value,</span>
<span class="sd">        this indicates that it 1-4 NB interactions are ignored for this</span>
<span class="sd">        dihedrals. This could be due to the dihedral within a ring, or if it is</span>
<span class="sd">        part of a multi-term dihedral definition or if it is an improper.</span>

<span class="sd">        .. _`the specification`: https://ambermd.org/FileFormats.php#topo.cntrl</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">improp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dihed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">diha</span><span class="p">,</span> <span class="n">dihh</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">improp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]),)</span><span class="o">+</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]),))</span>
            <span class="k">elif</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">i</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]),)</span> <span class="o">+</span> <span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
                <span class="n">dihed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dihed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">dihed</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dihed</span><span class="p">))</span>
        <span class="n">dihedrals</span> <span class="o">=</span> <span class="n">Dihedrals</span><span class="p">(</span><span class="n">dihed</span><span class="p">)</span>
        <span class="n">impropers</span> <span class="o">=</span> <span class="n">Impropers</span><span class="p">(</span><span class="n">improp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dihedrals</span><span class="p">,</span> <span class="n">impropers</span></div>


<div class="viewcode-block" id="TOPParser.parse_chainids">
<a class="viewcode-back" href="../../../documentation_pages/topology/TOPParser.html#MDAnalysis.topology.TOPParser.TOPParser.parse_chainids">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_chainids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_per_record</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">numlines</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the chainID of each residue</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_per_record : int</span>
<span class="sd">            The number of entries for each record in section (unused input)</span>
<span class="sd">        numlines : int</span>
<span class="sd">            The number of lines to be parsed in current section</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attr : numpy array</span>
<span class="sd">            A numpy array containing the chainID of each residue as defined in</span>
<span class="sd">            the parm7 file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsesection_mapper</span><span class="p">(</span><span class="n">numlines</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">attr</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2005-2023, Naveen Michaud-Agrawal, Elizabeth J. Denning, Christian Beckstein (logo), Joshua L. Adelman, Henok Ademtew, Shobhit Agarwal, Aya M. Alaa, Irfan Alibay, Kazi Shudipto Amin, Anshul Angaria, Luís Pedro Borges Araújo, Balasubramanian, Utkarsh Bansal, Patricio Barletta, Leonardo Barneschi, Jonathan Barnoud, Estefania Barreto-Ojeda, Tone Bengtsen, Alejandro Bernardin, Ninad Bhat, Mateusz Bieniek, Kavya Bisht, Wouter Boomsma, Jose Borreguero, Cédric Bouysset, Kevin Boyd, Meet Brijwani, Bart Bruininks, Sébastien Buchoux, Sören von Bülow, Yantong Cai, David Caplan, Yuanyu Chang, Pratham Chauhan, Matthieu Chavent, Haochuan Chen, Xu Hong Chen, Kathleen Clark, Jennifer A Clark, Orion Cohen, Charlie Cook, Ruggero Cortini, Nicholas Craven, Ramon Crehuet, Davide Cruz, Robert Delgado, John Detlefs, Xavier Deupi, Jan Domanski, David L. Dotson, Mark D. Driver, Ali Ehlen, Daniel J. Evans, Shujie Fan, Bjarne Feddersen, Lennard van der Feltz, Jake Fennick, Philip Fowler, Guillaume Fraux, Anirvinya G, Michael Gecht, Ahmed Salah Ghoneim, Mikhail Glagolev, William Glass, Joseph Goose, Alexander Gorfer, Richard J. Gowers, Lukas Grossar, Abhinav Gupta, Akshay Gupta, Pratik Gupta, Sumit Gupta, Benjamin Hall, Ameya Harmalkar, Ivan Hristov, Eugen Hruska, Kyle J. Huston, Siddharth Jain, Edis Jakupovic, Joe Jordan, Henrik Jäger, Uma D Kadam, Aditya Kamath, Jon Kapla, Ian M. Kenney, Haleema Khan, Navya Khare, Utsav Khatu, Andrew William King, Henry Kobin, Abhishek A. Kognole, Kosuke Kudo, Atharva Kulkarni, Manish Kumar, Mohit Kumar, Shubham Kumar, Alia Lescoulie, Max Linke, Philip Loche, Jinju Lu, Hugo MacDermott-Opeskin, Shaivi Malik, Egor Marin, Domenico Marson, Micaela Matta, Andrew R. McCluskey, Robert McGibbon, Rocco Meli, Manuel Nuno Melo, Marcelo C. R. Melo, Dominik &#39;Rathann&#39; Mierzejewski, Geongi Moon, Henry Mull, Morgan L. Nance, Fiona B. Naughton, Alex Nesterenko, Hai Nguyen, Sang Young Noh, Meghan Osato, Daniele Padula, Nabarun Pal, Mattia F. Palermo, Dimitrios Papageorgiou, Rafael R. Pappalardo, Vishal Parmar, Danny Parton, Shakul Pathak, Christian Pfaendner, Joshua L. Phillips, Marcelo D. Poleto, Hannah Pollak, Kashish Punjani, Michael Quevillon, Vedant Rathore, Tyler Reddy, Pedro Reis, Paul Rigor, Andrea Rizzi, Xiaoxu Ruan, Carlos Yanez S., Utkarsh Saxena, Moritz Schaeffler, Alexander Schlaich, Marcello Sega, Ricky Sexton, Sean L. Seyler, Faraaz Shah, Sulay Shah, Abhishek Shandilya, Shubham Sharma, Rishabh Shukla, Karthikeyan Singaravelan, Tamandeep Singh, Brigitta Sipőcz, Paul Smith, Andy Somogyi, Caio S. Souza, David van der Spoel, Shantanu Srivastava, Lukas Stelzl, Jan Stevens, Gorman Stock, Johannes Stöckelmaier, Fenil Suchak, Ayush Suhane, Filip T. Szczypiński, Sukeerti T, Matthijs Tadema, Joao Miguel Correia Teixeira, Paarth Thadani, Matthew W. Thompson, Hao Tian, Matteo Tiberti, Zaheer Timol, Wiep van der Toorn, Mieczyslaw Torchala, Aditi Tripathi, Heet Vekariya, Mark Verma, Josh Vermaas, Isaac Virshup, Lily Wang, Nestor Wendt, Zhiyi Wu, Tengyu Xie, Zhuyi Xue, Mingyi Xue, Alexander Yang, Juan Eiros Zamora, Johannes Zeman, Yibo Zhang, Raymond Zhao, Yuxuan Zhuang, and Oliver Beckstein.</p>
  </div>

  

<div class="footer"><p>Please see
    our <a href="https://www.mdanalysis.org/pages/privacy/">Privacy Policy</a>
    to learn how <a href="https://www.mdanalysis.org">MDAnalysis</a> collects data.</p>
    <script data-goatcounter="https://mdanalysis.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
</div>



</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
    var versions_json_url = 'https://docs.mdanalysis.org/versions.json'
</script>

<div class="rst-versions" data-toggle="rst-versions" role="note"
     aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"></span>
        2.7.0-dev0
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
        <dl id="versionselector">
            <dt>Other Versions</dt>
        </dl>

    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>