

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>MDAnalysis.analysis.hydrogenbonds.hbond_analysis &mdash; MDAnalysis 1.1.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/msmb.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../_static/mdanalysis-logo.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/javascript" src="../../../../_static/js/versions.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within MDAnalysis 1.1.1 documentation"
          href="../../../../_static/opensearch.xml"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../../../../index.html">
          

          
            
            <img src="../../../../_static/mdanalysis-logo-thin.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/overview.html">1. Overview over MDAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/topology.html">2. The topology system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/selections.html">3. Selection commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/analysis_modules.html">4. Analysis modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/topology_modules.html">5. Topology modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/coordinates_modules.html">6. Coordinates modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/converters.html">7. Converter modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/trajectory_transformations.html">8. Trajectory transformations (“on-the-fly” transformations)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/selections_modules.html">9. Selection exporters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/auxiliary_modules.html">10. Auxiliary modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/core_modules.html">11. Core modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/visualization_modules.html">12. Visualization modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/lib_modules.html">13. Library functions — <code class="docutils literal notranslate"><span class="pre">MDAnalysis.lib</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/version.html">14. Version information for MDAnalysis - <code class="docutils literal notranslate"><span class="pre">MDAnalysis.version</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/units.html">15. Constants and unit conversion — <code class="docutils literal notranslate"><span class="pre">MDAnalysis.units</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/exceptions.html">16. Custom exceptions and warnings — <code class="docutils literal notranslate"><span class="pre">MDAnalysis.exceptions</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/references.html">17. References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">MDAnalysis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>MDAnalysis.analysis.hydrogenbonds.hbond_analysis</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for MDAnalysis.analysis.hydrogenbonds.hbond_analysis</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- Mode: python; tab-width: 4; indent-tabs-mode:nil; coding:utf-8 -*-</span>
<span class="c1"># vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4</span>
<span class="c1">#</span>
<span class="c1"># MDAnalysis --- https://www.mdanalysis.org</span>
<span class="c1"># Copyright (c) 2006-2017 The MDAnalysis Development Team and contributors</span>
<span class="c1"># (see the file AUTHORS for the full list of names)</span>
<span class="c1">#</span>
<span class="c1"># Released under the GNU Public Licence, v2 or any higher version</span>
<span class="c1">#</span>
<span class="c1"># Please cite your use of MDAnalysis in published work:</span>
<span class="c1">#</span>
<span class="c1"># R. J. Gowers, M. Linke, J. Barnoud, T. J. E. Reddy, M. N. Melo, S. L. Seyler,</span>
<span class="c1"># D. L. Dotson, J. Domanski, S. Buchoux, I. M. Kenney, and O. Beckstein.</span>
<span class="c1"># MDAnalysis: A Python package for the rapid analysis of molecular dynamics</span>
<span class="c1"># simulations. In S. Benthall and S. Rostrup editors, Proceedings of the 15th</span>
<span class="c1"># Python in Science Conference, pages 102-109, Austin, TX, 2016. SciPy.</span>
<span class="c1"># doi: 10.25080/majora-629e541a-00e</span>
<span class="c1">#</span>
<span class="c1"># N. Michaud-Agrawal, E. J. Denning, T. B. Woolf, and O. Beckstein.</span>
<span class="c1"># MDAnalysis: A Toolkit for the Analysis of Molecular Dynamics Simulations.</span>
<span class="c1"># J. Comput. Chem. 32 (2011), 2319--2327, doi:10.1002/jcc.21787</span>
<span class="c1">#</span>

<span class="sd">&quot;&quot;&quot;Hydrogen Bond Analysis --- :mod:`MDAnalysis.analysis.hydrogenbonds.hbond_analysis`</span>
<span class="sd">=====================================================================================</span>

<span class="sd">:Author: Paul Smith</span>
<span class="sd">:Year: 2019</span>
<span class="sd">:Copyright: GNU Public License v3</span>

<span class="sd">.. versionadded:: 1.0.0</span>

<span class="sd">This module provides methods to find and analyse hydrogen bonds in a Universe.</span>

<span class="sd">The :class:`HydrogenBondAnalysis` class is a new version of the original</span>
<span class="sd">:class:`MDAnalysis.analysis.hbonds.HydrogenBondAnalysis` class from the module</span>
<span class="sd">:mod:`MDAnalysis.analysis.hbonds.hbond_analysis`, which itself was modeled after the `VMD</span>
<span class="sd">HBONDS plugin`_.</span>

<span class="sd">.. _`VMD HBONDS plugin`: http://www.ks.uiuc.edu/Research/vmd/plugins/hbonds/</span>


<span class="sd">Input</span>
<span class="sd">------</span>

<span class="sd">Required:</span>
<span class="sd">  - *universe* : an MDAnalysis Universe object</span>

<span class="sd">Options:</span>
<span class="sd">  - *donors_sel* [None] : Atom selection for donors. If `None`, then will be identified via the topology.</span>
<span class="sd">  - *hydrogens_sel* [None] : Atom selection for hydrogens. If `None`, then will be identified via charge and mass.</span>
<span class="sd">  - *acceptors_sel* [None] : Atom selection for acceptors. If `None`, then will be identified via charge.</span>
<span class="sd">  - *d_h_cutoff* (Å) [1.2] : Distance cutoff used for finding donor-hydrogen pairs</span>
<span class="sd">  - *d_a_cutoff* (Å) [3.0] : Distance cutoff for hydrogen bonds. This cutoff refers to the D-A distance.</span>
<span class="sd">  - *d_h_a_angle_cutoff* (degrees) [150] : D-H-A angle cutoff for hydrogen bonds.</span>
<span class="sd">  - *update_selections* [True] : If true, will update atom selections at each frame.</span>


<span class="sd">Output</span>
<span class="sd">------</span>

<span class="sd">  - *frame* : frame at which a hydrogen bond was found</span>
<span class="sd">  - *donor id* : atom id of the hydrogen bond donor atom</span>
<span class="sd">  - *hydrogen id* : atom id of the hydrogen bond hydrogen atom</span>
<span class="sd">  - *acceptor id* : atom id of the hydrogen bond acceptor atom</span>
<span class="sd">  - *distance* (Å): length of the hydrogen bond</span>
<span class="sd">  - *angle* (degrees): angle of the hydrogen bond</span>

<span class="sd">Hydrogen bond data are returned in a :class:`numpy.ndarray` on a &quot;one line, one observation&quot; basis</span>
<span class="sd">and can be accessed via :attr:`HydrogenBondAnalysis.hbonds`::</span>

<span class="sd">    results = [</span>
<span class="sd">        [</span>
<span class="sd">            &lt;frame&gt;,</span>
<span class="sd">            &lt;donor index (0-based)&gt;,</span>
<span class="sd">            &lt;hydrogen index (0-based)&gt;,</span>
<span class="sd">            &lt;acceptor index (0-based)&gt;,</span>
<span class="sd">            &lt;distance&gt;,</span>
<span class="sd">            &lt;angle&gt;</span>
<span class="sd">        ],</span>
<span class="sd">        ...</span>
<span class="sd">    ]</span>

<span class="sd">Example use of :class:`HydrogenBondAnalysis`</span>
<span class="sd">--------------------------------------------</span>

<span class="sd">The simplest use case is to allow :class:`HydrogenBondAnalysis` to guess the acceptor and hydrogen atoms, and to</span>
<span class="sd">identify donor-hydrogen pairs via the bonding information in the topology::</span>

<span class="sd">  import MDAnalysis</span>
<span class="sd">  from MDAnalysis.analysis.hydrogenbonds.hbond_analysis import HydrogenBondAnalysis as HBA</span>

<span class="sd">  u = MDAnalysis.Universe(psf, trajectory)</span>

<span class="sd">  hbonds = HBA(universe=u)</span>
<span class="sd">  hbonds.run()</span>

<span class="sd">It is also possible to specify which hydrogens and acceptors to use in the analysis. For example, to find all hydrogen</span>
<span class="sd">bonds in water::</span>

<span class="sd">  import MDAnalysis</span>
<span class="sd">  from MDAnalysis.analysis.hydrogenbonds.hbond_analysis import HydrogenBondAnalysis as HBA</span>

<span class="sd">  u = MDAnalysis.Universe(psf, trajectory)</span>

<span class="sd">  hbonds = HBA(universe=u, hydrogens_sel=&#39;resname TIP3 and name H1 H2&#39;, acceptors_sel=&#39;resname TIP3 and name OH2&#39;)</span>
<span class="sd">  hbonds.run()</span>

<span class="sd">Alternatively, :attr:`hydrogens_sel` and :attr:`acceptors_sel` may be generated via the :attr:`guess_hydrogens` and</span>
<span class="sd">:attr:`guess_acceptors`. This selection strings may then be modified prior to calling :attr:`run`, or a subset of</span>
<span class="sd">the universe may be used to guess the atoms. For example, find hydrogens and acceptors belonging to a protein::</span>

<span class="sd">  import MDAnalysis</span>
<span class="sd">  from MDAnalysis.analysis.hydrogenbonds.hbond_analysis import HydrogenBondAnalysis as HBA</span>

<span class="sd">  u = MDAnalysis.Universe(psf, trajectory)</span>

<span class="sd">  hbonds = HBA(universe=u)</span>
<span class="sd">  hbonds.hydrogens_sel = hbonds.guess_hydrogens(&quot;protein&quot;)</span>
<span class="sd">  hbonds.acceptors_sel = hbonds.guess_acceptors(&quot;protein&quot;)</span>
<span class="sd">  hbonds.run()</span>

<span class="sd">Slightly more complex selection strings are also possible. For example, to find hydrogen bonds involving a protein and</span>
<span class="sd">any water molecules within 10 Å of the protein (which may be useful for subsequently finding the lifetime of</span>
<span class="sd">protein-water hydrogen bonds or finding water-bridging hydrogen bond paths)::</span>

<span class="sd">  import MDAnalysis</span>
<span class="sd">  from MDAnalysis.analysis.hydrogenbonds.hbond_analysis import HydrogenBondAnalysis as HBA</span>

<span class="sd">  u = MDAnalysis.Universe(psf, trajectory)</span>

<span class="sd">  hbonds = HBA(universe=u)</span>

<span class="sd">  protein_hydrogens_sel = hbonds.guess_hydrogens(&quot;protein&quot;)</span>
<span class="sd">  protein_acceptors_sel = hbonds.guess_acceptors(&quot;protein&quot;)</span>

<span class="sd">  water_hydrogens_sel = &quot;resname TIP3 and name H1 H2&quot;</span>
<span class="sd">  water_acceptors_sel = &quot;resname TIP3 and name OH2&quot;</span>

<span class="sd">  hbonds.hydrogens_sel = f&quot;({protein_hydrogens_sel}) or ({water_hydrogens_sel} and around 10 not resname TIP3})&quot;</span>
<span class="sd">  hbonds.acceptors_sel = f&quot;({protein_acceptors_sel}) or ({water_acceptors_sel} and around 10 not resname TIP3})&quot;</span>
<span class="sd">  hbonds.run()</span>

<span class="sd">It is highly recommended that a topology with bonding information is used to generate the universe, e.g `PSF`, `TPR`, or</span>
<span class="sd">`PRMTOP` files. This is the only method by which it can be guaranteed that donor-hydrogen pairs are correctly identified.</span>
<span class="sd">However, if, for example, a `PDB` file is used instead, a :attr:`donors_sel` may be provided along with a</span>
<span class="sd">:attr:`hydrogens_sel` and the donor-hydrogen pairs will be identified via a distance cutoff, :attr:`d_h_cutoff`::</span>

<span class="sd">  import MDAnalysis</span>
<span class="sd">  from MDAnalysis.analysis.hydrogenbonds.hbond_analysis import HydrogenBondAnalysis as HBA</span>

<span class="sd">  u = MDAnalysis.Universe(pdb, trajectory)</span>

<span class="sd">  hbonds = HBA(</span>
<span class="sd">    universe=u,</span>
<span class="sd">    donors_sel=&#39;resname TIP3 and name OH2&#39;,</span>
<span class="sd">    hydrogens_sel=&#39;resname TIP3 and name H1 H2&#39;,</span>
<span class="sd">    acceptors_sel=&#39;resname TIP3 and name OH2&#39;,</span>
<span class="sd">    d_h_cutoff=1.2</span>
<span class="sd">  )</span>
<span class="sd">  hbonds.run()</span>

<span class="sd">The class and its methods</span>
<span class="sd">-------------------------</span>

<span class="sd">.. autoclass:: HydrogenBondAnalysis</span>
<span class="sd">   :members:</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">base</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.lib.distances</span> <span class="kn">import</span> <span class="n">capped_distance</span><span class="p">,</span> <span class="n">calc_angles</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.exceptions</span> <span class="kn">import</span> <span class="n">NoDataError</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.core.groups</span> <span class="kn">import</span> <span class="n">AtomGroup</span>

<span class="kn">from</span> <span class="nn">...due</span> <span class="kn">import</span> <span class="n">due</span><span class="p">,</span> <span class="n">Doi</span>

<span class="n">due</span><span class="o">.</span><span class="n">cite</span><span class="p">(</span><span class="n">Doi</span><span class="p">(</span><span class="s2">&quot;10.1039/C9CP01532A&quot;</span><span class="p">),</span>
         <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Hydrogen bond analysis implementation&quot;</span><span class="p">,</span>
         <span class="n">path</span><span class="o">=</span><span class="s2">&quot;MDAnalysis.analysis.hydrogenbonds.hbond_analysis&quot;</span><span class="p">,</span>
         <span class="n">cite_module</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">del</span> <span class="n">Doi</span>


<div class="viewcode-block" id="HydrogenBondAnalysis"><a class="viewcode-back" href="../../../../documentation_pages/analysis/hydrogenbonds.html#MDAnalysis.analysis.hydrogenbonds.hbond_analysis.HydrogenBondAnalysis">[docs]</a><span class="k">class</span> <span class="nc">HydrogenBondAnalysis</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">AnalysisBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform an analysis of hydrogen bonds in a Universe.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">universe</span><span class="p">,</span> <span class="n">donors_sel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hydrogens_sel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">acceptors_sel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">d_h_cutoff</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">d_a_cutoff</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">d_h_a_angle_cutoff</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">update_selections</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set up atom selections and geometric criteria for finding hydrogen bonds in a Universe.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        universe : Universe</span>
<span class="sd">            MDAnalysis Universe object</span>
<span class="sd">        donors_sel : str</span>
<span class="sd">            Selection string for the hydrogen bond donor atoms. If the universe topology contains bonding information,</span>
<span class="sd">            leave :attr:`donors_sel` as `None` so that donor-hydrogen pairs can be correctly identified.</span>
<span class="sd">        hydrogens_sel :  str</span>
<span class="sd">            Selection string for the hydrogen bond hydrogen atoms. Leave as `None` to guess which hydrogens to use in</span>
<span class="sd">            the analysis using :attr:`guess_hydrogens`. If :attr:`hydrogens_sel` is left as `None`, also leave</span>
<span class="sd">            :attr:`donors_sel` as None so that donor-hydrogen pairs can be correctly identified.</span>
<span class="sd">        acceptors_sel : str</span>
<span class="sd">            Selection string for the hydrogen bond acceptor atoms. Leave as `None` to guess which atoms to use in the</span>
<span class="sd">            analysis using :attr:`guess_acceptors`</span>
<span class="sd">        d_h_cutoff : float (optional)</span>
<span class="sd">            Distance cutoff used for finding donor-hydrogen pairs [1.2]. Only used to find donor-hydrogen pairs if the</span>
<span class="sd">            universe topology does not contain bonding information</span>
<span class="sd">        d_a_cutoff : float (optional)</span>
<span class="sd">            Distance cutoff for hydrogen bonds. This cutoff refers to the D-A distance. [3.0]</span>
<span class="sd">        d_h_a_angle_cutoff: float (optional)</span>
<span class="sd">            D-H-A angle cutoff for hydrogen bonds, in degrees. [150]</span>
<span class="sd">        update_selections: bool (optional)</span>
<span class="sd">            Whether or not to update the acceptor, donor and hydrogen lists at each frame. [True]</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>

<span class="sd">        It is highly recommended that a universe topology with bonding information is used, as this is the only way</span>
<span class="sd">        that guarantees the correct identification of donor-hydrogen pairs.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">universe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trajectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">trajectory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">donors_sel</span> <span class="o">=</span> <span class="n">donors_sel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hydrogens_sel</span> <span class="o">=</span> <span class="n">hydrogens_sel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acceptors_sel</span> <span class="o">=</span> <span class="n">acceptors_sel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_h_cutoff</span> <span class="o">=</span> <span class="n">d_h_cutoff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_a_cutoff</span> <span class="o">=</span> <span class="n">d_a_cutoff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_h_a_angle</span> <span class="o">=</span> <span class="n">d_h_a_angle_cutoff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_selections</span> <span class="o">=</span> <span class="n">update_selections</span>

<div class="viewcode-block" id="HydrogenBondAnalysis.guess_hydrogens"><a class="viewcode-back" href="../../../../documentation_pages/analysis/hydrogenbonds.html#MDAnalysis.analysis.hydrogenbonds.hbond_analysis.HydrogenBondAnalysis.guess_hydrogens">[docs]</a>    <span class="k">def</span> <span class="nf">guess_hydrogens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">select</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
                        <span class="n">max_mass</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span>
                        <span class="n">min_charge</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                        <span class="n">min_mass</span><span class="o">=</span><span class="mf">0.9</span>
                        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Guesses which hydrogen atoms should be used in the analysis.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        select: str (optional)</span>
<span class="sd">            Selection string for atom group from which hydrogens will be identified.</span>
<span class="sd">        max_mass: float (optional)</span>
<span class="sd">            Maximum allowed mass of a hydrogen atom.</span>
<span class="sd">        min_charge: float (optional)</span>
<span class="sd">            Minimum allowed charge of a hydrogen atom.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        potential_hydrogens: str</span>
<span class="sd">            String containing the :attr:`resname` and :attr:`name` of all hydrogen atoms potentially capable of forming</span>
<span class="sd">            hydrogen bonds.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function makes use of atomic masses and atomic charges to identify which atoms are hydrogen atoms that are</span>
<span class="sd">        capable of participating in hydrogen bonding. If an atom has a mass less than :attr:`max_mass` and an atomic</span>
<span class="sd">        charge greater than :attr:`min_charge` then it is considered capable of participating in hydrogen bonds.</span>

<span class="sd">        If :attr:`hydrogens_sel` is `None`, this function is called to guess the selection.</span>

<span class="sd">        Alternatively, this function may be used to quickly generate a :class:`str` of potential hydrogen atoms involved</span>
<span class="sd">        in hydrogen bonding. This str may then be modified before being used to set the attribute</span>
<span class="sd">        :attr:`hydrogens_sel`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">min_mass</span> <span class="o">&gt;</span> <span class="n">max_mass</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;min_mass is higher than (or equal to) max_mass&quot;</span><span class="p">)</span>

        <span class="n">ag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="n">select</span><span class="p">)</span>
        <span class="n">hydrogens_ag</span> <span class="o">=</span> <span class="n">ag</span><span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">((</span>
                <span class="n">ag</span><span class="o">.</span><span class="n">masses</span> <span class="o">&lt;</span> <span class="n">max_mass</span><span class="p">,</span>
                <span class="n">ag</span><span class="o">.</span><span class="n">charges</span> <span class="o">&gt;</span> <span class="n">min_charge</span><span class="p">,</span>
                <span class="n">ag</span><span class="o">.</span><span class="n">masses</span> <span class="o">&gt;</span> <span class="n">min_mass</span><span class="p">,</span>
            <span class="p">))</span>
        <span class="p">]</span>

        <span class="n">hydrogens_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s1">&#39;(resname </span><span class="si">{}</span><span class="s1"> and name </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hydrogens_ag</span><span class="o">.</span><span class="n">resnames</span><span class="p">,</span> <span class="n">hydrogens_ag</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot; or &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hydrogens_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="HydrogenBondAnalysis.guess_donors"><a class="viewcode-back" href="../../../../documentation_pages/analysis/hydrogenbonds.html#MDAnalysis.analysis.hydrogenbonds.hbond_analysis.HydrogenBondAnalysis.guess_donors">[docs]</a>    <span class="k">def</span> <span class="nf">guess_donors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">max_charge</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Guesses which atoms could be considered donors in the analysis. Only use if the universe topology does not</span>
<span class="sd">        contain bonding information, otherwise donor-hydrogen pairs may be incorrectly assigned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        select: str (optional)</span>
<span class="sd">            Selection string for atom group from which donors will be identified.</span>
<span class="sd">        max_charge: float (optional)</span>
<span class="sd">            Maximum allowed charge of a donor atom.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        potential_donors: str</span>
<span class="sd">            String containing the :attr:`resname` and :attr:`name` of all atoms that potentially capable of forming</span>
<span class="sd">            hydrogen bonds.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function makes use of and atomic charges to identify which atoms could be considered donor atoms in the</span>
<span class="sd">        hydrogen bond analysis. If an atom has an atomic charge less than :attr:`max_charge`, and it is within</span>
<span class="sd">        :attr:`d_h_cutoff` of a hydrogen atom, then it is considered capable of participating in hydrogen bonds.</span>

<span class="sd">        If :attr:`donors_sel` is `None`, and the universe topology does not have bonding information, this function is</span>
<span class="sd">        called to guess the selection.</span>

<span class="sd">        Alternatively, this function may be used to quickly generate a :class:`str` of potential donor atoms involved</span>
<span class="sd">        in hydrogen bonding. This :class:`str` may then be modified before being used to set the attribute</span>
<span class="sd">        :attr:`donors_sel`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># We need to know `hydrogens_sel` before we can find donors</span>
        <span class="c1"># Use a new variable `hydrogens_sel` so that we do not set `self.hydrogens_sel` if it is currently `None`</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hydrogens_sel</span><span class="p">:</span>
            <span class="n">hydrogens_sel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_hydrogens</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hydrogens_sel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hydrogens_sel</span>
        <span class="n">hydrogens_ag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="n">hydrogens_sel</span><span class="p">)</span>

        <span class="n">ag</span> <span class="o">=</span> <span class="n">hydrogens_ag</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span>
            <span class="s2">&quot;(</span><span class="si">{donors_sel}</span><span class="s2">) and around </span><span class="si">{d_h_cutoff}</span><span class="s2"> </span><span class="si">{hydrogens_sel}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">donors_sel</span><span class="o">=</span><span class="n">select</span><span class="p">,</span>
                <span class="n">d_h_cutoff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d_h_cutoff</span><span class="p">,</span>
                <span class="n">hydrogens_sel</span><span class="o">=</span><span class="n">hydrogens_sel</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">donors_ag</span> <span class="o">=</span> <span class="n">ag</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">charges</span> <span class="o">&lt;</span> <span class="n">max_charge</span><span class="p">]</span>
        <span class="n">donors_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s1">&#39;(resname </span><span class="si">{}</span><span class="s1"> and name </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">donors_ag</span><span class="o">.</span><span class="n">resnames</span><span class="p">,</span> <span class="n">donors_ag</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot; or &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">donors_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="HydrogenBondAnalysis.guess_acceptors"><a class="viewcode-back" href="../../../../documentation_pages/analysis/hydrogenbonds.html#MDAnalysis.analysis.hydrogenbonds.hbond_analysis.HydrogenBondAnalysis.guess_acceptors">[docs]</a>    <span class="k">def</span> <span class="nf">guess_acceptors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">max_charge</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Guesses which atoms could be considered acceptors in the analysis.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        select: str (optional)</span>
<span class="sd">            Selection string for atom group from which acceptors will be identified.</span>
<span class="sd">        max_charge: float (optional)</span>
<span class="sd">            Maximum allowed charge of an acceptor atom.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        potential_acceptors: str</span>
<span class="sd">            String containing the :attr:`resname` and :attr:`name` of all atoms that potentially capable of forming</span>
<span class="sd">            hydrogen bonds.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function makes use of and atomic charges to identify which atoms could be considered acceptor atoms in the</span>
<span class="sd">        hydrogen bond analysis. If an atom has an atomic charge less than :attr:`max_charge` then it is considered</span>
<span class="sd">        capable of participating in hydrogen bonds.</span>

<span class="sd">        If :attr:`acceptors_sel` is `None`, this function is called to guess the selection.</span>

<span class="sd">        Alternatively, this function may be used to quickly generate a :class:`str` of potential acceptor atoms involved</span>
<span class="sd">        in hydrogen bonding. This :class:`str` may then be modified before being used to set the attribute</span>
<span class="sd">        :attr:`acceptors_sel`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="n">select</span><span class="p">)</span>
        <span class="n">acceptors_ag</span> <span class="o">=</span> <span class="n">ag</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">charges</span> <span class="o">&lt;</span> <span class="n">max_charge</span><span class="p">]</span>
        <span class="n">acceptors_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s1">&#39;(resname </span><span class="si">{}</span><span class="s1"> and name </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">acceptors_ag</span><span class="o">.</span><span class="n">resnames</span><span class="p">,</span> <span class="n">acceptors_ag</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot; or &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acceptors_list</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_dh_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds donor-hydrogen pairs.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        donors, hydrogens: AtomGroup, AtomGroup</span>
<span class="sd">            AtomGroups corresponding to all donors and all hydrogens. AtomGroups are ordered such that, if zipped, will</span>
<span class="sd">            produce a list of donor-hydrogen pairs.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If donors_sel is not provided, use topology to find d-h pairs</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">donors_sel</span><span class="p">:</span>

            <span class="c1"># We&#39;re using u._topology.bonds rather than u.bonds as it is a million times faster to access.</span>
            <span class="c1"># This is because u.bonds also calculates properties of each bond (e.g bond length).</span>
            <span class="c1"># See https://github.com/MDAnalysis/mdanalysis/issues/2396#issuecomment-596251787</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">_topology</span><span class="p">,</span> <span class="s1">&#39;bonds&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">bonds</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">NoDataError</span><span class="p">(</span><span class="s1">&#39;Cannot assign donor-hydrogen pairs via topology as no bond information is present. &#39;</span>
                                  <span class="s1">&#39;Please either: load a topology file with bond information; use the guess_bonds() &#39;</span>
                                  <span class="s1">&#39;topology guesser; or set HydrogenBondAnalysis.donors_sel so that a distance cutoff &#39;</span>
                                  <span class="s1">&#39;can be used.&#39;</span><span class="p">)</span>

            <span class="n">hydrogens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hydrogens_sel</span><span class="p">)</span>
            <span class="n">donors</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">bonded_atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hydrogens</span><span class="p">)</span> <span class="k">if</span> <span class="n">hydrogens</span> \
                <span class="k">else</span> <span class="n">AtomGroup</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">)</span>

        <span class="c1"># Otherwise, use d_h_cutoff as a cutoff distance</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">hydrogens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hydrogens_sel</span><span class="p">)</span>
            <span class="n">donors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">donors_sel</span><span class="p">)</span>
            <span class="n">donors_indices</span><span class="p">,</span> <span class="n">hydrogen_indices</span> <span class="o">=</span> <span class="n">capped_distance</span><span class="p">(</span>
                <span class="n">donors</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span>
                <span class="n">hydrogens</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span>
                <span class="n">max_cutoff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d_h_cutoff</span><span class="p">,</span>
                <span class="n">box</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span>
                <span class="n">return_distances</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span><span class="o">.</span><span class="n">T</span>

            <span class="n">donors</span> <span class="o">=</span> <span class="n">donors</span><span class="p">[</span><span class="n">donors_indices</span><span class="p">]</span>
            <span class="n">hydrogens</span> <span class="o">=</span> <span class="n">hydrogens</span><span class="p">[</span><span class="n">hydrogen_indices</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">donors</span><span class="p">,</span> <span class="n">hydrogens</span>

    <span class="k">def</span> <span class="nf">_prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbonds</span> <span class="o">=</span> <span class="p">[[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]]</span>

        <span class="c1"># Set atom selections if they have not been provided</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptors_sel</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acceptors_sel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_acceptors</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hydrogens_sel</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hydrogens_sel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_hydrogens</span><span class="p">()</span>

        <span class="c1"># Select atom groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acceptors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptors_sel</span><span class="p">,</span>
                                              <span class="n">updating</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update_selections</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_donors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hydrogens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dh_pairs</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_single_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="o">.</span><span class="n">dimensions</span>

        <span class="c1"># Update donor-hydrogen pairs if necessary</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_selections</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_donors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hydrogens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dh_pairs</span><span class="p">()</span>

        <span class="c1"># find D and A within cutoff distance of one another</span>
        <span class="c1"># min_cutoff = 1.0 as an atom cannot form a hydrogen bond with itself</span>
        <span class="n">d_a_indices</span><span class="p">,</span> <span class="n">d_a_distances</span> <span class="o">=</span> <span class="n">capped_distance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_donors</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_acceptors</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span>
            <span class="n">max_cutoff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d_a_cutoff</span><span class="p">,</span>
            <span class="n">min_cutoff</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">box</span><span class="o">=</span><span class="n">box</span><span class="p">,</span>
            <span class="n">return_distances</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Remove D-A pairs more than d_a_cutoff away from one another</span>
        <span class="n">tmp_donors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_donors</span><span class="p">[</span><span class="n">d_a_indices</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">tmp_hydrogens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hydrogens</span><span class="p">[</span><span class="n">d_a_indices</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">tmp_acceptors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acceptors</span><span class="p">[</span><span class="n">d_a_indices</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="c1"># Find D-H-A angles greater than d_h_a_angle_cutoff</span>
        <span class="n">d_h_a_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span>
            <span class="n">calc_angles</span><span class="p">(</span>
                <span class="n">tmp_donors</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span>
                <span class="n">tmp_hydrogens</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span>
                <span class="n">tmp_acceptors</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span>
                <span class="n">box</span><span class="o">=</span><span class="n">box</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">hbond_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">d_h_a_angles</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_h_a_angle</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Retrieve atoms, distances and angles of hydrogen bonds</span>
        <span class="n">hbond_donors</span> <span class="o">=</span> <span class="n">tmp_donors</span><span class="p">[</span><span class="n">hbond_indices</span><span class="p">]</span>
        <span class="n">hbond_hydrogens</span> <span class="o">=</span> <span class="n">tmp_hydrogens</span><span class="p">[</span><span class="n">hbond_indices</span><span class="p">]</span>
        <span class="n">hbond_acceptors</span> <span class="o">=</span> <span class="n">tmp_acceptors</span><span class="p">[</span><span class="n">hbond_indices</span><span class="p">]</span>
        <span class="n">hbond_distances</span> <span class="o">=</span> <span class="n">d_a_distances</span><span class="p">[</span><span class="n">hbond_indices</span><span class="p">]</span>
        <span class="n">hbond_angles</span> <span class="o">=</span> <span class="n">d_h_a_angles</span><span class="p">[</span><span class="n">hbond_indices</span><span class="p">]</span>

        <span class="c1"># Store data on hydrogen bonds found at this frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbonds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">hbond_donors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="o">.</span><span class="n">frame</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbonds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">hbond_donors</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbonds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">hbond_hydrogens</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbonds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">hbond_acceptors</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbonds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">hbond_distances</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbonds</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">hbond_angles</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_conclude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hbonds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hbonds</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<div class="viewcode-block" id="HydrogenBondAnalysis.count_by_time"><a class="viewcode-back" href="../../../../documentation_pages/analysis/hydrogenbonds.html#MDAnalysis.analysis.hydrogenbonds.hbond_analysis.HydrogenBondAnalysis.count_by_time">[docs]</a>    <span class="k">def</span> <span class="nf">count_by_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Counts the number of hydrogen bonds per timestep.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        counts : numpy.ndarray</span>
<span class="sd">             Contains the total number of hydrogen bonds found at each timestep.</span>
<span class="sd">             Can be used along with :attr:`HydrogenBondAnalysis.times` to plot</span>
<span class="sd">             the number of hydrogen bonds over time.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">indices</span><span class="p">,</span> <span class="n">tmp_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hbonds</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                        <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">indices</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
        <span class="n">indices</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>

        <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">)</span>
        <span class="n">counts</span><span class="p">[</span><span class="n">indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tmp_counts</span>
        <span class="k">return</span> <span class="n">counts</span></div>

<div class="viewcode-block" id="HydrogenBondAnalysis.count_by_type"><a class="viewcode-back" href="../../../../documentation_pages/analysis/hydrogenbonds.html#MDAnalysis.analysis.hydrogenbonds.hbond_analysis.HydrogenBondAnalysis.count_by_type">[docs]</a>    <span class="k">def</span> <span class="nf">count_by_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Counts the total number of each unique type of hydrogen bond.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        counts : numpy.ndarray</span>
<span class="sd">             Each row of the array contains the donor resname, donor atom type, acceptor resname, acceptor atom type and</span>
<span class="sd">             the total number of times the hydrogen bond was found.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Unique hydrogen bonds are determined through a consideration of the resname and atom type of the donor and</span>
<span class="sd">        acceptor atoms in a hydrogen bond.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hbonds</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intp</span><span class="p">)]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hbonds</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intp</span><span class="p">)]</span>

        <span class="n">tmp_hbonds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d</span><span class="o">.</span><span class="n">resnames</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">types</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">resnames</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">types</span><span class="p">],</span>
                              <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">hbond_type</span><span class="p">,</span> <span class="n">type_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">tmp_hbonds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">hbond_type_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">hb_type</span><span class="p">,</span> <span class="n">hb_count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hbond_type</span><span class="p">,</span> <span class="n">type_counts</span><span class="p">):</span>
            <span class="n">hbond_type_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hb_type</span><span class="p">[:</span><span class="mi">2</span><span class="p">]),</span>
                                    <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hb_type</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]),</span> <span class="n">hb_count</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hbond_type_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="HydrogenBondAnalysis.count_by_ids"><a class="viewcode-back" href="../../../../documentation_pages/analysis/hydrogenbonds.html#MDAnalysis.analysis.hydrogenbonds.hbond_analysis.HydrogenBondAnalysis.count_by_ids">[docs]</a>    <span class="k">def</span> <span class="nf">count_by_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Counts the total number hydrogen bonds formed by unique combinations of donor, hydrogen and acceptor atoms.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        counts : numpy.ndarray</span>
<span class="sd">             Each row of the array contains the donor atom id, hydrogen atom id, acceptor atom id and the total number</span>
<span class="sd">             of times the hydrogen bond was observed. The array is sorted by frequency of occurrence.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Unique hydrogen bonds are determined through a consideration of the hydrogen atom id and acceptor atom id</span>
<span class="sd">        in a hydrogen bond.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hbonds</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intp</span><span class="p">)]</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hbonds</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intp</span><span class="p">)]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hbonds</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intp</span><span class="p">)]</span>

        <span class="n">tmp_hbonds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ids</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">hbond_ids</span><span class="p">,</span> <span class="n">ids_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tmp_hbonds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                          <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Find unique hbonds and sort rows so that most frequent observed bonds are at the top of the array</span>
        <span class="n">unique_hbonds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">hbond_ids</span><span class="p">,</span> <span class="n">ids_counts</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]),</span>
                                       <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">unique_hbonds</span> <span class="o">=</span> <span class="n">unique_hbonds</span><span class="p">[</span><span class="n">unique_hbonds</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

        <span class="k">return</span> <span class="n">unique_hbonds</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2005-2021, Naveen Michaud-Agrawal, Elizabeth J. Denning, Christian Beckstein (logo), Joshua L. Adelman, Shobhit Agarwal, Irfan Alibay, Anshul Angaria, Luís Pedro Borges Araújo, Balasubramanian, Utkarsh Bansal, Jonathan Barnoud, Tone Bengtsen, Alejandro Bernardin, Ninad Bhat, Mateusz Bieniek, Wouter Boomsma, Jose Borreguero, Cédric Bouysset, Bart Bruininks, Sébastien Buchoux, Sören von Bülow, David Caplan, Yuanyu Chang, Matthieu Chavent, Haochuan Chen, Kathleen Clark, Charlie Cook, Ruggero Cortini, Nicholas Craven, Ramon Crehuet, Davide Cruz, Robert Delgado, John Detlefs, Xavier Deupi, Jan Domanski, David L. Dotson, Ali Ehlen, Shujie Fan, Lennard van der Feltz, Philip Fowler, Guillaume Fraux, William Glass, Joseph Goose, Richard J. Gowers, Lukas Grossar, Abhinav Gupta, Akshay Gupta, Benjamin Hall, Ameya Harmalkar, Ivan Hristov, Eugen Hruska, Kyle J. Huston, Siddharth Jain, Joe Jordan, Jon Kapla, Navya Khare, Andrew William King, Abhishek A. Kognole, Max Linke, Philip Loche, Jinju Lu, Hugo MacDermott-Opeskin, Micaela Matta, Andrew R. McCluskey, Robert McGibbon, Rocco Meli, Manuel Nuno Melo, Dominik &#39;Rathann&#39; Mierzejewski, Henry Mull, Morgan L. Nance, Fiona B. Naughton, Alex Nesterenko, Hai Nguyen, Sang Young Noh, Daniele Padula, Nabarun Pal, Mattia F. Palermo, Danny Parton, Shakul Pathak, Joshua L. Phillips, Kashish Punjani, Michael Quevillon, Vedant Rathore, Tyler Reddy, Pedro Reis, Paul Rigor, Andrea Rizzi, Carlos Yanez S., Utkarsh Saxena, Marcello Sega, Sean L. Seyler, Faraaz Shah, Abhishek Shandilya, Shubham Sharma, Paul Smith, Andy Somogyi, Caio S. Souza, Shantanu Srivastava, Lukas Stelzl, Gorman Stock, Fenil Suchak, Ayush Suhane, Matthijs Tadema, Joao Miguel Correia Teixeira, Xiki Tempula, Matthew W. Thompson, Hao Tian, Matteo Tiberti, Wiep van der Toorn, Isaac Virshup, Lily Wang, Nestor Wendt, Zhiyi Wu, Zhuyi Xue, Juan Eiros Zamora, Johannes Zeman, Yibo Zhang, Yuxuan Zhuang, and Oliver Beckstein.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  <script>
    var versions_json_url = 'https://docs.mdanalysis.org/versions.json'
</script>

<div class="rst-versions" data-toggle="rst-versions" role="note"
     aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"></span>
        1.1.1
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
        <dl id="versionselector">
            <dt>Other Versions</dt>
        </dl>

    </div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>