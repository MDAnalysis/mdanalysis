<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MDAnalysis.coordinates.TNG &mdash; MDAnalysis 2.5.0-dev0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/msmb.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/mdanalysis-logo.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/js/versions.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within MDAnalysis 2.5.0-dev0 documentation"
          href="../../../_static/opensearch.xml"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/mdanalysis-logo-thin.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.5.0-dev0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/overview.html">1. Overview over MDAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/topology.html">2. The topology system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/selections.html">3. Selection commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/analysis_modules.html">4. Analysis modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/topology_modules.html">5. Topology modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/coordinates_modules.html">6. Coordinates modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/converters.html">7. Converter modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/trajectory_transformations.html">8. Trajectory transformations (“on-the-fly” transformations)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/selections_modules.html">9. Selection exporters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/auxiliary_modules.html">10. Auxiliary modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/core_modules.html">11. Core modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/visualization_modules.html">12. Visualization modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/lib_modules.html">13. Library functions — <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.lib</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/version.html">14. Version information for MDAnalysis - <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.version</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/units.html">15. Constants and unit conversion — <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.units</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/exceptions.html">16. Custom exceptions and warnings — <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.exceptions</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/references.html">17. References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MDAnalysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">MDAnalysis.coordinates.TNG</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for MDAnalysis.coordinates.TNG</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- Mode: python; tab-width: 4; indent-tabs-mode:nil; coding:utf-8 -*-</span>
<span class="c1"># vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4</span>
<span class="c1">#</span>
<span class="c1"># MDAnalysis --- https://www.mdanalysis.org</span>
<span class="c1"># Copyright (c) 2006-2017 The MDAnalysis Development Team and contributors</span>
<span class="c1"># (see the file AUTHORS for the full list of names)</span>
<span class="c1">#</span>
<span class="c1"># Released under the GNU Public Licence, v2 or any higher version</span>
<span class="c1">#</span>
<span class="c1"># Please cite your use of MDAnalysis in published work:</span>
<span class="c1">#</span>
<span class="c1"># R. J. Gowers, M. Linke, J. Barnoud, T. J. E. Reddy, M. N. Melo, S. L. Seyler,</span>
<span class="c1"># D. L. Dotson, J. Domanski, S. Buchoux, I. M. Kenney, and O. Beckstein.</span>
<span class="c1"># MDAnalysis: A Python package for the rapid analysis of molecular dynamics</span>
<span class="c1"># simulations. In S. Benthall and S. Rostrup editors, Proceedings of the 15th</span>
<span class="c1"># Python in Science Conference, pages 102-109, Austin, TX, 2016. SciPy.</span>
<span class="c1"># doi: 10.25080/majora-629e541a-00e</span>
<span class="c1">#</span>
<span class="c1"># N. Michaud-Agrawal, E. J. Denning, T. B. Woolf, and O. Beckstein.</span>
<span class="c1"># MDAnalysis: A Toolkit for the Analysis of Molecular Dynamics Simulations.</span>
<span class="c1"># J. Comput. Chem. 32 (2011), 2319--2327, doi:10.1002/jcc.21787</span>
<span class="c1">#</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">TNG trajectory files --- :mod:`MDAnalysis.coordinates.TNG`</span>
<span class="sd">==========================================================</span>


<span class="sd">The TNG format :cite:p:`Lundborg2014` is a format used in `GROMACS`_ for</span>
<span class="sd">storage of trajectory and topology information. The TNG format allows a wide</span>
<span class="sd">range of compression algorithms and unlike the compressed XTC format can also</span>
<span class="sd">store velocities and forces in addition to positions.</span>

<span class="sd">The classes in this module are based on the `pytng`_ package for reading TNG</span>
<span class="sd">files. The reader is directed to the `pytng documentation`_ for further reading</span>
<span class="sd">about how pytng works under the hood. Pytng is an optional dependency and must</span>
<span class="sd">be installed to use this Reader. Use of the reader without pytng installed will</span>
<span class="sd">raise an `ImportError`. The variable `HAS_PYTNG` indicates whether this module</span>
<span class="sd">has pytng availble.</span>

<span class="sd">In addition to particle-dependent trajectory information like positions,</span>
<span class="sd">forces and velocities, the TNG format can store trajectory metadata and</span>
<span class="sd">other arbitrary time dependent data. Additional information can range from</span>
<span class="sd">the virial and pressure components to the molecular topology of the system.</span>
<span class="sd">This is enabled by a block based system in which binary flags indicate the</span>
<span class="sd">presence or absence of various data blocks. The structure of a TNG file is</span>
<span class="sd">provided  in the `TNG specification`_. The TNG paper :cite:p:`Lundborg2014` and</span>
<span class="sd">the `pytng documentation`_ are also good resources. The user is encouraged to</span>
<span class="sd">read the full list of `TNG blocks`_ to understand the full power of the TNG</span>
<span class="sd">format.</span>



<span class="sd">Current Limitations</span>
<span class="sd">-------------------</span>
<span class="sd">Currently there is only a Reader for TNG files and no Writer. This will depend</span>
<span class="sd">on upstream changes in pytng. Additionally, it is not currently possible to</span>
<span class="sd">read the molecular topology from a TNG file.</span>

<span class="sd">There are also some limitations to reading TNG files with pytng.</span>
<span class="sd">Currently we do not allow data to be read *off stride*. In essence this</span>
<span class="sd">means that all of the critical trajectory data (positions, box, velocities</span>
<span class="sd">(if present), forces (if present)) must share the same stride in trajectory</span>
<span class="sd">integrator steps. These critical blocks in the TNG file are henceforth called</span>
<span class="sd">*special blocks*. Optional blocks (all blocks that are not special blocks)</span>
<span class="sd">will not be read if they do not share an integrator step with, or are not</span>
<span class="sd">divisible by the shared integrator step of the special blocks.</span>


<span class="sd">References</span>
<span class="sd">----------</span>

<span class="sd">.. bibliography::</span>
<span class="sd">    :filter: False</span>
<span class="sd">    :style: MDA</span>

<span class="sd">    Lundborg2014</span>


<span class="sd">.. Links</span>

<span class="sd">.. _GROMACS:</span>
<span class="sd">    https://www.gromacs.org/</span>
<span class="sd">.. _pytng:</span>
<span class="sd">    https://github.com/MDAnalysis/pytng</span>
<span class="sd">.. _pytng documentation:</span>
<span class="sd">    https://www.mdanalysis.org/pytng/</span>
<span class="sd">.. _TNG blocks:</span>
<span class="sd">    https://www.mdanalysis.org/pytng/documentation_pages/Blocks.html</span>
<span class="sd">.. _TNG specification:</span>
<span class="sd">    https://gitlab.com/hugomacdermott/tng/-/blob/master/Trajectoryformatspecification.mk</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.coordinates</span> <span class="kn">import</span> <span class="n">base</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.coordinates.timestep</span> <span class="kn">import</span> <span class="n">Timestep</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.lib.mdamath</span> <span class="kn">import</span> <span class="n">triclinic_box</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.lib.util</span> <span class="kn">import</span> <span class="n">store_init_arguments</span>

<span class="kn">from</span> <span class="nn">..due</span> <span class="kn">import</span> <span class="n">Doi</span><span class="p">,</span> <span class="n">due</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pytng</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1"># Indicates whether pytng is found.</span>
    <span class="n">HAS_PYTNG</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Indicates whether pytng is found.</span>
    <span class="n">HAS_PYTNG</span> <span class="o">=</span> <span class="kc">True</span>


<div class="viewcode-block" id="TNGReader"><a class="viewcode-back" href="../../../documentation_pages/coordinates/TNG.html#MDAnalysis.coordinates.TNG.TNGReader">[docs]</a><span class="k">class</span> <span class="nc">TNGReader</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">ReaderBase</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Reader for the TNG format</span>

<span class="sd">    The TNG format :cite:p:`Lundborg2014` is a format used in `GROMACS`_ for</span>
<span class="sd">    storage of trajectory and topology information. This reader is are based on</span>
<span class="sd">    the `pytng`_ package for reading TNG files. The reader is directed to the</span>
<span class="sd">    `pytng documentation`_ and `TNG specification`_ for further reading.</span>

<span class="sd">    The TNG format allows a wide range of compression</span>
<span class="sd">    algorithms and unlike the compressed XTC format can also store velocities</span>
<span class="sd">    and forces in addition to positions.</span>

<span class="sd">    The contents of the *special blocks* (positions, box, velocities, forces)</span>
<span class="sd">    are read into the timestep if present. Additional blocks are read into the</span>
<span class="sd">    `ts.data` dictionary if they are available at the current frame.</span>

<span class="sd">    .. versionadded:: 2.4.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;TNG&quot;</span>
    <span class="c1"># NOTE: Time units are in seconds unlike other GROMACS formats</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;second&quot;</span><span class="p">,</span>
        <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="s2">&quot;nm&quot;</span><span class="p">,</span>
        <span class="s2">&quot;velocity&quot;</span><span class="p">:</span> <span class="s2">&quot;nm/ps&quot;</span><span class="p">,</span>
        <span class="s2">&quot;force&quot;</span><span class="p">:</span> <span class="s2">&quot;kJ/(mol*nm)&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">_box_blockname</span> <span class="o">=</span> <span class="s2">&quot;TNG_TRAJ_BOX_SHAPE&quot;</span>
    <span class="n">_positions_blockname</span> <span class="o">=</span> <span class="s2">&quot;TNG_TRAJ_POSITIONS&quot;</span>
    <span class="n">_velocities_blockname</span> <span class="o">=</span> <span class="s2">&quot;TNG_TRAJ_VELOCITIES&quot;</span>
    <span class="n">_forces_blockname</span> <span class="o">=</span> <span class="s2">&quot;TNG_TRAJ_FORCES&quot;</span>
    <span class="n">_special_blocks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">_box_blockname</span><span class="p">,</span>
        <span class="n">_positions_blockname</span><span class="p">,</span>
        <span class="n">_velocities_blockname</span><span class="p">,</span>
        <span class="n">_forces_blockname</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="nd">@due</span><span class="o">.</span><span class="n">dcite</span><span class="p">(</span><span class="n">Doi</span><span class="p">(</span><span class="s2">&quot;10.1002/jcc.23495&quot;</span><span class="p">),</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The TNG paper&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="nd">@store_init_arguments</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">convert_units</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a TNG trajectory</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            filename of the trajectory</span>
<span class="sd">        convert_units : bool (optional)</span>
<span class="sd">            convert into MDAnalysis units</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_PYTNG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;TNGReader: To read TNG files please install pytng&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">TNGReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span> <span class="o">=</span> <span class="n">convert_units</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span> <span class="o">=</span> <span class="n">pytng</span><span class="o">.</span><span class="n">TNGFileIterator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_atoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span><span class="o">.</span><span class="n">n_atoms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span><span class="o">.</span><span class="n">n_steps</span>

        <span class="c1"># names of the blocks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_block_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span><span class="o">.</span><span class="n">block_ids</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1"># block ids, dict of C long long</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_block_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span><span class="o">.</span><span class="n">block_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_block_strides</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span><span class="o">.</span><span class="n">block_strides</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span><span class="o">.</span><span class="n">n_data_frames</span>
        <span class="c1"># init all special blocks to not present</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_special_block_present</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_special_blocks</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Timestep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_atoms</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts_kwargs</span><span class="p">)</span>

        <span class="c1"># check for all the special blocks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box_blockname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_names</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_box</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_special_block_present</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_box_blockname</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_has_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positions_blockname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_names</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_positions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_special_block_present</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_positions_blockname</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span><span class="o">.</span><span class="n">make_ndarray_for_block_from_name</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_positions_blockname</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_has_velocities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_velocities_blockname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_names</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_velocities</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_special_block_present</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_velocities_blockname</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">velocities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span><span class="o">.</span><span class="n">make_ndarray_for_block_from_name</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_velocities_blockname</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_has_forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forces_blockname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_names</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_forces</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_special_block_present</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_forces_blockname</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span><span class="o">.</span><span class="n">make_ndarray_for_block_from_name</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_forces_blockname</span>
            <span class="p">)</span>

        <span class="c1"># check for any additional blocks that will be read into ts.data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_additional_blocks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">block</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_names</span> <span class="k">if</span> <span class="n">block</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_special_blocks</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_strides_and_frames</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># box needs a temporary place to be stored as ts.dimensions is</span>
        <span class="c1"># wrong shape initially</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span><span class="o">.</span><span class="n">make_ndarray_for_block_from_name</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box_blockname</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_next_timestep</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_check_strides_and_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that the strides and frame numbers of the blocks in the TNG</span>
<span class="sd">        file match up so that the file can be iterated over retrieving data at</span>
<span class="sd">        each integrator step</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">strides</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n_data_frames</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">special_blocks</span><span class="p">:</span>
            <span class="n">stride</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_strides</span><span class="p">[</span><span class="n">block</span><span class="p">]</span>
            <span class="n">strides</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stride</span><span class="p">)</span>
            <span class="n">n_data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_frames</span><span class="p">[</span><span class="n">block</span><span class="p">]</span>
            <span class="n">n_data_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_data_frame</span><span class="p">)</span>

        <span class="n">strides_eq</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">strides</span><span class="p">)</span>
        <span class="n">frames_eq</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">n_data_frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">n_data_frames</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">strides_eq</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">frames_eq</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                <span class="s2">&quot;Strides of TNG special blocks not equal, file cannot be read&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_global_stride</span> <span class="o">=</span> <span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># NOTE frame number is 0 indexed so increment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_frames</span> <span class="o">=</span> <span class="n">n_data_frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_additional_blocks_to_read</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_additional_blocks</span><span class="p">:</span>
            <span class="n">stride_add</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_strides</span><span class="p">[</span><span class="n">block</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">stride_add</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global_stride</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stride_add</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global_stride</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;TNG additional block </span><span class="si">{</span><span class="n">block</span><span class="si">}</span><span class="s2"> does not match&quot;</span>
                        <span class="s2">&quot; strides of other blocks and is not&quot;</span>
                        <span class="s2">&quot; divisible by the global stride_length.&quot;</span>
                        <span class="s2">&quot; It will not be read&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_additional_blocks_to_read</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>  <span class="c1"># pragma: no cover</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_additional_blocks_to_read</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

<div class="viewcode-block" id="TNGReader.close"><a class="viewcode-back" href="../../../documentation_pages/coordinates/TNG.html#MDAnalysis.coordinates.TNG.TNGReader.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;close the reader&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span></div>

<div class="viewcode-block" id="TNGReader.parse_n_atoms"><a class="viewcode-back" href="../../../documentation_pages/coordinates/TNG.html#MDAnalysis.coordinates.TNG.TNGReader.parse_n_atoms">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">parse_n_atoms</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;parse the number of atoms in the TNG trajectory file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            The name of the TNG file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        n_atoms : int</span>
<span class="sd">            The number of atoms in the TNG file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_PYTNG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;TNGReader: To read TNG files please install pytng&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">pytng</span><span class="o">.</span><span class="n">TNGFileIterator</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tng</span><span class="p">:</span>
            <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">tng</span><span class="o">.</span><span class="n">n_atoms</span>
        <span class="k">return</span> <span class="n">n_atoms</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;number of frames in trajectory</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        n_frames : int</span>
<span class="sd">            The number of data containing frames in the trajectory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_frames</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;list of the blocks that are in the file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        blocks : list</span>
<span class="sd">            The block names present in the TNG trajectory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_names</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">special_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;list of the special blocks that are in the file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        special_blocks : list</span>
<span class="sd">            The special block names (positions, box, velocities, forces)</span>
<span class="sd">            present in the TNG trajectory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_special_block_present</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">additional_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;list of the additional (non-special) blocks that are being read from</span>
<span class="sd">        the trajectory. This may be exclude some blocks present in the file if</span>
<span class="sd">        they do not fall on the same trajectory stride as the positions and</span>
<span class="sd">        velocities.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        additional_blocks : list</span>
<span class="sd">            The additional block names in the TNG trajectory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_additional_blocks_to_read</span>

    <span class="k">def</span> <span class="nf">_reopen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;reopen the trajectory&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span><span class="o">.</span><span class="n">_open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_frame_to_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a frame number to an integrator step</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame : int</span>
<span class="sd">            The frame number</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        integrators_step :  int</span>
<span class="sd">            The integrator step of the frame in the TNG file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">frame</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global_stride</span>

    <span class="k">def</span> <span class="nf">_read_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timestep</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;read frame i</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i : int</span>
<span class="sd">            The trajectory frame to be read</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ts : Timestep</span>
<span class="sd">            Data from frame i encapsulated in an MDA `:class:Timestep`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_next_timestep</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ts</span>

    <span class="k">def</span> <span class="nf">_read_next_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Timestep</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timestep</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read next frame into a timestep</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ts : Timestep</span>
<span class="sd">            The timestep to read the data into</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ts :  Timestep</span>
<span class="sd">            The timestep filled with data from the next step</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_frames</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;trying to go over trajectory limit&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>
        <span class="c1"># convert from frames to integrator steps</span>
        <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame_to_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">iterator_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span><span class="o">.</span><span class="n">read_step</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame_to_ts</span><span class="p">(</span><span class="n">iterator_step</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ts</span>

    <span class="k">def</span> <span class="nf">_frame_to_ts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">curr_step</span><span class="p">:</span> <span class="s2">&quot;pytng.TNGCurrentIntegratorStep&quot;</span><span class="p">,</span> <span class="n">ts</span><span class="p">:</span> <span class="n">Timestep</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timestep</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;convert a TNGCurrentIteratorStep to an MDA Timestep</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        curr_step : pytng.TNGCurrentIntegratorStep</span>
<span class="sd">            The current timestep in the TNG trajectory</span>

<span class="sd">        ts : Timestep</span>
<span class="sd">            The current timestep in the MDA trajectory</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ts: Timestep</span>
<span class="sd">            The current timestep in the MDA trajectory with data from TNG</span>
<span class="sd">            trajectory integrator step</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        IOError</span>
<span class="sd">            The reading of one of the attributes from the TNG file failed</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ts</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">curr_step</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_time_from_native</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">curr_step</span><span class="o">.</span><span class="n">step</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_box</span><span class="p">:</span>
            <span class="n">curr_step</span><span class="o">.</span><span class="n">get_box</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box_temp</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="n">triclinic_box</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_box_temp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">curr_step</span><span class="o">.</span><span class="n">read_success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Failed to read box from TNG file&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_from_native</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_positions</span><span class="p">:</span>
            <span class="n">curr_step</span><span class="o">.</span><span class="n">get_positions</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">curr_step</span><span class="o">.</span><span class="n">read_success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Failed to read positions from TNG file&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_from_native</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_velocities</span><span class="p">:</span>
            <span class="n">curr_step</span><span class="o">.</span><span class="n">get_velocities</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">velocities</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">curr_step</span><span class="o">.</span><span class="n">read_success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Failed to read velocities from TNG file&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">convert_velocities_from_native</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">velocities</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_forces</span><span class="p">:</span>
            <span class="n">curr_step</span><span class="o">.</span><span class="n">get_forces</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">forces</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">curr_step</span><span class="o">.</span><span class="n">read_success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Failed to read forces from TNG file&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">convert_forces_from_native</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">forces</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_additional_blocks_to_read</span><span class="p">:</span>
            <span class="n">add_block_stride</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_strides</span><span class="p">[</span><span class="n">block</span><span class="p">]</span>
            <span class="c1"># check we are on stride for our block</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">add_block_stride</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global_stride</span><span class="p">):</span>
                <span class="n">block_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span><span class="o">.</span><span class="n">make_ndarray_for_block_from_name</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
                <span class="c1"># additional blocks read into ts.data dictionary</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">block</span><span class="p">]</span> <span class="o">=</span> <span class="n">curr_step</span><span class="o">.</span><span class="n">get_blockid</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_block_dictionary</span><span class="p">[</span><span class="n">block</span><span class="p">],</span> <span class="n">block_data</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">curr_step</span><span class="o">.</span><span class="n">read_success</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to read additional block </span><span class="si">{</span><span class="n">block</span><span class="si">}</span><span class="s2"> from TNG file&quot;</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">ts</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a dictionary of the class state to pickle Reader instance.</span>

<span class="sd">        Must be done manually as pytng uses a non-trivial`__cinit__`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># cant have PyTNG file iterator in as it is non-pickable</span>
        <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_file_iterator&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Restore class from `state` dictionary in unpickling of Reader</span>
<span class="sd">        instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">state</span>
        <span class="c1"># reconstruct file iterator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_iterator</span> <span class="o">=</span> <span class="n">pytng</span><span class="o">.</span><span class="n">TNGFileIterator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="c1"># make sure we re-read the current frame to update C level objects in</span>
        <span class="c1"># the file iterator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="p">)</span>

<div class="viewcode-block" id="TNGReader.Writer"><a class="viewcode-back" href="../../../documentation_pages/coordinates/TNG.html#MDAnalysis.coordinates.TNG.TNGReader.Writer">[docs]</a>    <span class="k">def</span> <span class="nf">Writer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Writer for TNG files</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        NotImplementedError</span>
<span class="sd">            Currently there is not writer for TNG files pending implementation</span>
<span class="sd">            upstream in pytng.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;There is currently no writer for TNG files&quot;</span><span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2005-2023, Naveen Michaud-Agrawal, Elizabeth J. Denning, Christian Beckstein (logo), Joshua L. Adelman, Henok Ademtew, Shobhit Agarwal, Aya M. Alaa, Irfan Alibay, Kazi Shudipto Amin, Anshul Angaria, Luís Pedro Borges Araújo, Balasubramanian, Utkarsh Bansal, Patricio Barletta, Leonardo Barneschi, Jonathan Barnoud, Estefania Barreto-Ojeda, Tone Bengtsen, Alejandro Bernardin, Ninad Bhat, Mateusz Bieniek, Kavya Bisht, Wouter Boomsma, Jose Borreguero, Cédric Bouysset, Kevin Boyd, Meet Brijwani, Bart Bruininks, Sébastien Buchoux, Sören von Bülow, Yantong Cai, David Caplan, Yuanyu Chang, Pratham Chauhan, Matthieu Chavent, Haochuan Chen, Xu Hong Chen, Kathleen Clark, Jennifer A Clark, Orion Cohen, Charlie Cook, Ruggero Cortini, Nicholas Craven, Ramon Crehuet, Davide Cruz, Robert Delgado, John Detlefs, Xavier Deupi, Jan Domanski, David L. Dotson, Mark D. Driver, Ali Ehlen, Daniel J. Evans, Shujie Fan, Bjarne Feddersen, Lennard van der Feltz, Jake Fennick, Philip Fowler, Guillaume Fraux, Anirvinya G, Ahmed Salah Ghoneim, Mikhail Glagolev, William Glass, Joseph Goose, Alexander Gorfer, Richard J. Gowers, Lukas Grossar, Abhinav Gupta, Akshay Gupta, Pratik Gupta, Benjamin Hall, Ameya Harmalkar, Ivan Hristov, Eugen Hruska, Kyle J. Huston, Siddharth Jain, Edis Jakupovic, Joe Jordan, Henrik Jäger, Uma D Kadam, Aditya Kamath, Jon Kapla, Haleema Khan, Navya Khare, Utsav Khatu, Andrew William King, Henry Kobin, Abhishek A. Kognole, Kosuke Kudo, Atharva Kulkarni, Manish Kumar, Alia Lescoulie, Max Linke, Philip Loche, Jinju Lu, Hugo MacDermott-Opeskin, Shaivi Malik, Egor Marin, Domenico Marson, Micaela Matta, Andrew R. McCluskey, Robert McGibbon, Rocco Meli, Manuel Nuno Melo, Marcelo C. R. Melo, Dominik &#39;Rathann&#39; Mierzejewski, Henry Mull, Morgan L. Nance, Fiona B. Naughton, Alex Nesterenko, Hai Nguyen, Sang Young Noh, Meghan Osato, Daniele Padula, Nabarun Pal, Mattia F. Palermo, Dimitrios Papageorgiou, Rafael R. Pappalardo, Vishal Parmar, Danny Parton, Shakul Pathak, Christian Pfaendner, Joshua L. Phillips, Marcelo D. Poleto, Hannah Pollak, Kashish Punjani, Michael Quevillon, Vedant Rathore, Tyler Reddy, Pedro Reis, Paul Rigor, Andrea Rizzi, Xiaoxu Ruan, Carlos Yanez S., Utkarsh Saxena, Moritz Schaeffler, Alexander Schlaich, Marcello Sega, Ricky Sexton, Sean L. Seyler, Faraaz Shah, Sulay Shah, Abhishek Shandilya, Shubham Sharma, Rishabh Shukla, Karthikeyan Singaravelan, Tamandeep Singh, Paul Smith, Andy Somogyi, Caio S. Souza, Shantanu Srivastava, Lukas Stelzl, Jan Stevens, Gorman Stock, Fenil Suchak, Ayush Suhane, Filip T. Szczypiński, Sukeerti T, Matthijs Tadema, Joao Miguel Correia Teixeira, Paarth Thadani, Matthew W. Thompson, Hao Tian, Matteo Tiberti, Wiep van der Toorn, Mieczyslaw Torchala, Aditi Tripathi, Mark Verma, Josh Vermaas, Isaac Virshup, Lily Wang, Nestor Wendt, Zhiyi Wu, Tengyu Xie, Zhuyi Xue, Mingyi Xue, Alexander Yang, Juan Eiros Zamora, Johannes Zeman, Yibo Zhang, Raymond Zhao, Yuxuan Zhuang, and Oliver Beckstein.</p>
  </div>

  
 
<div class="footer"><p>Please see
    our <a href="https://www.mdanalysis.org/pages/privacy/">Privacy Policy</a>
    to learn how <a href="https://www.mdanalysis.org">MDAnalysis</a> collects data.</p>
    <script data-goatcounter="https://mdanalysis.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
</div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
    var versions_json_url = 'https://docs.mdanalysis.org/versions.json'
</script>

<div class="rst-versions" data-toggle="rst-versions" role="note"
     aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"></span>
        2.5.0-dev0
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
        <dl id="versionselector">
            <dt>Other Versions</dt>
        </dl>

    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>