

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MDAnalysis.analysis.hole &mdash; MDAnalysis 0.20.2-dev0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/mdanalysis-logo.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within MDAnalysis 0.20.2-dev0 documentation"
          href="../../../_static/opensearch.xml"/>

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../../../index.html">
          

          
            
            <img src="../../../_static/mdanalysis-logo-thin.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.20
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/overview.html">1. Overview over MDAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/topology.html">2. The topology system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/selections.html">3. Selection commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/analysis_modules.html">4. Analysis modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/topology_modules.html">5. Topology modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/coordinates_modules.html">6. Coordinates modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/converters.html">7. Converter modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/trajectory_transformations.html">8. Trajectory transformations (“on-the-fly” transformations)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/selections_modules.html">9. Selection exporters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/auxiliary_modules.html">10. Auxiliary modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/core_modules.html">11. Core modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/visualization_modules.html">12. Visualization modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/lib_modules.html">13. Library functions — <code class="docutils literal notranslate"><span class="pre">MDAnalysis.lib</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/version.html">14. Version information for MDAnalysis - <code class="docutils literal notranslate"><span class="pre">MDAnalysis.version</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/units.html">15. Constants and unit conversion — <code class="docutils literal notranslate"><span class="pre">MDAnalysis.units</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/exceptions.html">16. Custom exceptions and warnings — <code class="docutils literal notranslate"><span class="pre">MDAnalysis.exceptions</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation_pages/references.html">17. References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MDAnalysis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>MDAnalysis.analysis.hole</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for MDAnalysis.analysis.hole</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- Mode: python; tab-width: 4; indent-tabs-mode:nil; coding:utf-8 -*-</span>
<span class="c1"># vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4</span>
<span class="c1">#</span>
<span class="c1"># MDAnalysis --- https://www.mdanalysis.org</span>
<span class="c1"># Copyright (c) 2006-2020 The MDAnalysis Development Team and contributors</span>
<span class="c1"># (see the file AUTHORS for the full list of names)</span>
<span class="c1">#</span>
<span class="c1"># Released under the GNU Public Licence, v2 or any higher version</span>
<span class="c1">#</span>
<span class="c1"># Please cite your use of MDAnalysis in published work:</span>
<span class="c1">#</span>
<span class="c1"># R. J. Gowers, M. Linke, J. Barnoud, T. J. E. Reddy, M. N. Melo, S. L. Seyler,</span>
<span class="c1"># D. L. Dotson, J. Domanski, S. Buchoux, I. M. Kenney, and O. Beckstein.</span>
<span class="c1"># MDAnalysis: A Python package for the rapid analysis of molecular dynamics</span>
<span class="c1"># simulations. In S. Benthall and S. Rostrup editors, Proceedings of the 15th</span>
<span class="c1"># Python in Science Conference, pages 102-109, Austin, TX, 2016. SciPy.</span>
<span class="c1"># doi: 10.25080/majora-629e541a-00e</span>
<span class="c1">#</span>
<span class="c1"># N. Michaud-Agrawal, E. J. Denning, T. B. Woolf, and O. Beckstein.</span>
<span class="c1"># MDAnalysis: A Toolkit for the Analysis of Molecular Dynamics Simulations.</span>
<span class="c1"># J. Comput. Chem. 32 (2011), 2319--2327, doi:10.1002/jcc.21787</span>
<span class="c1">#</span>

<span class="sa">r</span><span class="sd">&quot;&quot;&quot;Generation and Analysis of HOLE pore profiles (Deprecated) --- :mod:`MDAnalysis.analysis.hole`</span>
<span class="sd">==================================================================================================</span>

<span class="sd">:Author: Lukas Stelzl, Oliver Beckstein</span>
<span class="sd">:Year: 2011-2012</span>
<span class="sd">:Copyright: GNU Public License v2</span>

<span class="sd">.. warning:</span>

<span class="sd">    This module is deprecated and will be removed in version 2.0.</span>
<span class="sd">    Please use :mod:`MDAnalysis.analysis.hole2` instead.</span>

<span class="sd">With the help of this module, the :program:`hole` program from the HOLE_ suite</span>
<span class="sd">of tools [Smart1993]_ [Smart1996]_ can be run on frames in an MD trajectory or</span>
<span class="sd">NMR ensemble in order to analyze an ion channel pore or transporter pathway</span>
<span class="sd">[Stelzl2014]_ as a function of time or arbitrary order parameters. Data can be</span>
<span class="sd">combined and analyzed.</span>

<span class="sd">HOLE_ must be installed separately and can be obtained in binary form</span>
<span class="sd">from http://www.holeprogram.org/ or as source from</span>
<span class="sd">https://github.com/osmart/hole2. (HOLE is open source and available</span>
<span class="sd">under the Apache v2.0 license.)</span>

<span class="sd">.. _HOLE: http://www.holeprogram.org</span>


<span class="sd">Examples for using HOLE</span>
<span class="sd">-----------------------</span>

<span class="sd">The two classes :class:`HOLE` and :class:`HOLEtraj` in this module primarily</span>
<span class="sd">act as wrappers around the :program:`hole` program from the HOLE_ suite of</span>
<span class="sd">tools. They contain many options to set options of :program:`hole`. However,</span>
<span class="sd">the defaults often work well and the following examples should be good starting</span>
<span class="sd">points for applying HOLE_ to other problems.</span>


<span class="sd">Single structure</span>
<span class="sd">~~~~~~~~~~~~~~~~</span>

<span class="sd">The following example runs :program:`hole` on the experimental</span>
<span class="sd">structure of the Gramicidin A (gA) channel. We use the :class:`HOLE`</span>
<span class="sd">class, which acts as a wrapper around :program:`hole`. It therefore</span>
<span class="sd">shares some of the limitations of HOLE_, namely, that it can only</span>
<span class="sd">process PDB files [#HOLEDCD]_. ::</span>

<span class="sd">   from MDAnalysis.analysis.hole import HOLE</span>
<span class="sd">   from MDAnalysis.tests.datafiles import PDB_HOLE</span>

<span class="sd">   H = HOLE(PDB_HOLE, executable=&quot;~/hole2/exe/hole&quot;)  # set path to your hole binary</span>
<span class="sd">   H.run()</span>
<span class="sd">   H.collect()</span>
<span class="sd">   H.plot(linewidth=3, color=&quot;black&quot;, label=False)</span>

<span class="sd">The example assumes that :program:`hole` was installed as</span>
<span class="sd">``~/hole2/exe/hole``)</span>

<span class="sd">Trajectory</span>
<span class="sd">~~~~~~~~~~</span>

<span class="sd">One can also run :program:`hole` on frames in a trajectory with</span>
<span class="sd">:class:`HOLEtraj`. In this case, provide a</span>
<span class="sd">:class:`~MDAnalysis.core.universe.Universe`::</span>

<span class="sd">   import MDAnalysis as mda</span>
<span class="sd">   from MDAnalysis.analysis.hole import HOLEtraj</span>
<span class="sd">   from MDAnalysis.tests.datafiles import MULTIPDB_HOLE</span>

<span class="sd">   u = mda.Universe(MULTIPDB_HOLE)</span>
<span class="sd">   H = HOLEtraj(u, executable=&quot;~/hole2/exe/hole&quot;)</span>
<span class="sd">   H.run()</span>
<span class="sd">   H.plot3D()</span>

<span class="sd">The profiles are available as the attribute :attr:`HOLEtraj.profiles`</span>
<span class="sd">(``H.profiles`` in the example) and are indexed by frame number but</span>
<span class="sd">can also be indexed by an arbitrary order parameter as shown in the</span>
<span class="sd">next example.</span>


<span class="sd">Trajectory with RMSD as order parameter</span>
<span class="sd">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">In order to classify the HOLE profiles :math:`R(\zeta)` the RMSD :math:`\rho`</span>
<span class="sd">to a reference structure is calculated for each trajectory frame (e.g. using</span>
<span class="sd">the :class:`MDAnalysis.analysis.rms.RMSD` analysis class). Then the HOLE</span>
<span class="sd">profiles :math:`R_\rho(\zeta)` can be ordered by the RMSD, which acts as an</span>
<span class="sd">order parameter :math:`\rho`. ::</span>

<span class="sd">   import MDAnalysis as mda</span>
<span class="sd">   from MDAnalysis.analysis.hole import HOLEtraj</span>
<span class="sd">   from MDAnalysis.analysis.rms import RMSD</span>

<span class="sd">   from MDAnalysis.tests.datafiles import PDB_HOLE, MULTIPDB_HOLE</span>

<span class="sd">   mda.start_logging()</span>
<span class="sd">   ref = mda.Universe(PDB_HOLE)    # reference structure</span>
<span class="sd">   u = mda.Universe(MULTIPDB_HOLE) # trajectory</span>

<span class="sd">   # calculate RMSD</span>
<span class="sd">   R = RMSD(u, reference=ref, select=&quot;protein&quot;, weights=&#39;mass&#39;)</span>
<span class="sd">   R.run()</span>

<span class="sd">   # HOLE analysis with order parameters</span>
<span class="sd">   H = HOLEtraj(u, orderparameters=R.rmsd[:,2],</span>
<span class="sd">                executable=&quot;~/hole2/exe/hole&quot;)</span>
<span class="sd">   H.run()</span>

<span class="sd">The :attr:`HOLEtraj.profiles` dictionary will have the order parameter as key</span>
<span class="sd">for each frame. The plot functions will automatically sort the profiles by</span>
<span class="sd">ascending order parameter. To access the individual profiles one can simply</span>
<span class="sd">iterate over the sorted profiles (see</span>
<span class="sd">:meth:`HOLEtraj.sorted_profiles_iter`). For example, in order to plot the</span>
<span class="sd">minimum radius as function of order parameter</span>

<span class="sd">.. math::</span>

<span class="sd">   r(\rho) = \min_\zeta R_\rho(\zeta)</span>

<span class="sd">we iterate over the profiles and process them in turn::</span>

<span class="sd">  import numpy as np</span>
<span class="sd">  import matplotlib.pyplot as plt</span>

<span class="sd">  r_rho = np.array([[rho, profile.radius.min()] for rho, profile in H])</span>

<span class="sd">  ax = plt.subplot(111)</span>
<span class="sd">  ax.plot(r_rho[:, 0], r_rho[:, 1], lw=2)</span>
<span class="sd">  ax.set_xlabel(r&quot;order parameter RMSD $\rho$ ($\AA$)&quot;)</span>
<span class="sd">  ax.set_ylabel(r&quot;minimum HOLE pore radius $r$ ($\AA$)&quot;)</span>

<span class="sd">(The graph shows that the pore opens up with increasing order parameter.)</span>


<span class="sd">Data structures</span>
<span class="sd">---------------</span>

<span class="sd">A profile is stored as a :class:`numpy.recarray`::</span>

<span class="sd">   frame   rxncoord   radius</span>

<span class="sd">frame</span>
<span class="sd">   integer frame number (only important when HOLE itself reads a</span>
<span class="sd">   trajectory)</span>
<span class="sd">rxncoord</span>
<span class="sd">   the distance along the pore axis, in Å</span>
<span class="sd">radius</span>
<span class="sd">   the pore radius, in Å</span>

<span class="sd">The :attr:`HOLE.profiles` or :attr:`HOLEtraj.profiles` dictionary</span>
<span class="sd">holds one profile for each key. By default the keys are the frame</span>
<span class="sd">numbers but :class:`HOLEtraj` can take the optional *orderparameters*</span>
<span class="sd">keyword argument and load an arbitrary order parameter for each</span>
<span class="sd">frame. In that case, the key becomes the orderparameter.</span>

<span class="sd">Notes</span>
<span class="sd">-----</span>
<span class="sd">The profiles dict is not ordered and hence one typically needs to manually</span>
<span class="sd">order the keys first. Furthermore, duplicate keys are not possible:</span>
<span class="sd">In the case of *duplicate orderparameters*, the last one read will</span>
<span class="sd">be stored in the dict.</span>


<span class="sd">Analysis</span>
<span class="sd">--------</span>

<span class="sd">.. autoclass:: HOLE</span>
<span class="sd">   :members:</span>
<span class="sd">   :inherited-members:</span>

<span class="sd">   .. attribute:: profiles</span>

<span class="sd">      After running :meth:`HOLE.collect`, this dict contains all the</span>
<span class="sd">      HOLE profiles, indexed by the frame number. If only a single</span>
<span class="sd">      frame was analyzed then this will be ``HOLE.profiles[0]``.</span>
<span class="sd">      The entries are stored in order of calculation, but one can</span>
<span class="sd">      also sort it by the keys.</span>

<span class="sd">      .. Note::</span>
<span class="sd">         Duplicate keys are not possible. The last key overwrites</span>
<span class="sd">         previous values. This is arguably a bug.</span>

<span class="sd">.. autoclass:: HOLEtraj</span>
<span class="sd">   :members:</span>
<span class="sd">   :inherited-members:</span>

<span class="sd">   .. attribute:: profiles</span>

<span class="sd">      After running :meth:`HOLE.collect`, this dict contains all the</span>
<span class="sd">      HOLE profiles, indexed by the frame number or the order</span>
<span class="sd">      parameter (if *orderparameters* was supplied).</span>
<span class="sd">      The entries are stored in order of calculation, but one can</span>
<span class="sd">      also sort it by the keys.</span>

<span class="sd">      .. Note::</span>
<span class="sd">         Duplicate keys are not possible. The last key overwrites</span>
<span class="sd">         previous values. This is arguably a bug.</span>

<span class="sd">Utilities</span>
<span class="sd">---------</span>

<span class="sd">.. autofunction:: write_simplerad2</span>
<span class="sd">.. autodata:: SIMPLE2_RAD</span>
<span class="sd">.. autofunction:: seq2str</span>
<span class="sd">.. autoclass:: ApplicationError</span>


<span class="sd">References</span>
<span class="sd">----------</span>

<span class="sd">.. [Smart1993] O.S. Smart, J.M. Goodfellow and B.A. Wallace.</span>
<span class="sd">               The Pore Dimensions of Gramicidin A. Biophysical Journal 65:2455-2460, 1993.</span>
<span class="sd">               DOI: 10.1016/S0006-3495(93)81293-1</span>
<span class="sd">.. [Smart1996] O.S. Smart, J.G. Neduvelil, X. Wang, B.A. Wallace, and M.S.P. Sansom.</span>
<span class="sd">               HOLE: A program for the analysis of the pore dimensions of ion channel</span>
<span class="sd">               structural models. J.Mol.Graph., 14:354–360, 1996.</span>
<span class="sd">               DOI: 10.1016/S0263-7855(97)00009-X</span>
<span class="sd">               URL http://www.holeprogram.org/</span>
<span class="sd">.. [Stelzl2014] L. S. Stelzl, P. W. Fowler, M. S. P. Sansom, and O. Beckstein.</span>
<span class="sd">               Flexible gates generate occluded intermediates in the transport cycle</span>
<span class="sd">               of LacY. J Mol Biol, 426:735–751, 2014.</span>
<span class="sd">               DOI: 10.1016/j.jmb.2013.10.024</span>

<span class="sd">.. Footnotes</span>

<span class="sd">.. [#HOLEDCD] PDB files are not the only files that :program:`hole` can</span>
<span class="sd">              read. In principle, it is also able to read CHARMM DCD</span>
<span class="sd">              trajectories and generate a hole profile for each frame. However,</span>
<span class="sd">              native support for DCD in :program:`hole` is patchy and not every</span>
<span class="sd">              DCD is recognized. In particular, At the moment, DCDs generated</span>
<span class="sd">              with MDAnalysis are not accepted by HOLE. If DCDs do not work,</span>
<span class="sd">              use :class:`HOLEtraj`, which converts any of the :ref:`any</span>
<span class="sd">              trajectory that MDAnalysis can read &lt;Supported coordinate</span>
<span class="sd">              formats&gt;` into a sequence of PDB files and runs :class:`HOLE` on</span>
<span class="sd">              each of them in turn.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">zip</span><span class="p">,</span> <span class="n">cPickle</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">cycle</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">MDAnalysis</span> <span class="kn">import</span> <span class="n">Universe</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.exceptions</span> <span class="kn">import</span> <span class="n">ApplicationError</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.lib.util</span> <span class="kn">import</span> <span class="p">(</span><span class="n">which</span><span class="p">,</span> <span class="n">realpath</span><span class="p">,</span> <span class="n">asiterable</span><span class="p">,</span>
                                 <span class="n">FORTRANReader</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">..due</span> <span class="kn">import</span> <span class="n">due</span><span class="p">,</span> <span class="n">Doi</span>

<span class="n">due</span><span class="o">.</span><span class="n">cite</span><span class="p">(</span><span class="n">Doi</span><span class="p">(</span><span class="s2">&quot;10.1016/S0006-3495(93)81293-1&quot;</span><span class="p">),</span>
         <span class="n">description</span><span class="o">=</span><span class="s2">&quot;HOLE program&quot;</span><span class="p">,</span>
         <span class="n">path</span><span class="o">=</span><span class="s2">&quot;MDAnalysis.analysis.hole&quot;</span><span class="p">,</span>
         <span class="n">cite_module</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">due</span><span class="o">.</span><span class="n">cite</span><span class="p">(</span><span class="n">Doi</span><span class="p">(</span><span class="s2">&quot;10.1016/S0263-7855(97)00009-X&quot;</span><span class="p">),</span>
         <span class="n">description</span><span class="o">=</span><span class="s2">&quot;HOLE program&quot;</span><span class="p">,</span>
         <span class="n">path</span><span class="o">=</span><span class="s2">&quot;MDAnalysis.analysis.hole&quot;</span><span class="p">,</span>
         <span class="n">cite_module</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">due</span><span class="o">.</span><span class="n">cite</span><span class="p">(</span><span class="n">Doi</span><span class="p">(</span><span class="s2">&quot;10.1016/j.jmb.2013.10.024&quot;</span><span class="p">),</span>
         <span class="n">description</span><span class="o">=</span><span class="s2">&quot;HOLE trajectory analysis with orderparameters&quot;</span><span class="p">,</span>
         <span class="n">path</span><span class="o">=</span><span class="s2">&quot;MDAnalysis.analysis.hole&quot;</span><span class="p">,</span>
         <span class="n">cite_module</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">del</span> <span class="n">Doi</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;MDAnalysis.analysis.hole&quot;</span><span class="p">)</span>

<span class="c1">#: Built-in HOLE radii (based on ``simple.rad`` from the HOLE_ distribution):</span>
<span class="c1">#: van der Waals radii are AMBER united atom from Weiner et al. (1984), JACS, vol 106 pp765-768.</span>
<span class="c1">#: *Simple* - Only use one value for each element C O H etc.</span>
<span class="c1">#: Added radii for K+, NA+, CL- (Pauling hydration radius from Hille 2002).</span>
<span class="c1">#: The data file can be written with the convenience function :func:`write_simplerad2`.</span>
<span class="n">SIMPLE2_RAD</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">remark: Time-stamp: &lt;2005-11-21 13:57:55 oliver&gt; [OB]</span>
<span class="s2">remark: van der Waals radii: AMBER united atom</span>
<span class="s2">remark: from Weiner et al. (1984), JACS, vol 106 pp765-768</span>
<span class="s2">remark: Simple - Only use one value for each element C O H etc.</span>
<span class="s2">remark: van der Waals radii</span>
<span class="s2">remark: general last</span>
<span class="s2">VDWR C??? ??? 1.85</span>
<span class="s2">VDWR O??? ??? 1.65</span>
<span class="s2">VDWR S??? ??? 2.00</span>
<span class="s2">VDWR N??? ??? 1.75</span>
<span class="s2">VDWR H??? ??? 1.00</span>
<span class="s2">VDWR H?   ??? 1.00</span>
<span class="s2">VDWR P??? ??? 2.10</span>
<span class="s2">remark: ASN, GLN polar H (odd names for these atoms in xplor)</span>
<span class="s2">VDWR E2?  GLN 1.00</span>
<span class="s2">VDWR D2?  ASN 1.00</span>
<span class="s2">remark: amber lone pairs on sulphurs</span>
<span class="s2">VDWR LP?? ??? 0.00</span>
<span class="s2">remark: for some funny reason it wants radius for K even though</span>
<span class="s2">remark: it is on the exclude list</span>
<span class="s2">remark: Use Pauling hydration radius (Hille 2001) [OB]</span>
<span class="s2">VDWR K?   ??? 1.33</span>
<span class="s2">VDWR NA?  ??? 0.95</span>
<span class="s2">VDWR CL?  ??? 1.81</span>
<span class="s2">remark: funny hydrogens in gA structure [OB]</span>
<span class="s2">VDWR 1H?  ??? 1.00</span>
<span class="s2">VDWR 2H?  ??? 1.00</span>
<span class="s2">VDWR 3H?  ??? 1.00</span>
<span class="s2">remark: need bond rad for molqpt option</span>
<span class="s2">BOND C??? 0.85</span>
<span class="s2">BOND N??? 0.75</span>
<span class="s2">BOND O??? 0.7</span>
<span class="s2">BOND S??? 1.1</span>
<span class="s2">BOND H??? 0.5</span>
<span class="s2">BOND P??? 1.0</span>
<span class="s2">BOND ???? 0.85</span>
<span class="s2">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="write_simplerad2"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.write_simplerad2">[docs]</a><span class="k">def</span> <span class="nf">write_simplerad2</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;simple2.rad&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write the built-in radii in :data:`SIMPLE2_RAD` to `filename`.</span>

<span class="sd">    Does nothing if `filename` already exists.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : string, optional</span>
<span class="sd">       output file name; the default is &quot;simple2.rad&quot;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    filename : string</span>
<span class="sd">       returns the name of the data file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rad</span><span class="p">:</span>
            <span class="n">rad</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SIMPLE2_RAD</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Created simple radii file </span><span class="si">%(filename)r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">filename</span></div>


<div class="viewcode-block" id="seq2str"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.seq2str">[docs]</a><span class="k">def</span> <span class="nf">seq2str</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return sequence as a string of numbers with spaces as separators.</span>

<span class="sd">    In the special case of ``None``, the empty string &quot;&quot; is returned.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v : sequence or array_like</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    string</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">])</span></div>


<span class="k">class</span> <span class="nc">BaseHOLE</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Baseclass for HOLE analysis, providing plotting and utility functions</span>

<span class="sd">    .. versionchanged:: 1.0.0</span>
<span class="sd">       ``save()`` method was removed. You can use ``cPickle.dump()`` on</span>
<span class="sd">       :attr:`BaseHOLE.profiles` instead.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_process_plot_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;frames&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">frames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                             <span class="p">[::</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frames</span> <span class="o">=</span> <span class="n">asiterable</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;frames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frames</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;yshift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;yshift&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;rmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rmax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_nolegend_&quot;</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">)</span>
            <span class="n">normalize</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frames</span><span class="p">),</span>
                                                    <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frames</span><span class="p">))</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">normalize</span><span class="p">(</span><span class="n">frames</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">asiterable</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;linestyles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">asiterable</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;linestyle&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">kw</span><span class="p">,</span> <span class="n">kwargs</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot HOLE profiles :math:`R(\zeta)` in a 1D graph.</span>

<span class="sd">        Lines are colored according to the color map *cmap*. One graph is</span>
<span class="sd">        plotted for each trajectory frame (unless `step` is changed).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        step : integer, optional</span>
<span class="sd">              only plot every `step` profiles; default is 1.</span>
<span class="sd">        color : string or iterable, optional</span>
<span class="sd">              color or iterable of colors to specify graph colors; The default</span>
<span class="sd">              ``None`` will use the color map `cmap` instead.</span>
<span class="sd">        cmap : :class:`matplotlib.colors.Colormap`</span>
<span class="sd">               Pick colors from the matplotlib color map `cmap`; the default is</span>
<span class="sd">               *viridis*.</span>
<span class="sd">        linestyle : string or iterable, optional</span>
<span class="sd">              linestyle supported by :func:`matplotlib.pyplot.plot`; an</span>
<span class="sd">              iterable that is not a string (e.g., ``(&#39;-&#39;, &#39;--&#39;, &#39;.&#39;)``) will</span>
<span class="sd">              be applied in turn. The default is &#39;-&#39; to draw a simple line.</span>
<span class="sd">        yshift : float, optional</span>
<span class="sd">              displace each :math:`R(\zeta)` profile by `yshift` in the</span>
<span class="sd">              :math:`y`-direction for clearer visualization. The default is 0,</span>
<span class="sd">              i.e., not to shift any graph.</span>
<span class="sd">        frames : integer or array_like, optional</span>
<span class="sd">              only plot these specific frame(s); the default ``None`` is to</span>
<span class="sd">              plot everything (see also `step`)</span>
<span class="sd">        label : bool or string, optional</span>
<span class="sd">              If it is set to &quot;_nolegend_&quot; or ``False`` then no legend is</span>
<span class="sd">              displayed. Any other value is ignored and the frame number is</span>
<span class="sd">              used as a label. The default is ``True`` to plot the legend even</span>
<span class="sd">              though this can become rather messy.</span>
<span class="sd">        ax : :class:`matplotlib.axes.Axes`</span>
<span class="sd">              If no `ax` is supplied or set to ``None`` then the plot will</span>
<span class="sd">              be added to the current active axes.</span>

<span class="sd">        kwargs :  `**kwargs`</span>
<span class="sd">             All other `kwargs` are passed to :func:`matplotlib.pyplot.plot`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax : :class:`~matplotlib.axes.Axes`</span>
<span class="sd">             Axes with the plot, either `ax` or the current axes.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. versionchanged:: 0.16.0</span>
<span class="sd">           Returns ``ax``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kw</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_plot_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">iplot</span><span class="p">,</span> <span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;frames&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;linestyles&#39;</span><span class="p">])):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linestyle</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;zorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">frame</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">iplot</span> <span class="o">*</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;yshift&#39;</span><span class="p">]</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">rxncoord</span><span class="p">,</span> <span class="n">profile</span><span class="o">.</span><span class="n">radius</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;pore coordinate $\zeta$ ($\AA$)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;HOLE radius $R$ ($\AA$)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">plot3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Stacked 3D graph of profiles :math:`R(\zeta)`.</span>

<span class="sd">        Lines are coloured according to the colour map `cmap`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        step : int, optional</span>
<span class="sd">               only plot every *step* profile; default: 1</span>
<span class="sd">        cmap : :class:`matplotlib.colors.Colormap`, optional</span>
<span class="sd">               matplotlib color map ;  the default is *viridis*</span>
<span class="sd">        rmax : float, optional</span>
<span class="sd">               only display radii up to `rmax`; the default is ``None``, which</span>
<span class="sd">               means to show all radii.</span>
<span class="sd">        ylabel : string, optional</span>
<span class="sd">               label of the reaction coordinate axis; the default is &quot;frames&quot;</span>
<span class="sd">        ax : :class:`matplotlib.axes.Axes`</span>
<span class="sd">               axes instance to plot into, which *must* have been generated</span>
<span class="sd">               with the `projection=&#39;3d&#39;` keyword set (see</span>
<span class="sd">               :mod:`mpl_toolkits.mplot3d.axes3d` and the `mplot3d tutorial`_</span>
<span class="sd">               for details)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax : :class:`~matplotlib.axes.Axes`</span>
<span class="sd">             Axes with the plot, either `ax` or the current axes.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Based on StackOverflow post `3d plots using matplotlib`_. Masking of</span>
<span class="sd">        the data above `rmax` implements the StackOverflow hack `How do I set a</span>
<span class="sd">        maximum value for the z axis`_.</span>

<span class="sd">        .. _`3d plots using matplotlib`:</span>
<span class="sd">           http://stackoverflow.com/questions/9053255/3d-plots-using-matplotlib</span>
<span class="sd">        .. _`How do I set a maximum value for the z axis`:</span>
<span class="sd">           http://stackoverflow.com/questions/4913306/python-matplotlib-mplot3d-how-do-i-set-a-maximum-value-for-the-z-axis</span>
<span class="sd">        .. _`mplot3d tutorial`:</span>
<span class="sd">           http://matplotlib.org/mpl_toolkits/mplot3d/tutorial.html</span>

<span class="sd">        .. versionchanged:: 0.16.0</span>
<span class="sd">           Returns ``ax``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># installed with matplotlib; imported here to enable 3D axes</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

        <span class="n">kw</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_plot_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rmax</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rmax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s2">&quot;frames&quot;</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">frame</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;frames&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;linestyles&#39;</span><span class="p">]):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linestyle</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;zorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">frame</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">rmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">radius</span>
                <span class="n">rxncoord</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">rxncoord</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># does not seem to work with masked arrays but with nan hack!</span>
                <span class="c1"># http://stackoverflow.com/questions/4913306/python-matplotlib-mplot3d-how-do-i-set-a-maximum-value-for-the-z-axis</span>
                <span class="c1">#radius = np.ma.masked_greater(profile.radius, rmax)</span>
                <span class="c1">#rxncoord = np.ma.array(profile.rxncoord, mask=radius.mask)</span>
                <span class="n">rxncoord</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">rxncoord</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">radius</span><span class="p">[</span><span class="n">radius</span> <span class="o">&gt;</span> <span class="n">rmax</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rxncoord</span><span class="p">,</span> <span class="n">frame</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">rxncoord</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;pore coordinate $\zeta$ ($\AA$)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;HOLE radius $R$ ($\AA$)&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">min_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the minimum radius over all profiles as a function of q&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">q</span><span class="p">,</span> <span class="n">profile</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span> <span class="k">for</span> <span class="n">q</span><span class="p">,</span> <span class="n">profile</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">sorted_profiles_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an iterator over profiles sorted by frame/order parameter *q*.</span>

<span class="sd">        The iterator produces tuples ``(q, profile)``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">):</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">[</span><span class="n">q</span><span class="p">])</span>

    <span class="fm">__iter__</span> <span class="o">=</span> <span class="n">sorted_profiles_iter</span>


<div class="viewcode-block" id="HOLE"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLE">[docs]</a><span class="k">class</span> <span class="nc">HOLE</span><span class="p">(</span><span class="n">BaseHOLE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run :program:`hole` on a single frame or a DCD trajectory.</span>

<span class="sd">    :program:`hole` is part of the HOLE_ suite of programs. It is used to</span>
<span class="sd">    analyze channels and cavities in proteins, especially ion channels.</span>

<span class="sd">    Only a subset of all `HOLE control parameters`_ is supported and can be set</span>
<span class="sd">    with keyword arguments.</span>

<span class="sd">    :program:`hole` (as a FORTRAN77 program) has a number of limitations when it comes to</span>
<span class="sd">    filename lengths (must be shorter than the empirically found</span>
<span class="sd">    :attr:`HOLE.HOLE_MAX_LENGTH`). This class tries to work around them by</span>
<span class="sd">    creating temporary symlinks to files when needed but this can still fail</span>
<span class="sd">    when permissions are not correctly set on the current directory.</span>

<span class="sd">    Running :program:`hole` with the :class:`HOLE` class is a 3-step process:</span>

<span class="sd">     1. set up the class with all desired parameters</span>
<span class="sd">     2. run :program:`hole` with :meth:`HOLE.run`</span>
<span class="sd">     3. collect the data from the output file with :meth:`HOLE.collect`</span>

<span class="sd">    The class also provides some simple plotting functions of the collected</span>
<span class="sd">    data such as :meth:`HOLE.plot` or :meth:`HOLE.plot3D`.</span>

<span class="sd">    .. versionadded:: 0.7.7</span>

<span class="sd">    .. versionchanged:: 0.16.0</span>
<span class="sd">           Added `raseed` keyword argument.</span>

<span class="sd">    .. _`HOLE control parameters`:</span>
<span class="sd">       http://www.holeprogram.org/doc/old/hole_d03.html</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: Maximum number of characters in a filename (limitation of HOLE)</span>
    <span class="n">HOLE_MAX_LENGTH</span> <span class="o">=</span> <span class="mi">70</span>

    <span class="c1">#: List of residues that are ignore by default. Can be changed with</span>
    <span class="c1">#: the *ignore_residues* keyword.</span>
    <span class="n">default_ignore_residues</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SOL&quot;</span><span class="p">,</span> <span class="s2">&quot;WAT&quot;</span><span class="p">,</span> <span class="s2">&quot;TIP&quot;</span><span class="p">,</span> <span class="s2">&quot;HOH&quot;</span><span class="p">,</span> <span class="s2">&quot;K  &quot;</span><span class="p">,</span> <span class="s2">&quot;NA &quot;</span><span class="p">,</span> <span class="s2">&quot;CL &quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set up parameters to run HOLE_ on PDB *filename*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            The `filename` is used as input for HOLE in the &quot;COORD&quot; card of the</span>
<span class="sd">            input file.  It specifies the name of a PDB co-ordinate file to be</span>
<span class="sd">            used. This must be in Brookhaven protein databank format or</span>
<span class="sd">            something closely approximating this. Both ATOM and HETATM records</span>
<span class="sd">            are read. Note that if water molecules or ions are present in the</span>
<span class="sd">            channel these can be ignored on read by the use of the</span>
<span class="sd">            `ignore_residues` keyword.</span>
<span class="sd">            **Wildcard pattern**. A new feature (in release 2.1 of HOLE) was</span>
<span class="sd">            the option to include a wild card (``*``) in the filename. e.g.,</span>
<span class="sd">            ``filename=&quot;ab*.pdb&quot;`` will apply hole to all files in the</span>
<span class="sd">            directory whose name starts with ``ab`` and ends with</span>
<span class="sd">            ``.pdb``. This is intended to aid the analysis of multiple copies</span>
<span class="sd">            of the same molecule - produced during molecular dynamics or other</span>
<span class="sd">            method. The hole procedure will be applied to each file in turn</span>
<span class="sd">            with the same setup conditions (initial point, sampling distance</span>
<span class="sd">            etc.). Graphics files will contain a combination of the individual</span>
<span class="sd">            runs, one after another. Note that the pdb files are read</span>
<span class="sd">            independently so that they need not have an identical number of</span>
<span class="sd">            atoms or atom order etc. (though they should be sufficiently</span>
<span class="sd">            similar for a HOLE run from identical starting conditions to be</span>
<span class="sd">            useful).</span>
<span class="sd">        dcd : string, optional</span>
<span class="sd">            File name of DCD trajectory (must be supplied together with a</span>
<span class="sd">            matching PDB file `filename`) and then HOLE runs its analysis on</span>
<span class="sd">            each frame.</span>
<span class="sd">            It does multiple HOLE runs on positions taken from a CHARMM binary</span>
<span class="sd">            dynamics format DCD trajectory file. The `dcd` file must have</span>
<span class="sd">            exactly the same number of atoms in exactly the same order as the</span>
<span class="sd">            pdb file specified by `filename`. Note that if this option is used</span>
<span class="sd">            the pdb file is used as a template only - the coordinates are</span>
<span class="sd">            ignored. Note that structural parameters determined for each</span>
<span class="sd">            individual structure are written in a tagged format so that it is</span>
<span class="sd">            possible to extract the information from the text output file using</span>
<span class="sd">            a :program:`grep` command. The reading of the file can be</span>
<span class="sd">            controlled by the `step` keyword and/or setting</span>
<span class="sd">            :attr:`HOLE.dcd_iniskip` to the number of frames to be skipped</span>
<span class="sd">            initially.</span>
<span class="sd">        logfile : string, optional</span>
<span class="sd">            file name of the file collecting HOLE&#39;s output (which can be</span>
<span class="sd">            parsed using :meth:`HOLE.collect`);  the default is &quot;hole.out&quot;.</span>
<span class="sd">        sphpdb : string, optional</span>
<span class="sd">            path to the HOLE sph file, a PDB-like file containig the</span>
<span class="sd">            coordinates of the pore centers; the default is &quot;hole.sph&quot;.</span>
<span class="sd">            This keyword specifies the filename for output of the sphere centre</span>
<span class="sd">            information in pdb form. Its typical suffix is &quot;.sph&quot;. The</span>
<span class="sd">            co-ordinates are set to the sphere centres and the occupancies are</span>
<span class="sd">            the sphere radii. All centres are assigned the atom name QSS and</span>
<span class="sd">            residue name SPH and the residue number is set to the storage</span>
<span class="sd">            number of the centre. The file can be imported into molecular</span>
<span class="sd">            graphics programs but are likely to be bonded together in a awful</span>
<span class="sd">            manner - as the points are very close to one another. In VMD sph</span>
<span class="sd">            objects are best displayed as &quot;Points&quot;. Displaying .sph objects</span>
<span class="sd">            rather than rendered or dot surfaces can be useful to analyze the</span>
<span class="sd">            distance of particular atoms from the sphere-centre line.</span>
<span class="sd">            Most usefully .sph files can be used to produce molecular graphical</span>
<span class="sd">            output from a hole run. This is achieved by using the</span>
<span class="sd">            :program:`sph_process` program to read the .sph file.</span>
<span class="sd">        step : int, optional</span>
<span class="sd">             step size for going through the trajectory (skips `step` - 1</span>
<span class="sd">             frames); the default is 1.</span>
<span class="sd">        cpoint : array_like, optional</span>
<span class="sd">             coordinates of a point inside the pore, e.g. ``[12.3, 0.7,</span>
<span class="sd">             18.55]``. If set to ``None`` (the default) then HOLE&#39;s own search</span>
<span class="sd">             algorithm is used.</span>
<span class="sd">             `cpoint` specifies a point which lies within the channel. For</span>
<span class="sd">             simple channels such as gramicidin results do not show great</span>
<span class="sd">             sensitivity to the exact point taken. An easy way to produce an</span>
<span class="sd">             initial point is to use molecular graphics to find two atoms which</span>
<span class="sd">             lie either side of the pore and to average their co-ordinates. Or</span>
<span class="sd">             if the channel structure contains water molecules or counter ions</span>
<span class="sd">             then take the coordinates of one of these (and use the</span>
<span class="sd">             `ignore_residues` keyword to ignore them in the pore radius</span>
<span class="sd">             calculation).</span>
<span class="sd">             If this card is not specified then HOLE now (from version 2.2)</span>
<span class="sd">             attempts to make a guess where the channel will be. The procedure</span>
<span class="sd">             assumes the channel is reasonably symmetric. The initial guess on</span>
<span class="sd">             cpoint will be the centroid of all alpha carbon atoms (name &#39;CA&#39;</span>
<span class="sd">             in pdb file). This is then refined by a crude grid search up to 5</span>
<span class="sd">             Å from the original position. This procedure works most of the</span>
<span class="sd">             time but is clearly far from infallible — results should be</span>
<span class="sd">             careful checked (with molecular graphics) if it is used.</span>
<span class="sd">        cvect : array_like, optional</span>
<span class="sd">             Search direction, should be parallel to the pore axis,</span>
<span class="sd">             e.g. ``[0,0,1]`` for the z-axis. The default is ``None`` so that</span>
<span class="sd">             HOLE&#39;s built-in procedure is used.</span>
<span class="sd">             If this keyword is ``None`` then HOLE attempts to make a guess</span>
<span class="sd">             where the channel will be. The procedure assumes the channel is</span>
<span class="sd">             reasonably symmetric. The guess will be either along the X axis</span>
<span class="sd">             (1,0,0), Y axis (0,1,0) or Z axis (0,0,1). If the structure is not</span>
<span class="sd">             aligned on one of these axis the results will clearly be</span>
<span class="sd">             approximate. If a guess is used then results should be carefully</span>
<span class="sd">             checked.</span>
<span class="sd">        sample : float, optional</span>
<span class="sd">             distance of sample points in Å; the default is 0.2 Å.</span>
<span class="sd">             Specifies the distance between the planes used in the HOLE</span>
<span class="sd">             procedure. The default value should be reasonable for most</span>
<span class="sd">             purposes. However, if you wish to visualize a very tight</span>
<span class="sd">             constriction then specify a smaller value.</span>
<span class="sd">             This value determines how many points in the pore profile are</span>
<span class="sd">             calculated.</span>
<span class="sd">        dotden : int, optional</span>
<span class="sd">             density of facettes for generating a 3D pore representation;</span>
<span class="sd">             default is 15.</span>
<span class="sd">             This number controls the density of dots which will be used by</span>
<span class="sd">             the program. A sphere of dots is placed on each centre</span>
<span class="sd">             determined in the Monte Carlo procedure. Only dots which do not</span>
<span class="sd">             lie within any other sphere are considered. The actual number of</span>
<span class="sd">             dots written is therefore controlled by `dotden` and</span>
<span class="sd">             `sample`. `dotden` should be set to between 5 (few dots per</span>
<span class="sd">             sphere) and 35 (large number of dots per sphere).</span>
<span class="sd">        endrad : float, optional</span>
<span class="sd">             Radius which is considered to be the end of the pore. This</span>
<span class="sd">             keyword can be used to specify the radius above which the</span>
<span class="sd">             program regards a result as indicating that the end of the pore</span>
<span class="sd">             has been reached. The default value is 22.0 Å. This may need to</span>
<span class="sd">             be increased for large channels or reduced for small.</span>
<span class="sd">        shorto : int, optional</span>
<span class="sd">             Determines the output of output in the `logfile`; for automated processing</span>
<span class="sd">             this must be &lt; 3. The default is 0, which shows all output.</span>
<span class="sd">             0: Full text output,</span>
<span class="sd">             1: All text output given except &quot;run in progress&quot; (i.e.,</span>
<span class="sd">             detailed contemporary description of what HOLE is doing).</span>
<span class="sd">             2: Ditto plus no graph type output - only leaving minimum</span>
<span class="sd">             radius and conductance calculations.</span>
<span class="sd">             3: All text output other than input card mirroring and error messages</span>
<span class="sd">             turned off.</span>
<span class="sd">        ignore_residues : array_like, optional</span>
<span class="sd">             sequence of three-letter residues that are not taken into</span>
<span class="sd">             account during the calculation; wildcards are *not*</span>
<span class="sd">             supported. The default is ``[&quot;SOL&quot;,&quot;WAT&quot;, &quot;TIP&quot;, &quot;HOH&quot;, &quot;K &quot;,</span>
<span class="sd">             &quot;NA &quot;, &quot;CL &quot;]``.</span>
<span class="sd">        radius : string, optional</span>
<span class="sd">             path to the file specifying van der Waals radii for each atom. If</span>
<span class="sd">             set to ``None`` (the default) then a set of default radii,</span>
<span class="sd">             :data:`SIMPLE2_RAD`, is used (an extension of ``simple.rad`` from</span>
<span class="sd">             the HOLE distribution)</span>
<span class="sd">        executable : string, optional</span>
<span class="sd">             Path to the :program:`hole` executable</span>
<span class="sd">             (e.g. ``~/hole2/exe/hole``); the other programs</span>
<span class="sd">             :program:`sph_process` and :program:`sos_triangle` are assumed</span>
<span class="sd">             to live in the same directory as :program:`hole`. If</span>
<span class="sd">             :program:`hole` is found on the :envvar:`PATH` then the bare</span>
<span class="sd">             executable name is sufficient. The default is &quot;hole&quot;.</span>
<span class="sd">        raseed : int, optional</span>
<span class="sd">             integer number to start the random number generator; by default,</span>
<span class="sd">             :program:`hole` will use the time of the day (default value</span>
<span class="sd">             ``None``) but for reproducible runs (e.g., for testing) set it to</span>
<span class="sd">             an integer.</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - An alternative way to load in multiple files is a direct read</span>
<span class="sd">          from a CHARMM binary dynamics DCD coordinate file - using the</span>
<span class="sd">          `dcd` keyword or use :class:`HOLEtraj`.</span>
<span class="sd">        - HOLE is very picky and does not read all DCD-like</span>
<span class="sd">          formats [#HOLEDCD]_. If in doubt, look into the `logfile` for</span>
<span class="sd">          error diagnostics.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># list of temporary files, to be cleaned up on __del__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempfiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempdirs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_and_fix_long_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dcd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dcd&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dcd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_and_fix_long_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dcd</span><span class="p">)</span>
        <span class="c1"># HOLE docs description is confusing: step or skip??</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dcd_step</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dcd_iniskip</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpoint</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cpoint&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvect</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cvect&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dotden</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;dotden&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endrad</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;endrad&quot;</span><span class="p">,</span> <span class="mf">22.</span><span class="p">))</span>
        <span class="c1"># look at using SHORTO 2 for minimum output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shorto</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;shorto&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_residues</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;ignore_residues&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_ignore_residues</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_and_fix_long_filename</span><span class="p">(</span>
            <span class="n">realpath</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;radius&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">write_simplerad2</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raseed</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;raseed&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting up HOLE analysis for </span><span class="si">%(filename)r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using radius file </span><span class="si">%(radius)r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="c1"># guess executables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exe</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">hole_exe_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;executable&#39;</span><span class="p">,</span> <span class="s1">&#39;hole&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s1">&#39;hole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="n">hole_exe_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s1">&#39;hole&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;HOLE binary </span><span class="si">{hole_exe_name!r}</span><span class="s2"> not found.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="o">**</span><span class="nb">vars</span><span class="p">())</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%(hole_exe_name)r</span><span class="s2"> must be on the PATH or provided as keyword argument &#39;executable&#39;.&quot;</span><span class="p">,</span>
                         <span class="nb">vars</span><span class="p">())</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">,</span> <span class="n">errmsg</span><span class="p">)</span>
        <span class="n">holepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s1">&#39;hole&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s1">&#39;sos_triangle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">holepath</span><span class="p">,</span> <span class="s2">&quot;sos_triangle&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s1">&#39;sph_process&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">holepath</span><span class="p">,</span> <span class="s2">&quot;sph_process&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sphpdb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;sphpdb&quot;</span><span class="p">,</span> <span class="s2">&quot;hole.sph&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;logfile&quot;</span><span class="p">,</span> <span class="s2">&quot;hole.out&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            ! Input file for Oliver Smart&#39;s HOLE program</span>
<span class="s2">            ! written by MDAnalysis.analysis.hole.HOLE</span>
<span class="s2">            ! filename = </span><span class="si">%(filename)s</span><span class="s2"></span>
<span class="s2">            COORD  </span><span class="si">%(coordinates)s</span><span class="s2"></span>
<span class="s2">            RADIUS </span><span class="si">%(radius)s</span><span class="s2"></span>
<span class="s2">            SPHPDB </span><span class="si">%(sphpdb)s</span><span class="s2"></span>
<span class="s2">            SAMPLE </span><span class="si">%(sample)f</span><span class="s2"></span>
<span class="s2">            ENDRAD </span><span class="si">%(endrad)f</span><span class="s2"></span>
<span class="s2">            IGNORE </span><span class="si">%(ignore)s</span><span class="s2"></span>
<span class="s2">            SHORTO </span><span class="si">%(shorto)d</span><span class="s2"></span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raseed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raseed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raseed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">+=</span> <span class="s2">&quot;RASEED </span><span class="si">%(raseed)d</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fixed random number seed </span><span class="si">{}</span><span class="s2"> for reproducible &quot;</span>
                        <span class="s2">&quot;runs.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raseed</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpoint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># note: if it is None then we can&#39;t change this with a kw for run() !!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">+=</span> <span class="s2">&quot;CPOINT </span><span class="si">%(cpoint_xyz)s</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;HOLE will guess CPOINT&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># note: if it is None then we can&#39;t change this with a kw for run() !!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">+=</span> <span class="s2">&quot;CVECT  </span><span class="si">%(cvect_xyz)s</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;HOLE will guess CVECT&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcd</span><span class="p">:</span>
            <span class="c1"># CHARMD -- DCD (matches COORD)</span>
            <span class="c1"># CHARMS int int -- ignore_first_N_frames   skip_every_X_frames</span>
            <span class="c1">#        http://www.holeprogram.org/doc/old/hole_d03.html#CHARMD</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">CHARMD </span><span class="si">%(dcd)s</span><span class="se">\n</span><span class="s2">CHARMS </span><span class="si">%(dcd_iniskip)d</span><span class="s2"> </span><span class="si">%(dcd_step)d</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># sanity checks</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shorto</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;SHORTO (</span><span class="si">%d</span><span class="s2">) needs to be &lt; 3 in order to extract a HOLE profile!&quot;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">shorto</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">program</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">which</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Executable </span><span class="si">%(program)r</span><span class="s2"> not found, should have been </span><span class="si">%(path)r</span><span class="s2">.&quot;</span><span class="p">,</span>
                             <span class="nb">vars</span><span class="p">())</span>
        <span class="c1"># results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

<div class="viewcode-block" id="HOLE.check_and_fix_long_filename"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLE.check_and_fix_long_filename">[docs]</a>    <span class="k">def</span> <span class="nf">check_and_fix_long_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">tmpdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a file name suitable for HOLE.</span>

<span class="sd">        HOLE is limited to filenames &lt;= :attr:`HOLE.HOLE_MAX_LENGTH`. This method</span>

<span class="sd">        1. returns `filename` if HOLE can process it</span>
<span class="sd">        2. returns a relative path (see :func:`os.path.relpath`) if that shortens the</span>
<span class="sd">           path sufficiently</span>
<span class="sd">        3. creates a symlink to `filename` (:func:`os.symlink`) in a safe temporary</span>
<span class="sd">           directory and returns the path of the symlink. The temporary directory and</span>
<span class="sd">           the symlink are stored in :attr:`HOLE.tempfiles` and :attr:`HOLE.tempdirs`</span>
<span class="sd">           and deleted when the :class:`HOLE` instance is deleted or garbage collected.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">           file name to be processed</span>
<span class="sd">        tmpdir : string, optional</span>
<span class="sd">           By default the temporary directory is created inside the current</span>
<span class="sd">           directory in order to keep that path name short. This can be changed</span>
<span class="sd">           with the `tmpdir` keyword (e.g. one can use &quot;/tmp&quot;). The default is</span>
<span class="sd">           the current directory :data:`os.path.curdir`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        string</span>
<span class="sd">          path to the file that has a length less than</span>
<span class="sd">          :attr:`HOLE.HOLE_MAX_LENGTH`</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">          If none of the tricks for filename shortening worked. In this case,</span>
<span class="sd">          manually rename the file or recompile your version of HOLE.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HOLE_MAX_LENGTH</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">filename</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;path check: HOLE will not read </span><span class="si">%r</span><span class="s2"> because it has more than </span><span class="si">%d</span><span class="s2"> characters.&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">HOLE_MAX_LENGTH</span><span class="p">)</span>
        <span class="c1"># try a relative path</span>
        <span class="n">newname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HOLE_MAX_LENGTH</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;path check: Using relative path: </span><span class="si">%r</span><span class="s2"> --&gt; </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">newname</span>

        <span class="c1"># shorten path by creating a symlink inside a safe temp dir</span>
        <span class="n">root</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">dirname</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">)</span>
        <span class="n">newname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempdirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">HOLE_MAX_LENGTH</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span>
                <span class="s2">&quot;path check: Failed to shorten filename </span><span class="si">%r</span><span class="s2"> --&gt; </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to shorten filename </span><span class="si">%r</span><span class="s2"> --&gt; </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;path check: Using symlink: </span><span class="si">%r</span><span class="s2"> --&gt; </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newname</span></div>

<div class="viewcode-block" id="HOLE.run"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLE.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run HOLE on the input file.&quot;&quot;&quot;</span>

        <span class="n">inpname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inpfile&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">outname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;outfile&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="c1"># NOTE: If cvect and cpoint had been None in the constructor then they are</span>
        <span class="c1">#       ignored here. Arguably a bug... but then again, the keywords for run() are</span>
        <span class="c1">#       not even officially documented :-).</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cvect_xyz&quot;</span><span class="p">,</span> <span class="n">seq2str</span><span class="p">(</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cvect&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvect</span><span class="p">)))</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cpoint_xyz&quot;</span><span class="p">,</span> <span class="n">seq2str</span><span class="p">(</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cpoint&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpoint</span><span class="p">)))</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">seq2str</span><span class="p">(</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ignore_residues&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_residues</span><span class="p">)))</span>
        <span class="n">holeargs</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">holeargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">inp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">%</span> <span class="n">holeargs</span>
        <span class="k">if</span> <span class="n">inpname</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">inpname</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Wrote HOLE input file </span><span class="si">%r</span><span class="s2"> for inspection&quot;</span><span class="p">,</span> <span class="n">inpname</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Starting HOLE on </span><span class="si">%(filename)r</span><span class="s2"> (trajectory: </span><span class="si">%(dcd)r</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">holeargs</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> &lt;</span><span class="si">%s</span><span class="s2"> &gt;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s1">&#39;hole&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">inpname</span> <span class="k">if</span> <span class="n">inpname</span> <span class="k">else</span> <span class="s2">&quot;(input)&quot;</span><span class="p">),</span> <span class="n">outname</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outname</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">hole</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s1">&#39;hole&#39;</span><span class="p">]],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">hole</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outname</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="c1"># HOLE is not very good at setting returncodes so check ourselves</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;*** ERROR ***&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)):</span>
                    <span class="n">hole</span><span class="o">.</span><span class="n">returncode</span> <span class="o">=</span> <span class="mi">255</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="n">hole</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;HOLE Failure (</span><span class="si">%d</span><span class="s2">). Check output </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
                         <span class="n">hole</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">outname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">stderr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="n">stderr</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ApplicationError</span><span class="p">(</span><span class="n">hole</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="s2">&quot;HOLE </span><span class="si">{0!r}</span><span class="s2"> failed. Check output </span><span class="si">{1!r}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s1">&#39;hole&#39;</span><span class="p">],</span> <span class="n">outname</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;HOLE finished: output file </span><span class="si">%(outname)r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">())</span></div>

<div class="viewcode-block" id="HOLE.create_vmd_surface"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLE.create_vmd_surface">[docs]</a>    <span class="k">def</span> <span class="nf">create_vmd_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;hole.vmd&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process HOLE output to create a smooth pore surface suitable for VMD.</span>

<span class="sd">        Takes the :attr:`sphpdb` file and feeds it to :program:`sph_process`</span>
<span class="sd">        and :program:`sos_triangle` as described under `Visualization of HOLE</span>
<span class="sd">        results`_.</span>

<span class="sd">        Load the output file *filename* into VMD by issuing in the tcl console ::</span>

<span class="sd">           source hole.vmd</span>

<span class="sd">        The level of detail is determined by :attr:`HOLE.dotden` (which can be</span>
<span class="sd">        overriden by keyword *dotden*).</span>

<span class="sd">        The surface will be colored so that parts that are inaccessible to</span>
<span class="sd">        water (pore radius &lt; 1.15 Å) are red, water accessible parts (1.15 Å &gt;</span>
<span class="sd">        pore radius &lt; 2.30 Å) are green and wide areas (pore radius &gt; 2.30 Å</span>
<span class="sd">        are blue).</span>

<span class="sd">        .. _`Visualization of HOLE results`: http://www.holeprogram.org/doc/index.html#_producing_a_triangulated_surface_and_visualizing_in_vmd</span>
<span class="sd">        .. _`sph_process`: http://www.holeprogram.org/doc/old/hole_d04.html#sph_process</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># not sure how this works when run on multiple frames...</span>
        <span class="c1"># see http://www.holeprogram.org/doc/old/hole_d04.html#sph_process</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;dotden&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dotden</span><span class="p">)</span>

        <span class="n">fd</span><span class="p">,</span> <span class="n">tmp_sos</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.sos&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s2">&quot;sph_process&quot;</span><span class="p">],</span> <span class="s2">&quot;-sos&quot;</span><span class="p">,</span> <span class="s2">&quot;-dotden&quot;</span><span class="p">,</span>
                                              <span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dotden&#39;</span><span class="p">]</span>
                                                  <span class="p">),</span> <span class="s2">&quot;-color&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphpdb</span><span class="p">,</span>
                                              <span class="n">tmp_sos</span><span class="p">],</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmp_sos</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;sph_process failed (</span><span class="si">{0}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">returncode</span><span class="p">))</span>
            <span class="n">six</span><span class="o">.</span><span class="n">raise_from</span><span class="p">(</span><span class="ne">OSError</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="s2">&quot;sph_process failed&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmp_sos</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Could check: os.devnull if subprocess.DEVNULL not available (&gt;3.3)</span>
            <span class="c1"># Suppress stderr messages of sos_triangle</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmp_sos</span><span class="p">)</span> <span class="k">as</span> <span class="n">sos</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">triangles</span><span class="p">,</span> \
                    <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">FNULL</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s2">&quot;sos_triangle&quot;</span><span class="p">],</span> <span class="s2">&quot;-s&quot;</span><span class="p">],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">sos</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">triangles</span><span class="p">,</span>
                    <span class="n">stderr</span><span class="o">=</span><span class="n">FNULL</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;sos_triangle failed (</span><span class="si">{0}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">returncode</span><span class="p">))</span>
            <span class="n">six</span><span class="o">.</span><span class="n">raise_from</span><span class="p">(</span>
                <span class="ne">OSError</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="s2">&quot;sos_triangle failed&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmp_sos</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">filename</span></div>

<div class="viewcode-block" id="HOLE.collect"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLE.collect">[docs]</a>    <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the output from a :class:`HOLE` run into numpy recarrays.</span>

<span class="sd">        It can process outputs containing multiple frames (when a DCD was supplied to :program:`hole`).</span>

<span class="sd">        Output format::</span>

<span class="sd">            frame  rxncoord   radius</span>

<span class="sd">        The method saves the result as :attr:`HOLE.profiles`, a dictionary</span>
<span class="sd">        indexed by the frame number. Each entry is a</span>
<span class="sd">        :class:`numpy.recarray`.</span>

<span class="sd">        If the keyword `outdir` is supplied (e.g. &quot;.&quot;) then each profile is</span>
<span class="sd">        saved to a gzipped data file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        run : int or string, optional</span>
<span class="sd">            identifier, free form; default is 1</span>
<span class="sd">        outdir : string, optional</span>
<span class="sd">            save output data under `outdir`/`run` if set to any other value but</span>
<span class="sd">            ``None``; the default is ``None``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># cenxyz.cvec      radius  cen_line_D sum{s/(area point sourc</span>
        <span class="c1"># 0123456789.0123456789.0123456789.0123456789.0123456789.0123456789.</span>
        <span class="c1">#            11          22          33          44</span>
        <span class="c1"># 123456789.123456789.123456789.123456789.123456789.123456789.123456789.</span>
        <span class="c1"># 1           13</span>
        <span class="c1"># 3F12</span>
        <span class="c1">#   -27.17082    15.77469   -73.19195     0.00013   (sampled)</span>
        <span class="c1">#   -27.07082    12.91103   -69.39840     0.00032 (mid-point)</span>
        <span class="c1">#</span>
        <span class="c1"># only parse cenxyz.cvec      radius  cen_line_D</span>
        <span class="c1"># because the area can be ********</span>
        <span class="n">holeformat</span> <span class="o">=</span> <span class="n">FORTRANReader</span><span class="p">(</span><span class="s1">&#39;3F12&#39;</span><span class="p">)</span>

        <span class="n">hole_output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;holeout&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">run</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># id number</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;outdir&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Collecting HOLE profiles for run with id </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># length of trajectory --- is this really needed?? No... just for info</span>
        <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
            <span class="n">filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Glob pattern </span><span class="si">%r</span><span class="s2"> did not find any files.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Glob pattern </span><span class="si">{0!r}</span><span class="s2"> did not find any files.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Found </span><span class="si">%d</span><span class="s2"> input files based on glob pattern </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcd</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">Universe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcd</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">u</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">n_frames</span> <span class="o">-</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">dcd_iniskip</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dcd_step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Found </span><span class="si">%d</span><span class="s2"> input frames in DCD trajectory </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcd</span><span class="p">)</span>

        <span class="c1"># one recarray for each frame, indexed by frame number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Run </span><span class="si">%s</span><span class="s2">: Reading </span><span class="si">%d</span><span class="s2"> HOLE profiles from </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">run</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">hole_output</span><span class="p">)</span>
        <span class="n">hole_profile_no</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">hole_output</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hole</span><span class="p">:</span>
            <span class="n">read_data</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">hole</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>  <span class="c1"># preserve columns (FORTRAN output...)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot; Starting calculation for position number&quot;</span><span class="p">):</span>
                    <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">hole_profile_no</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                    <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Started reading profile </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">hole_profile_no</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot; cenxyz.cvec&quot;</span><span class="p">):</span>
                    <span class="n">read_data</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Started reading data&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">read_data</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">rxncoord</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">cenlineD</span> <span class="o">=</span> <span class="n">holeformat</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
                                <span class="s2">&quot;Run </span><span class="si">%d</span><span class="s2">: Problem parsing line </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                                <span class="s2">&quot;Check input file </span><span class="si">%r</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">hole_output</span><span class="p">)</span>
                            <span class="k">raise</span>
                        <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hole_profile_no</span><span class="p">,</span> <span class="n">rxncoord</span><span class="p">,</span> <span class="n">radius</span><span class="p">))</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># end of records (empty line)</span>
                        <span class="n">read_data</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">frame_hole_output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">fromrecords</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="s2">&quot;i4,f8,f8&quot;</span><span class="p">,</span>
                                                               <span class="n">names</span><span class="o">=</span><span class="s2">&quot;frame,rxncoord,radius&quot;</span><span class="p">)</span>
                        <span class="c1"># store the profile</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">[</span><span class="n">hole_profile_no</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame_hole_output</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Collected HOLE profile for frame </span><span class="si">%d</span><span class="s2"> (</span><span class="si">%d</span><span class="s2"> datapoints)&quot;</span><span class="p">,</span>
                                     <span class="n">hole_profile_no</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_hole_output</span><span class="p">))</span>
                        <span class="c1"># save a profile for each frame (for debugging and scripted processing)</span>
                        <span class="c1"># a tmp folder for each trajectory</span>
                        <span class="k">if</span> <span class="n">outdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">rundir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="s2">&quot;run_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">run</span><span class="p">))</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">rundir</span><span class="p">):</span>
                                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">rundir</span><span class="p">)</span>
                            <span class="n">frame_hole_txt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                <span class="n">rundir</span><span class="p">,</span> <span class="s2">&quot;radii_</span><span class="si">{0!s}</span><span class="s2">_</span><span class="si">{1:04d}</span><span class="s2">.dat.gz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="n">hole_profile_no</span><span class="p">))</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">frame_hole_txt</span><span class="p">,</span> <span class="n">frame_hole_output</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                <span class="s2">&quot;Finished with frame </span><span class="si">%d</span><span class="s2">, saved as </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">hole_profile_no</span><span class="p">,</span> <span class="n">frame_hole_txt</span><span class="p">)</span>
                        <span class="k">continue</span>
                        <span class="c1"># if we get here then we haven&#39;t found anything interesting</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">)</span> <span class="o">==</span> <span class="n">length</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Collected HOLE radius profiles for </span><span class="si">%d</span><span class="s2"> frames&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Missing data: Found </span><span class="si">%d</span><span class="s2"> HOLE profiles from </span><span class="si">%d</span><span class="s2"> frames.&quot;</span><span class="p">,</span>
                           <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">),</span> <span class="n">length</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tempfiles</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tempdirs</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="HOLEtraj"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLEtraj">[docs]</a><span class="k">class</span> <span class="nc">HOLEtraj</span><span class="p">(</span><span class="n">BaseHOLE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Analyze all frames in a trajectory.</span>

<span class="sd">    The :class:`HOLE` class provides a direct interface to HOLE. HOLE itself</span>
<span class="sd">    has limited support for analysing trajectories but cannot deal with all the</span>
<span class="sd">    trajectory formats understood by MDAnalysis. This class can take any</span>
<span class="sd">    universe and feed it to HOLE. It sequentially creates a temporary PDB for</span>
<span class="sd">    each frame and runs HOLE on the frame.</span>

<span class="sd">    The trajectory can be sliced by passing the `start`, `stop`, and `step`</span>
<span class="sd">    keywords to :meth:`HOLEtraj.run`. (:program:`hole` is not fast so slicing a</span>
<span class="sd">    trajectory is recommended.)</span>

<span class="sd">    Frames of the trajectory can be associated with order parameters (e.g.,</span>
<span class="sd">    RMSD) in order to group the HOLE profiles by order parameter (see the</span>
<span class="sd">    `orderparameters` keyword).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">universe</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set up the HOLE analysis over a trajectory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        universe : :class:`~MDAnalysis.core.universe.Universe`</span>
<span class="sd">             The input trajectory is taken from a</span>
<span class="sd">             :class:`~MDAnalysis.core.universe.Universe`. The trajectory is</span>
<span class="sd">             converted to a sequence of PDB files and :class:`HOLE` is run on</span>
<span class="sd">             each individual file.</span>
<span class="sd">        orderparameters : array_like or string, optional</span>
<span class="sd">             Sequence or text file containing order parameters (float</span>
<span class="sd">             numbers) corresponding to the frames in the trajectory.</span>
<span class="sd">        select : string, optional</span>
<span class="sd">             selection string for</span>
<span class="sd">             :meth:`~MDAnalysis.core.universe.Universe.select_atoms` to select</span>
<span class="sd">             the group of atoms that is to be analysed by HOLE. The default is</span>
<span class="sd">             &quot;protein&quot; to include all protein residues.</span>
<span class="sd">        cpoint : bool or array_like, optional</span>
<span class="sd">             Point inside the pore to start the HOLE search procedure. The</span>
<span class="sd">             default is ``None`` to select HOLE&#39;s internal search procedure.</span>

<span class="sd">             If set to ``True`` then *cpoint* is guessed as the</span>
<span class="sd">             :meth:`~MDAnalysis.core.groups.AtomGroup.center_of_geometry` of</span>
<span class="sd">             the `select` from the first frame of the trajectory.</span>

<span class="sd">             If `cpoint` is not set or set to ``None`` then HOLE guesses it</span>
<span class="sd">             with its own algorithm (for each individual frame).</span>
<span class="sd">        kwargs : `**kwargs`</span>
<span class="sd">             All other keywords are passed on to :class:`HOLE` (see there for</span>
<span class="sd">             description).</span>


<span class="sd">        .. versionchanged:: 1.0.0</span>
<span class="sd">           Support for the `start`, `stop`, and `step` keywords has been</span>
<span class="sd">           removed. These should instead be passed to :meth:`HOLEtraj.run`.</span>

<span class="sd">        .. versionchanged:: 1.0.0</span>
<span class="sd">           Changed `selection` keyword to `select`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">universe</span> <span class="o">=</span> <span class="n">universe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">,</span> <span class="s2">&quot;protein&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orderparametersfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;orderparameters&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cpoint</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cpoint&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpoint</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_cpoint</span><span class="p">(</span><span class="n">select</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Guessed CPOINT = </span><span class="si">%r</span><span class="s2"> from selection </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cpoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpoint</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hole_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="c1"># processing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orderparameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_orderparameters</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orderparametersfile</span><span class="p">)</span>

<div class="viewcode-block" id="HOLEtraj.guess_cpoint"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLEtraj.guess_cpoint">[docs]</a>    <span class="k">def</span> <span class="nf">guess_cpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="s2">&quot;protein&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Guess a point inside the pore.</span>

<span class="sd">        This method simply uses the center of geometry of the selection as a</span>
<span class="sd">        guess. `select` is &quot;protein&quot; by default.</span>

<span class="sd">        .. versionchanged:: 1.0.0</span>
<span class="sd">           Changed `selection` keyword to `select`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="n">select</span><span class="p">)</span><span class="o">.</span><span class="n">center_of_geometry</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_process_orderparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read orderparameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : string or array_like or ``None``</span>
<span class="sd">           * string: Read orderparameters from *filename*.</span>
<span class="sd">           * array/list: use as is</span>
<span class="sd">           * ``None``: assign frame numbers from trajectory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># frame numbers (starting with 0, convention in MDAnalysis &gt;= 0.11.0)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">n_frames</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Order parameter array must be 1D.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">n_frames</span><span class="p">:</span>
            <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;Not same number of orderparameters (</span><span class="si">{0}</span><span class="s2">) as trajectory frames (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">n_frames</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">q</span>

<div class="viewcode-block" id="HOLEtraj.run"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLEtraj.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run HOLE on the whole trajectory and collect profiles.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start : int, optional</span>
<span class="sd">            First frame of trajectory to analyse, Default: None (first frame)</span>
<span class="sd">        stop : int, optional</span>
<span class="sd">            Last frame of trajectory to analyse, Default: None (last frame)</span>
<span class="sd">        step : int, optional</span>
<span class="sd">            Step between frames to analyse, Default: None (use every frame)</span>

<span class="sd">        .. versionchanged:: 1.0.0</span>
<span class="sd">           Undocumented support for setting :class:`HOLE` parameters via</span>
<span class="sd">           :meth:`HOLEtraj.run` has been removed. This should now exclusively</span>
<span class="sd">           be done on :class:`HOLEtraj` construction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">check_slice_indices</span><span class="p">(</span>
            <span class="n">start</span><span class="p">,</span>
            <span class="n">stop</span><span class="p">,</span>
            <span class="n">step</span>
        <span class="p">)</span>
        <span class="n">hole_kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hole_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">profiles</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>  <span class="c1"># index by orderparameters: NOTE: can overwrite!</span>

        <span class="c1"># better: if not a DCD, convert to DCD because HOLE can read it (does it need a PSF?)</span>
        <span class="c1"># ... maybe faster than splittinginto PDBs...</span>
        <span class="c1"># but currently HOLE chokes on MDAnalysis-generated DCDs (header comment wrong/too long?)</span>

        <span class="c1"># probably slow (especially with additional linking for filename length) --</span>
        <span class="c1"># can&#39;t we do this in memory?? Or at least check that we can get a local tmp dir</span>

        <span class="c1"># TODO: alternatively, dump all frames with leading framenumber and use a wildcard</span>
        <span class="c1">#       (although the file renaming might create problems...)</span>
        <span class="n">protein</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">q</span><span class="p">,</span> <span class="n">ts</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orderparameters</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">:</span><span class="n">step</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">:</span><span class="n">step</span><span class="p">]):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;HOLE analysis frame </span><span class="si">%4d</span><span class="s2"> (orderparameter </span><span class="si">%g</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="n">fd</span><span class="p">,</span> <span class="n">pdbfile</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.pdb&quot;</span><span class="p">)</span>
            <span class="c1"># only need an empty file that can be overwritten, close right away (Issue 129)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">protein</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)</span>
                <span class="n">hole_profiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_hole</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">,</span> <span class="o">**</span><span class="n">hole_kw</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hole_profiles</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Got </span><span class="si">{0}</span><span class="s2"> profiles (</span><span class="si">{1}</span><span class="s2">) --- should be 1 (time step </span><span class="si">{2}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">hole_profiles</span><span class="p">),</span> <span class="n">hole_profiles</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">ts</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
            <span class="n">profiles</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hole_profiles</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span> <span class="o">=</span> <span class="n">profiles</span></div>

<div class="viewcode-block" id="HOLEtraj.run_hole"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLEtraj.run_hole">[docs]</a>    <span class="k">def</span> <span class="nf">run_hole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdbfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run HOLE on a single PDB file *pdbfile*.&quot;&quot;&quot;</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">HOLE</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">H</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">H</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">H</span><span class="o">.</span><span class="n">profiles</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2005-2020, Naveen Michaud-Agrawal, Elizabeth J. Denning, Christian Beckstein (logo), Joshua L. Adelman, Shobhit Agarwal, Irfan Alibay, Anshul Angaria, Luís Pedro Borges Araújo, Balasubramanian, Utkarsh Bansal, Jonathan Barnoud, Tone Bengtsen, Alejandro Bernardin, Ninad Bhat, Mateusz Bieniek, Wouter Boomsma, Jose Borreguero, Cédric Bouysset, Bart Bruininks, Sébastien Buchoux, Sören von Bülow, David Caplan, Yuanyu Chang, Matthieu Chavent, Kathleen Clark, Charlie Cook, Ruggero Cortini, Davide Cruz, Robert Delgado, John Detlefs, Xavier Deupi, Jan Domanski, David L. Dotson, Ali Ehlen, Shujie Fan, Lennard van der Feltz, Philip Fowler, Guillaume Fraux, Joseph Goose, Richard J. Gowers, Lukas Grossar, Abhinav Gupta, Akshay Gupta, Benjamin Hall, Ivan Hristov, Eugen Hruska, Kyle J. Huston, Joe Jordan, Jon Kapla, Navya Khare, Andrew William King, Abhishek A. Kognole, Max Linke, Philip Loche, Jinju Lu, Hugo MacDermott-Opeskin, Micaela Matta, Andrew R. McCluskey, Robert McGibbon, Rocco Meli, Manuel Nuno Melo, Dominik &#39;Rathann&#39; Mierzejewski, Henry Mull, Morgan L. Nance, Fiona B. Naughton, Alex Nesterenko, Hai Nguyen, Sang Young Noh, Daniele Padula, Nabarun Pal, Mattia F. Palermo, Danny Parton, Joshua L. Phillips, Kashish Punjani, Michael Quevillon, Vedant Rathore, Tyler Reddy, Pedro Reis, Paul Rigor, Carlos Yanez S., Utkarsh Saxena, Sean L. Seyler, Faraaz Shah, Abhishek Shandilya, Shubham Sharma, Paul Smith, Andy Somogyi, Caio S. Souza, Shantanu Srivastava, Lukas Stelzl, Gorman Stock, Fenil Suchak, Ayush Suhane, Matthijs Tadema, Joao Miguel Correia Teixeira, Xiki Tempula, Matthew W. Thompson, Hao Tian, Matteo Tiberti, Wiep van der Toorn, Isaac Virshup, Lily Wang, Nestor Wendt, Zhiyi Wu, Zhuyi Xue, Juan Eiros Zamora, Johannes Zeman, Yibo Zhang, Yuxuan Zhuang, and Oliver Beckstein

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>