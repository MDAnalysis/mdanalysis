<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MDAnalysis.analysis.legacy.x3dna &mdash; MDAnalysis 2.6.0 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/msmb.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/mdanalysis-logo.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
        <script src="../../../../_static/js/versions.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within MDAnalysis 2.6.0 documentation"
          href="../../../../_static/opensearch.xml"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../../../../index.html">
            
              <img src="../../../../_static/mdanalysis-logo-thin.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.6.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/overview.html">1. Overview over MDAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/topology.html">2. The topology system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/selections.html">3. Selection commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/analysis_modules.html">4. Analysis modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/topology_modules.html">5. Topology modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/coordinates_modules.html">6. Coordinates modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/converters.html">7. Converter modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/trajectory_transformations.html">8. Trajectory transformations (“on-the-fly” transformations)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/selections_modules.html">9. Selection exporters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/auxiliary_modules.html">10. Auxiliary modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/core_modules.html">11. Core modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/visualization_modules.html">12. Visualization modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/lib_modules.html">13. Library functions — <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.lib</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/version.html">14. Version information for MDAnalysis - <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.version</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/units.html">15. Constants and unit conversion — <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.units</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/exceptions.html">16. Custom exceptions and warnings — <code class="xref py py-mod docutils literal notranslate"><span class="pre">MDAnalysis.exceptions</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation_pages/references.html">17. References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">MDAnalysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">MDAnalysis.analysis.legacy.x3dna</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for MDAnalysis.analysis.legacy.x3dna</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- Mode: python; tab-width: 4; indent-tabs-mode:nil; coding:utf-8 -*-</span>
<span class="c1"># vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4</span>
<span class="c1">#</span>
<span class="c1"># MDAnalysis --- https://www.mdanalysis.org</span>
<span class="c1"># Copyright (c) 2006-2017 The MDAnalysis Development Team and contributors</span>
<span class="c1"># (see the file AUTHORS for the full list of names)</span>
<span class="c1">#</span>
<span class="c1"># Released under the GNU Public Licence, v2 or any higher version</span>
<span class="c1">#</span>
<span class="c1"># Please cite your use of MDAnalysis in published work:</span>
<span class="c1">#</span>
<span class="c1"># R. J. Gowers, M. Linke, J. Barnoud, T. J. E. Reddy, M. N. Melo, S. L. Seyler,</span>
<span class="c1"># D. L. Dotson, J. Domanski, S. Buchoux, I. M. Kenney, and O. Beckstein.</span>
<span class="c1"># MDAnalysis: A Python package for the rapid analysis of molecular dynamics</span>
<span class="c1"># simulations. In S. Benthall and S. Rostrup editors, Proceedings of the 15th</span>
<span class="c1"># Python in Science Conference, pages 102-109, Austin, TX, 2016. SciPy.</span>
<span class="c1"># doi: 10.25080/majora-629e541a-00e</span>
<span class="c1">#</span>
<span class="c1"># N. Michaud-Agrawal, E. J. Denning, T. B. Woolf, and O. Beckstein.</span>
<span class="c1"># MDAnalysis: A Toolkit for the Analysis of Molecular Dynamics Simulations.</span>
<span class="c1"># J. Comput. Chem. 32 (2011), 2319--2327, doi:10.1002/jcc.21787</span>
<span class="c1">#</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Generation and Analysis of X3DNA helicoidal parameter profiles --- :mod:`MDAnalysis.analysis.legacy.x3dna`</span>
<span class="sd">==========================================================================================================</span>

<span class="sd">:Author: Elizabeth Denning</span>
<span class="sd">:Year: 2013-2014</span>
<span class="sd">:Copyright: GNU Public License v2</span>

<span class="sd">.. versionadded:: 0.8</span>
<span class="sd">.. versionchanged:: 0.16.0</span>
<span class="sd">   This module is difficult to test due to restrictions on the X3DNA_ code. It</span>
<span class="sd">   is therefore considered unmaintained and legacy code. It was moved to the</span>
<span class="sd">   :mod:`MDAnalysis.analysis.legacy` package (see `issue 906`_)</span>

<span class="sd">.. _`issue 906`: https://github.com/MDAnalysis/mdanalysis/issues/906</span>

<span class="sd">With the help of this module, X3DNA_ can be run on frames in a trajectory. Data</span>
<span class="sd">can be combined and analyzed. X3DNA_ :cite:p:`Lu2003,Lu2008` must be installed</span>
<span class="sd">separately.</span>


<span class="sd">.. rubric:: References</span>

<span class="sd">.. bibliography::</span>
<span class="sd">    :filter: False</span>
<span class="sd">    :style: MDA</span>

<span class="sd">    Lu2003</span>
<span class="sd">    Lu2008</span>

<span class="sd">.. _X3DNA: http://x3dna.org/</span>


<span class="sd">Example applications</span>
<span class="sd">--------------------</span>

<span class="sd">Single structure</span>
<span class="sd">~~~~~~~~~~~~~~~~</span>

<span class="sd">B-DNA structure::</span>

<span class="sd">   from MDAnalysis.analysis.x3dna import X3DNA, X3DNAtraj</span>
<span class="sd">   from MDAnalysis.tests.datafiles import PDB_X3DNA</span>

<span class="sd">   # set path to your x3dna binary in bashrc file</span>
<span class="sd">   H = X3DNA(PDB_X3DNA, executable=&quot;x3dna_ensemble analyze -b 355d.bps -p pdbfile&quot;)</span>
<span class="sd">   H.run()</span>
<span class="sd">   H.collect()</span>
<span class="sd">   H.plot()</span>


<span class="sd">Trajectory</span>
<span class="sd">~~~~~~~~~~</span>

<span class="sd">Analyzing a trajectory::</span>

<span class="sd">  u = MDAnalysis.Universe(psf, trajectory)</span>
<span class="sd">  H = X3DNAtraj(u, ...)</span>
<span class="sd">  H.run()</span>
<span class="sd">  H.plot()</span>
<span class="sd">  H.save()</span>

<span class="sd">The profiles are available as the attribute :attr:`X3DNAtraj.profiles`</span>
<span class="sd">(``H.profiles`` in the example) and are indexed by frame number but</span>
<span class="sd">can also be indexed by an arbitrary order parameter as shown in the</span>
<span class="sd">next example.</span>



<span class="sd">Analysis classes</span>
<span class="sd">----------------</span>

<span class="sd">.. autoclass:: X3DNA</span>
<span class="sd">   :members:</span>
<span class="sd">   :inherited-members:</span>

<span class="sd">   .. attribute:: profiles</span>

<span class="sd">      ``x3dna_ensemble analyze -b 355d.bps -p pdbfile attribute``:</span>
<span class="sd">      After running :meth:`X3DNA.collect`, this dict contains all the</span>
<span class="sd">      X3DNA profiles, indexed by the frame number. If only a single</span>
<span class="sd">      frame was analyzed then this will be ``X3DNA.profiles[0]``. Note</span>
<span class="sd">      that the order is random; one needs to sort the keys first.</span>

<span class="sd">.. autoclass:: X3DNAtraj</span>
<span class="sd">   :members:</span>
<span class="sd">   :inherited-members:</span>

<span class="sd">   .. attribute:: profiles</span>

<span class="sd">      After running :meth:`X3DNA.collect`, this dict contains all the</span>
<span class="sd">      X3DNA profiles, indexed by the frame number.</span>



<span class="sd">Utilities</span>
<span class="sd">---------</span>

<span class="sd">.. autoexception:: ApplicationError</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">MDAnalysis</span> <span class="kn">import</span> <span class="n">ApplicationError</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.lib.util</span> <span class="kn">import</span> <span class="n">which</span><span class="p">,</span> <span class="n">realpath</span><span class="p">,</span> <span class="n">asiterable</span>

<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;MDAnalysis.analysis.x3dna&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">mean_std_from_x3dnaPickle</span><span class="p">(</span><span class="n">profile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get mean and standard deviation of helicoidal parameters from a saved `profile`.</span>

<span class="sd">    The `profile` should have been saved with :meth:`BaseX3DNA.save`. Then</span>
<span class="sd">    load it with ::</span>

<span class="sd">      profile = cPickle.load(open(&quot;x3dna.pickle&quot;))</span>
<span class="sd">      h_mean, h_std = mean_std_from_x3dnaPickle(profile)</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    profile : dict</span>
<span class="sd">        A :attr:`X3DNA.profiles` dict with results from the</span>
<span class="sd">        :class:`X3DNA` analysis.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (list, list)</span>
<span class="sd">        The tuple contains two lists with the means and the standard deviations</span>
<span class="sd">        for the helicoidal parameters. The order for both lists is ``[shear,</span>
<span class="sd">        stretch, stagger, buckle, propeller, opening, shift, slide, rise, tilt,</span>
<span class="sd">        roll, twist]``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">profile</span><span class="o">.</span><span class="n">x3dna_param</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">bp_shear</span><span class="p">,</span> <span class="n">bp_stretch</span><span class="p">,</span> <span class="n">bp_stagger</span><span class="p">,</span> <span class="n">bp_rise</span><span class="p">,</span> <span class="n">bp_shift</span><span class="p">,</span> <span class="n">bp_slide</span><span class="p">,</span> <span class="n">bp_buckle</span><span class="p">,</span> <span class="n">bp_prop</span><span class="p">,</span> <span class="n">bp_open</span><span class="p">,</span> <span class="n">bp_tilt</span><span class="p">,</span> <span class="n">bp_roll</span><span class="p">,</span>\
            <span class="n">bp_twist</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">profile</span><span class="p">)):</span>
            <span class="n">bp_shear</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Shear</span><span class="p">)</span>
            <span class="n">bp_stretch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Stretch</span><span class="p">)</span>
            <span class="n">bp_stagger</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Stagger</span><span class="p">)</span>
            <span class="n">bp_buckle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Buckle</span><span class="p">)</span>
            <span class="n">bp_prop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Propeller</span><span class="p">)</span>
            <span class="n">bp_open</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Opening</span><span class="p">)</span>
            <span class="n">bp_rise</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Rise</span><span class="p">)</span>
            <span class="n">bp_shift</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Shift</span><span class="p">)</span>
            <span class="n">bp_slide</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Slide</span><span class="p">)</span>
            <span class="n">bp_tilt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Tilt</span><span class="p">)</span>
            <span class="n">bp_roll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Roll</span><span class="p">)</span>
            <span class="n">bp_twist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Twist</span><span class="p">)</span>
        <span class="n">bp_shear</span><span class="p">,</span> <span class="n">bp_stretch</span><span class="p">,</span> <span class="n">bp_stagger</span><span class="p">,</span> <span class="n">bp_rise</span><span class="p">,</span> <span class="n">bp_shift</span><span class="p">,</span> <span class="n">bp_slide</span><span class="p">,</span> <span class="n">bp_buckle</span><span class="p">,</span> <span class="n">bp_prop</span><span class="p">,</span> <span class="n">bp_open</span><span class="p">,</span> <span class="n">bp_tilt</span><span class="p">,</span> <span class="n">bp_roll</span><span class="p">,</span>\
            <span class="n">bp_twist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_shear</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_stretch</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_stagger</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_rise</span><span class="p">),</span>\
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_shift</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_slide</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_buckle</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_prop</span><span class="p">),</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_open</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_tilt</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_roll</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_twist</span><span class="p">)</span>
        <span class="n">na_avg</span><span class="p">,</span> <span class="n">na_std</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bp_shear</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="n">na_avg</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_shear</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_stretch</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_stagger</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_buckle</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_prop</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_open</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_shift</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_slide</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_rise</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_tilt</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_roll</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_twist</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])])</span>
            <span class="n">na_std</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_shear</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_stretch</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_stagger</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_buckle</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_prop</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_open</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_shift</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_slide</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_rise</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_tilt</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_roll</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_twist</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bp_rise</span><span class="p">,</span> <span class="n">bp_shift</span><span class="p">,</span> <span class="n">bp_slide</span><span class="p">,</span> <span class="n">bp_tilt</span><span class="p">,</span> <span class="n">bp_roll</span><span class="p">,</span> <span class="n">bp_twist</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">profile</span><span class="p">)):</span>
            <span class="c1">#print i</span>
            <span class="n">bp_rise</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Rise</span><span class="p">)</span>
            <span class="n">bp_shift</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Shift</span><span class="p">)</span>
            <span class="n">bp_slide</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Slide</span><span class="p">)</span>
            <span class="n">bp_tilt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Tilt</span><span class="p">)</span>
            <span class="n">bp_roll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Roll</span><span class="p">)</span>
            <span class="n">bp_twist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Twist</span><span class="p">)</span>
        <span class="n">bp_rise</span><span class="p">,</span> <span class="n">bp_shift</span><span class="p">,</span> <span class="n">bp_slide</span><span class="p">,</span> <span class="n">bp_tilt</span><span class="p">,</span> <span class="n">bp_roll</span><span class="p">,</span> <span class="n">bp_twist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_shear</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_stretch</span><span class="p">),</span>\
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_stagger</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_rise</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_shift</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_slide</span><span class="p">),</span>\
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_buckle</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_prop</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_open</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_tilt</span><span class="p">),</span>\
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_roll</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_twist</span><span class="p">)</span>
        <span class="n">na_avg</span><span class="p">,</span> <span class="n">na_std</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bp_shift</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="n">na_avg</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_shift</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_slide</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_rise</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_tilt</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_roll</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_twist</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])])</span>
            <span class="n">na_std</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_shift</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_slide</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_rise</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_tilt</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_roll</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_twist</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])])</span>

    <span class="n">na_avg</span><span class="p">,</span> <span class="n">na_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">na_avg</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">na_std</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">na_avg</span><span class="p">,</span> <span class="n">na_std</span>


<span class="k">class</span> <span class="nc">BaseX3DNA</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Baseclass for X3DNA_ analysis, providing plotting and utility functions.</span>

<span class="sd">    When methods return helicoidal basepair parameter as lists, then the order</span>
<span class="sd">    is always</span>

<span class="sd">    ====== ==============</span>
<span class="sd">    index  parameter</span>
<span class="sd">    ====== ==============</span>
<span class="sd">     0     shear</span>
<span class="sd">     1     stretch</span>
<span class="sd">     2     stagger</span>
<span class="sd">     3     buckle</span>
<span class="sd">     4     propeller</span>
<span class="sd">     5     opening</span>
<span class="sd">     6     shift</span>
<span class="sd">     7     slide</span>
<span class="sd">     8     rise</span>
<span class="sd">     9     tilt</span>
<span class="sd">    10     roll</span>
<span class="sd">    11     twist</span>
<span class="sd">    ====== ==============</span>

<span class="sd">    for each nucleic acid pair.</span>

<span class="sd">    .. _X3DNA: http://x3dna.org</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;x3dna.pickle&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save :attr:`profiles` as a Python pickle file *filename*.</span>

<span class="sd">        Load profiles dictionary with ::</span>

<span class="sd">           import cPickle</span>
<span class="sd">           profiles = cPickle.load(open(filename))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">cPickle</span>

        <span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">),</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mean_std</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the mean and standard deviation of base parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (list, list)</span>
<span class="sd">            The tuple contains two lists with the means and the standard deviations</span>
<span class="sd">            for the helicoidal parameters. The order for both lists is ``[shear,</span>
<span class="sd">            stretch, stagger, buckle, propeller, opening, shift, slide, rise, tilt,</span>
<span class="sd">            roll, twist]``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bp_shear</span><span class="p">,</span> <span class="n">bp_stretch</span><span class="p">,</span> <span class="n">bp_stagger</span><span class="p">,</span> <span class="n">bp_rise</span><span class="p">,</span> <span class="n">bp_shift</span><span class="p">,</span> <span class="n">bp_slide</span><span class="p">,</span> <span class="n">bp_buckle</span><span class="p">,</span> <span class="n">bp_prop</span><span class="p">,</span> <span class="n">bp_open</span><span class="p">,</span> <span class="n">bp_tilt</span><span class="p">,</span> <span class="n">bp_roll</span><span class="p">,</span>\
            <span class="n">bp_twist</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">)):</span>
            <span class="n">bp_shear</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Shear</span><span class="p">)</span>
            <span class="n">bp_stretch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Stretch</span><span class="p">)</span>
            <span class="n">bp_stagger</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Stagger</span><span class="p">)</span>
            <span class="n">bp_buckle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Buckle</span><span class="p">)</span>
            <span class="n">bp_prop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Propeller</span><span class="p">)</span>
            <span class="n">bp_open</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Opening</span><span class="p">)</span>
            <span class="n">bp_rise</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Rise</span><span class="p">)</span>
            <span class="n">bp_shift</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Shift</span><span class="p">)</span>
            <span class="n">bp_slide</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Slide</span><span class="p">)</span>
            <span class="n">bp_tilt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Tilt</span><span class="p">)</span>
            <span class="n">bp_roll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Roll</span><span class="p">)</span>
            <span class="n">bp_twist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Twist</span><span class="p">)</span>
        <span class="n">bp_shear</span><span class="p">,</span> <span class="n">bp_stretch</span><span class="p">,</span> <span class="n">bp_stagger</span><span class="p">,</span> <span class="n">bp_rise</span><span class="p">,</span> <span class="n">bp_shift</span><span class="p">,</span> <span class="n">bp_slide</span><span class="p">,</span> <span class="n">bp_buckle</span><span class="p">,</span> <span class="n">bp_prop</span><span class="p">,</span> <span class="n">bp_open</span><span class="p">,</span> <span class="n">bp_tilt</span><span class="p">,</span> <span class="n">bp_roll</span><span class="p">,</span>\
            <span class="n">bp_twist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_shear</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_stretch</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_stagger</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_rise</span><span class="p">),</span>\
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_shift</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_slide</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_buckle</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_prop</span><span class="p">),</span>\
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_open</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_tilt</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_roll</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_twist</span><span class="p">)</span>
        <span class="n">na_avg</span><span class="p">,</span> <span class="n">na_std</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bp_shear</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="n">na_avg</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_shear</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_stretch</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_stagger</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_buckle</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_prop</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_open</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_shift</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_slide</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_rise</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_tilt</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_roll</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_twist</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])])</span>
            <span class="n">na_std</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_shear</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_stretch</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_stagger</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_buckle</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_prop</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_open</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_shift</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_slide</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_rise</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_tilt</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_roll</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_twist</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])])</span>
        <span class="n">na_avg</span><span class="p">,</span> <span class="n">na_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">na_avg</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">na_std</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">na_avg</span><span class="p">,</span> <span class="n">na_std</span>

    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the mean value for the base parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The list contains the means for the helicoidal parameters. The</span>
<span class="sd">            order is ``[shear, stretch, stagger, buckle, propeller, opening,</span>
<span class="sd">            shift, slide, rise, tilt, roll, twist]``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bp_shear</span><span class="p">,</span> <span class="n">bp_stretch</span><span class="p">,</span> <span class="n">bp_stagger</span><span class="p">,</span> <span class="n">bp_rise</span><span class="p">,</span> <span class="n">bp_shift</span><span class="p">,</span> <span class="n">bp_slide</span><span class="p">,</span> <span class="n">bp_buckle</span><span class="p">,</span> <span class="n">bp_prop</span><span class="p">,</span> <span class="n">bp_open</span><span class="p">,</span> <span class="n">bp_tilt</span><span class="p">,</span> <span class="n">bp_roll</span><span class="p">,</span>\
            <span class="n">bp_twist</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">)):</span>
            <span class="n">bp_shear</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Shear</span><span class="p">)</span>
            <span class="n">bp_stretch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Stretch</span><span class="p">)</span>
            <span class="n">bp_stagger</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Stagger</span><span class="p">)</span>
            <span class="n">bp_buckle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Buckle</span><span class="p">)</span>
            <span class="n">bp_prop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Propeller</span><span class="p">)</span>
            <span class="n">bp_open</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Opening</span><span class="p">)</span>
            <span class="n">bp_rise</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Rise</span><span class="p">)</span>
            <span class="n">bp_shift</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Shift</span><span class="p">)</span>
            <span class="n">bp_slide</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Slide</span><span class="p">)</span>
            <span class="n">bp_tilt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Tilt</span><span class="p">)</span>
            <span class="n">bp_roll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Roll</span><span class="p">)</span>
            <span class="n">bp_twist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Twist</span><span class="p">)</span>
        <span class="n">bp_shear</span><span class="p">,</span> <span class="n">bp_stretch</span><span class="p">,</span> <span class="n">bp_stagger</span><span class="p">,</span> <span class="n">bp_rise</span><span class="p">,</span> <span class="n">bp_shift</span><span class="p">,</span> <span class="n">bp_slide</span><span class="p">,</span> <span class="n">bp_buckle</span><span class="p">,</span> <span class="n">bp_prop</span><span class="p">,</span> <span class="n">bp_open</span><span class="p">,</span> <span class="n">bp_tilt</span><span class="p">,</span> <span class="n">bp_roll</span><span class="p">,</span>\
            <span class="n">bp_twist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_shear</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_stretch</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_stagger</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_rise</span><span class="p">),</span>\
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_shift</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_slide</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_buckle</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_prop</span><span class="p">),</span>\
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_open</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_tilt</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_roll</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_twist</span><span class="p">)</span>

        <span class="n">na_avg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bp_shear</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="n">na_avg</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_shear</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_stretch</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_stagger</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_buckle</span><span class="p">[:</span><span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_prop</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_open</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_shift</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_slide</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_rise</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_tilt</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_roll</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bp_twist</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])])</span>
        <span class="n">na_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">na_avg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">na_avg</span>

    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the standard deviation for the base parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The list contains the standard deviations for the helicoidal</span>
<span class="sd">            parameters. The order is ``[shear, stretch, stagger, buckle,</span>
<span class="sd">            propeller, opening, shift, slide, rise, tilt, roll, twist]``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bp_shear</span><span class="p">,</span> <span class="n">bp_stretch</span><span class="p">,</span> <span class="n">bp_stagger</span><span class="p">,</span> <span class="n">bp_rise</span><span class="p">,</span> <span class="n">bp_shift</span><span class="p">,</span> <span class="n">bp_slide</span><span class="p">,</span> <span class="n">bp_buckle</span><span class="p">,</span> <span class="n">bp_prop</span><span class="p">,</span> <span class="n">bp_open</span><span class="p">,</span> <span class="n">bp_tilt</span><span class="p">,</span> <span class="n">bp_roll</span><span class="p">,</span>\
            <span class="n">bp_twist</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">)):</span>
            <span class="n">bp_shear</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Shear</span><span class="p">)</span>
            <span class="n">bp_stretch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Stretch</span><span class="p">)</span>
            <span class="n">bp_stagger</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Stagger</span><span class="p">)</span>
            <span class="n">bp_buckle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Buckle</span><span class="p">)</span>
            <span class="n">bp_prop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Propeller</span><span class="p">)</span>
            <span class="n">bp_open</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Opening</span><span class="p">)</span>
            <span class="n">bp_rise</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Rise</span><span class="p">)</span>
            <span class="n">bp_shift</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Shift</span><span class="p">)</span>
            <span class="n">bp_slide</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Slide</span><span class="p">)</span>
            <span class="n">bp_tilt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Tilt</span><span class="p">)</span>
            <span class="n">bp_roll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Roll</span><span class="p">)</span>
            <span class="n">bp_twist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Twist</span><span class="p">)</span>
        <span class="n">bp_shear</span><span class="p">,</span> <span class="n">bp_stretch</span><span class="p">,</span> <span class="n">bp_stagger</span><span class="p">,</span> <span class="n">bp_rise</span><span class="p">,</span> <span class="n">bp_shift</span><span class="p">,</span> <span class="n">bp_slide</span><span class="p">,</span> <span class="n">bp_buckle</span><span class="p">,</span> <span class="n">bp_prop</span><span class="p">,</span> <span class="n">bp_open</span><span class="p">,</span> <span class="n">bp_tilt</span><span class="p">,</span> <span class="n">bp_roll</span><span class="p">,</span>\
            <span class="n">bp_twist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_shear</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_stretch</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_stagger</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_rise</span><span class="p">),</span>\
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_shift</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_slide</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_buckle</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_prop</span><span class="p">),</span>\
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_open</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_tilt</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_roll</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bp_twist</span><span class="p">)</span>

        <span class="n">na_std</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bp_shear</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="n">na_std</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_shear</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_stretch</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_stagger</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_buckle</span><span class="p">[:</span><span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_prop</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_open</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_shift</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_slide</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_rise</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_tilt</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_roll</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bp_twist</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])])</span>
        <span class="n">na_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">na_std</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">na_std</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot time-averaged base parameters for each basse pair in a 1D graph.</span>

<span class="sd">        One plot is produced for each parameter. It shows the the mean and</span>
<span class="sd">        standard deviation for each individual base pair. Each plot is saved to</span>
<span class="sd">        PNG file with name &quot;&lt;parameter_name&gt;.png&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : matplotlib.pyplot.Axes (optional)</span>
<span class="sd">             Provide `ax` to have all plots plotted in the same axes.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">na_avg</span><span class="p">,</span> <span class="n">na_std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_std</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">na_avg</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">na_avg</span><span class="p">[:,</span> <span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">na_avg</span><span class="p">[:,</span> <span class="n">k</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">na_std</span><span class="p">[:,</span> <span class="n">k</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;-o&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">na_avg</span><span class="p">[:,</span> <span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Nucleic Acid Number&quot;</span><span class="p">)</span>
            <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Shear&quot;</span><span class="p">,</span> <span class="s2">&quot;Stretch&quot;</span><span class="p">,</span> <span class="s2">&quot;Stagger&quot;</span><span class="p">,</span> <span class="s2">&quot;Rise&quot;</span><span class="p">,</span> <span class="s2">&quot;Shift&quot;</span><span class="p">,</span> <span class="s2">&quot;Slide&quot;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{!s}</span><span class="s2"> ($\AA$)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0!s}</span><span class="s2"> (deg)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">param</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0!s}</span><span class="s2">.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">param</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">sorted_profiles_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an iterator over profiles sorted by frame/order parameter.</span>

<span class="sd">        The iterator produces tuples ``(q, profile)``. Typically, `q` is the</span>
<span class="sd">        frame number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">):</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">[</span><span class="n">q</span><span class="p">])</span>

    <span class="fm">__iter__</span> <span class="o">=</span> <span class="n">sorted_profiles_iter</span>


<div class="viewcode-block" id="X3DNA"><a class="viewcode-back" href="../../../../documentation_pages/analysis/legacy/x3dna.html#MDAnalysis.analysis.legacy.x3dna.X3DNA">[docs]</a><span class="k">class</span> <span class="nc">X3DNA</span><span class="p">(</span><span class="n">BaseX3DNA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run X3DNA_ on a single frame or a DCD trajectory.</span>

<span class="sd">    Only a subset of all X3DNA control parameters is supported and can be set</span>
<span class="sd">    with keyword arguments. For further details on X3DNA_ see the `X3DNA docs`_.</span>

<span class="sd">    Running X3DNA with the :class:`X3DNA` class is a 3-step process:</span>

<span class="sd">     1. set up the class with all desired parameters</span>
<span class="sd">     2. run X3DNA with :meth:`X3DNA.run`</span>
<span class="sd">     3. collect the data from the output file with :meth:`X3DNA.collect`</span>

<span class="sd">    The class also provides some simple plotting functions of the collected</span>
<span class="sd">    data such as :meth:`X3DNA.plot` or :meth:`X3DNA.plot3D`.</span>

<span class="sd">    When methods return helicoidal basepair parameter as lists, then the order</span>
<span class="sd">    is always</span>

<span class="sd">    ====== ==============</span>
<span class="sd">    index  parameter</span>
<span class="sd">    ====== ==============</span>
<span class="sd">     0     shear</span>
<span class="sd">     1     stretch</span>
<span class="sd">     2     stagger</span>
<span class="sd">     3     buckle</span>
<span class="sd">     4     propeller</span>
<span class="sd">     5     opening</span>
<span class="sd">     6     shift</span>
<span class="sd">     7     slide</span>
<span class="sd">     8     rise</span>
<span class="sd">     9     tilt</span>
<span class="sd">    10     roll</span>
<span class="sd">    11     twist</span>
<span class="sd">    ====== ==============</span>

<span class="sd">    .. versionadded:: 0.8</span>

<span class="sd">    .. _`X3DNA docs`: http://forum.x3dna.org/</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up parameters to run X3DNA_ on PDB *filename*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">               The `filename` is used as input for X3DNA in the</span>
<span class="sd">               :program:`xdna_ensemble` command.  It specifies the name of a</span>
<span class="sd">               PDB coordinate file to be used. This must be in Brookhaven</span>
<span class="sd">               protein databank format or something closely approximating</span>
<span class="sd">               this.</span>
<span class="sd">        executable : str (optional)</span>
<span class="sd">               Path to the :program:`xdna_ensemble` executable directories</span>
<span class="sd">               (e.g. ``/opt/x3dna/2.1 and /opt/x3dna/2.1/bin``) must be set</span>
<span class="sd">               and then added to export in bashrc file. See X3DNA</span>
<span class="sd">               documentation for set-up instructions.</span>
<span class="sd">        x3dna_param : bool (optional)</span>
<span class="sd">               Determines whether base step or base pair parameters will be</span>
<span class="sd">               calculated. If ``True`` (default) then stacked *base step*</span>
<span class="sd">               parameters will be analyzed.  If ``False`` then stacked *base</span>
<span class="sd">               pair* parameters will be analyzed.</span>
<span class="sd">        logfile : str (optional)</span>
<span class="sd">               Write output from X3DNA to `logfile` (default: &quot;bp_step.par&quot;)</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :class:`X3DNAtraj`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># list of temporary files, to be cleaned up on __del__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempfiles</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;auxiliary.par&quot;</span><span class="p">,</span> <span class="s2">&quot;bestpairs.pdb&quot;</span><span class="p">,</span> <span class="s2">&quot;bp_order.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;bp_helical.par&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_7methods.par&quot;</span><span class="p">,</span>
            <span class="s2">&quot;col_chains.scr&quot;</span><span class="p">,</span> <span class="s2">&quot;col_helices.scr&quot;</span><span class="p">,</span> <span class="s2">&quot;hel_regions.pdb&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_frames.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;hstacking.pdb&quot;</span><span class="p">,</span> <span class="s2">&quot;stacking.pdb&quot;</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempdirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting up X3DNA analysis for </span><span class="si">%(filename)r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="c1"># guess executables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exe</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">x3dna_exe_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;executable&#39;</span><span class="p">,</span> <span class="s1">&#39;xdna_ensemble&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x3dna_param</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;x3dna_param&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s1">&#39;xdna_ensemble&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="n">x3dna_exe_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s1">&#39;xdna_ensemble&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;X3DNA binary </span><span class="si">{x3dna_exe_name!r}</span><span class="s2"> not found.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">vars</span><span class="p">())</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%(x3dna_exe_name)r</span><span class="s2"> must be on the PATH or provided as keyword argument &#39;executable&#39;.&quot;</span><span class="p">,</span>
                         <span class="nb">vars</span><span class="p">())</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">,</span> <span class="n">errmsg</span><span class="p">)</span>
        <span class="n">x3dnapath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s1">&#39;xdna_ensemble&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;logfile&quot;</span><span class="p">,</span> <span class="s2">&quot;bp_step.par&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x3dna_param</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;x3dna_ensemble analyze -b 355d.bps --one </span><span class="si">%(filename)r</span><span class="s2"> &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;find_pair -s </span><span class="si">%(filename)r</span><span class="s2"> stdout |analyze stdin &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># sanity checks</span>
        <span class="k">for</span> <span class="n">program</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">which</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Executable </span><span class="si">%(program)r</span><span class="s2"> not found, should have been </span><span class="si">%(path)r</span><span class="s2">.&quot;</span><span class="p">,</span>
                             <span class="nb">vars</span><span class="p">())</span>
        <span class="c1"># results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

<div class="viewcode-block" id="X3DNA.run"><a class="viewcode-back" href="../../../../documentation_pages/analysis/legacy/x3dna.html#MDAnalysis.analysis.legacy.x3dna.X3DNA.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run X3DNA on the input file.&quot;&quot;&quot;</span>
        <span class="n">inpname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inpfile&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">outname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;outfile&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>

        <span class="n">x3dnaargs</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">x3dnaargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">x3dna_param</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;x3dna_param&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x3dna_param</span><span class="p">)</span>

        <span class="n">inp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">%</span> <span class="n">x3dnaargs</span>
        <span class="k">if</span> <span class="n">inpname</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">inpname</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Wrote X3DNA input file </span><span class="si">%r</span><span class="s2"> for inspection&quot;</span><span class="p">,</span> <span class="n">inpname</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting X3DNA on </span><span class="si">%(filename)r</span><span class="s2"> (trajectory: </span><span class="si">%(dcd)r</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">x3dnaargs</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s1">&#39;xdna_ensemble&#39;</span><span class="p">])</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outname</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">x3dna</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="n">inp</span><span class="p">],</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outname</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="c1"># X3DNA is not very good at setting returncodes so check ourselves</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;*** ERROR ***&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)):</span>
                    <span class="n">x3dna</span><span class="o">.</span><span class="n">returncode</span> <span class="o">=</span> <span class="mi">255</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="n">x3dna</span><span class="o">.</span><span class="n">bit_length</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;X3DNA Failure (</span><span class="si">%d</span><span class="s2">). Check output </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">x3dna</span><span class="o">.</span><span class="n">bit_length</span><span class="p">,</span> <span class="n">outname</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;X3DNA finished: output file </span><span class="si">%(outname)r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">())</span></div>

<div class="viewcode-block" id="X3DNA.collect"><a class="viewcode-back" href="../../../../documentation_pages/analysis/legacy/x3dna.html#MDAnalysis.analysis.legacy.x3dna.X3DNA.collect">[docs]</a>    <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the output from a X3DNA run into numpy recarrays.</span>

<span class="sd">        Can deal with outputs containing multiple frames.</span>

<span class="sd">        The method saves the result as :attr:`X3DNA.profiles`, a dictionary</span>
<span class="sd">        indexed by the frame number. Each entry is a</span>
<span class="sd">        :class:`np.recarray`.</span>

<span class="sd">        If the keyword `outdir` is supplied (e.g. &quot;.&quot;) then each profile is</span>
<span class="sd">        saved to a gzipped data file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        run : str, int (optional</span>
<span class="sd">              identifier, free form [1]</span>
<span class="sd">        outdir : str (optional)</span>
<span class="sd">              save output data under `outdir`/`run` if set to any other</span>
<span class="sd">              value but ``None`` [``None``]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#        Shear    Stretch   Stagger   Buckle   Prop-Tw   Opening     Shift     Slide     Rise      Tilt        Roll      Twist</span>
        <span class="c1">#0123456789.0123456789.0123456789.0123456789.0123456789.0123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789.</span>
        <span class="c1">#            11          22          33          44</span>
        <span class="c1">#T-A     -0.033    -0.176     0.158   -12.177    -8.979     1.440     0.000     0.000     0.000     0.000     0.000     0.000</span>
        <span class="c1">#C-G     -0.529     0.122    -0.002    -7.983   -10.083    -0.091    -0.911     1.375     3.213    -0.766    -4.065    41.492</span>
        <span class="c1"># only parse bp_step.par</span>
        <span class="n">x3dna_output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;x3dnaout&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>

        <span class="n">run</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># id number</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;outdir&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Collecting X3DNA profiles for run with id </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># length of trajectory --- is this really needed?? No... just for info</span>
        <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">glob</span>

            <span class="n">filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Glob pattern </span><span class="si">%r</span><span class="s2"> did not find any files.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Glob pattern </span><span class="si">{0!r}</span><span class="s2"> did not find any files.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">%d</span><span class="s2"> input files based on glob pattern </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># one recarray for each frame, indexed by frame number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Run </span><span class="si">%s</span><span class="s2">: Reading </span><span class="si">%d</span><span class="s2"> X3DNA profiles from </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">x3dna_output</span><span class="p">)</span>
        <span class="n">x3dna_profile_no</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">x3dna_output</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">x3dna</span><span class="p">:</span>
            <span class="n">read_data</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">x3dna</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>  <span class="c1"># preserve columns (FORTRAN output...)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x3dna_param</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#        Shear&quot;</span><span class="p">):</span>
                        <span class="n">read_data</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Started reading data&quot;</span><span class="p">)</span>
                        <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">x3dna_profile_no</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># useless int value code based off hole plugin</span>
                        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">read_data</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">Sequence</span><span class="p">,</span> <span class="n">Shear</span><span class="p">,</span> <span class="n">Stretch</span><span class="p">,</span> <span class="n">Stagger</span><span class="p">,</span> <span class="n">Buckle</span><span class="p">,</span> <span class="n">Propeller</span><span class="p">,</span> <span class="n">Opening</span><span class="p">,</span> <span class="n">Shift</span><span class="p">,</span> <span class="n">Slide</span><span class="p">,</span> <span class="n">Rise</span><span class="p">,</span> \
                                    <span class="n">Tilt</span><span class="p">,</span> <span class="n">Roll</span><span class="p">,</span> <span class="n">Twist</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Run </span><span class="si">%d</span><span class="s2">: Problem parsing line </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Check input file </span><span class="si">%r</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">x3dna_output</span><span class="p">)</span>
                                <span class="k">raise</span>
                            <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">Shear</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Stretch</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Stagger</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Buckle</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Propeller</span><span class="p">),</span>
                                    <span class="nb">float</span><span class="p">(</span><span class="n">Opening</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Shift</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Slide</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Rise</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Tilt</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Roll</span><span class="p">),</span>
                                    <span class="nb">float</span><span class="p">(</span><span class="n">Twist</span><span class="p">)])</span>
                            <span class="k">continue</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># end of records (empty line)</span>
                            <span class="n">read_data</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#      Shift&quot;</span><span class="p">):</span>
                        <span class="n">read_data</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Started reading data&quot;</span><span class="p">)</span>
                        <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">x3dna_profile_no</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># useless int value code based off hole plugin</span>
                        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">read_data</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">Sequence</span><span class="p">,</span> <span class="n">Shift</span><span class="p">,</span> <span class="n">Slide</span><span class="p">,</span> <span class="n">Rise</span><span class="p">,</span> <span class="n">Tilt</span><span class="p">,</span> <span class="n">Roll</span><span class="p">,</span> <span class="n">Twist</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Run </span><span class="si">%d</span><span class="s2">: Problem parsing line </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Check input file </span><span class="si">%r</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">x3dna_output</span><span class="p">)</span>
                                <span class="k">raise</span>
                            <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">Shift</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Slide</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Rise</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Tilt</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Roll</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Twist</span><span class="p">)])</span>
                            <span class="k">continue</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># end of records (empty line)</span>
                            <span class="n">read_data</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x3dna_param</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">frame_x3dna_output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">fromrecords</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="s2">&quot;f8,f8,f8,f8,f8,f8,f8,f8,f8,f8,f8,f8&quot;</span><span class="p">,</span>
                                                           <span class="n">names</span><span class="o">=</span><span class="s2">&quot;Shear,Stretch,Stagger,Buckle,Propeller,Opening,&quot;</span>
                                                                 <span class="s2">&quot;Shift,Slide,Rise,Tilt,Roll,Twist&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">frame_x3dna_output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">fromrecords</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="s2">&quot;f8,f8,f8,f8,f8,f8&quot;</span><span class="p">,</span>
                                                           <span class="n">names</span><span class="o">=</span><span class="s2">&quot;Shift,Slide,Rise,Tilt,Roll,Twist&quot;</span><span class="p">)</span>
            <span class="c1"># store the profile</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">[</span><span class="n">x3dna_profile_no</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame_x3dna_output</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Collected X3DNA profile for frame </span><span class="si">%d</span><span class="s2"> (</span><span class="si">%d</span><span class="s2"> datapoints)&quot;</span><span class="p">,</span>
                         <span class="n">x3dna_profile_no</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_x3dna_output</span><span class="p">))</span>
            <span class="c1"># save a profile for each frame (for debugging and scripted processing)</span>
            <span class="c1"># a tmp folder for each trajectory</span>
            <span class="k">if</span> <span class="n">outdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rundir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="s2">&quot;run_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">run</span><span class="p">))</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;rm -f tmp*.out&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">rundir</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">rundir</span><span class="p">)</span>
                <span class="n">frame_x3dna_txt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rundir</span><span class="p">,</span> <span class="s2">&quot;bp_step_</span><span class="si">{0!s}</span><span class="s2">_</span><span class="si">{1:04d}</span><span class="s2">.dat.gz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="n">x3dna_profile_no</span><span class="p">))</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">frame_x3dna_txt</span><span class="p">,</span> <span class="n">frame_x3dna_output</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Finished with frame </span><span class="si">%d</span><span class="s2">, saved as </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">x3dna_profile_no</span><span class="p">,</span> <span class="n">frame_x3dna_txt</span><span class="p">)</span>
                <span class="c1"># if we get here then we haven&#39;t found anything interesting</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">)</span> <span class="o">==</span> <span class="n">length</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Collected X3DNA profiles for </span><span class="si">%d</span><span class="s2"> frames&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Missing data: Found </span><span class="si">%d</span><span class="s2"> X3DNA profiles from </span><span class="si">%d</span><span class="s2"> frames.&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">),</span> <span class="n">length</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tempfiles</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tempdirs</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="X3DNAtraj"><a class="viewcode-back" href="../../../../documentation_pages/analysis/legacy/x3dna.html#MDAnalysis.analysis.legacy.x3dna.X3DNAtraj">[docs]</a><span class="k">class</span> <span class="nc">X3DNAtraj</span><span class="p">(</span><span class="n">BaseX3DNA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze all frames in a trajectory.</span>

<span class="sd">    The :class:`X3DNA` class provides a direct interface to X3DNA. X3DNA itself</span>
<span class="sd">    has limited support for analysing trajectories but cannot deal with all the</span>
<span class="sd">    trajectory formats understood by MDAnalysis. This class can take any</span>
<span class="sd">    universe and feed it to X3DNA. By default it sequentially creates a PDB for</span>
<span class="sd">    each frame and runs X3DNA on the frame.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">universe</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up the class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        universe : Universe</span>
<span class="sd">               The input trajectory as part of a</span>
<span class="sd">               :class:`~MDAnalysis.core.universe.Universe`; the trajectory is</span>
<span class="sd">               converted to a sequence of PDB files and X3DNA is run on each</span>
<span class="sd">               individual file. (Use the `start`, `stop`, and `step` keywords</span>
<span class="sd">               to slice the trajectory.)</span>
<span class="sd">        selection : str (optional)</span>
<span class="sd">               MDAnalysis selection string (default: &quot;nucleic&quot;) to select the</span>
<span class="sd">               atoms that should be analyzed.</span>
<span class="sd">        start : int (optional)</span>
<span class="sd">        stop : int (optional)</span>
<span class="sd">        step : int (optional)</span>
<span class="sd">               frame indices to slice the trajectory as</span>
<span class="sd">               ``universe.trajectory[start, stop, step]``; by default, the whole</span>
<span class="sd">               trajectory is analyzed.</span>
<span class="sd">        x3dna_param : bool (optional)</span>
<span class="sd">               indicates whether stacked bases or stacked base-pairs will be</span>
<span class="sd">               analyzed. ``True`` is bases and ``False`` is stacked base-pairs</span>
<span class="sd">               [Default is ``True``].</span>
<span class="sd">        kwargs : keyword arguments (optional)</span>
<span class="sd">               All other keywords are passed on to :class:`X3DNA` (see there</span>
<span class="sd">               for description).</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :class:`X3DNA`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">universe</span> <span class="o">=</span> <span class="n">universe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;selection&quot;</span><span class="p">,</span> <span class="s2">&quot;nucleic&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x3dna_param</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;x3dna_param&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x3dna_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="c1"># processing</span>

<div class="viewcode-block" id="X3DNAtraj.run"><a class="viewcode-back" href="../../../../documentation_pages/analysis/legacy/x3dna.html#MDAnalysis.analysis.legacy.x3dna.X3DNAtraj.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run X3DNA on the whole trajectory and collect profiles.</span>

<span class="sd">        Keyword arguments `start`, `stop`, and `step` can be used to only</span>
<span class="sd">        analyse part of the trajectory. The defaults are the values provided to</span>
<span class="sd">        the class constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
        <span class="n">x3dna_param</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;x3dna_param&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x3dna_param</span><span class="p">)</span>
        <span class="n">x3dna_kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x3dna_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">x3dna_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">profiles</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="n">nucleic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">:</span><span class="n">step</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;X3DNA analysis frame </span><span class="si">%4d</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
            <span class="n">fd</span><span class="p">,</span> <span class="n">pdbfile</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.pdb&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
            <span class="n">nucleic</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;find_pair </span><span class="si">{0!s}</span><span class="s2"> 355d.bps&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">nucleic</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)</span>
                <span class="n">x3dna_profiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_x3dna</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">,</span> <span class="o">**</span><span class="n">x3dna_kw</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x3dna_profiles</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Got </span><span class="si">{0}</span><span class="s2"> profiles (</span><span class="si">{1}</span><span class="s2">) --- should be 1 (time step </span><span class="si">{2}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">x3dna_profiles</span><span class="p">),</span> <span class="n">x3dna_profiles</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">ts</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
            <span class="n">profiles</span><span class="p">[</span><span class="n">ts</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span> <span class="o">=</span> <span class="n">x3dna_profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span> <span class="o">=</span> <span class="n">profiles</span></div>

<div class="viewcode-block" id="X3DNAtraj.run_x3dna"><a class="viewcode-back" href="../../../../documentation_pages/analysis/legacy/x3dna.html#MDAnalysis.analysis.legacy.x3dna.X3DNAtraj.run_x3dna">[docs]</a>    <span class="k">def</span> <span class="nf">run_x3dna</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdbfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run X3DNA on a single PDB file `pdbfile`.&quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x3dna_param&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x3dna_param</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">X3DNA</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">H</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">H</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">H</span><span class="o">.</span><span class="n">profiles</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2005-2023, Naveen Michaud-Agrawal, Elizabeth J. Denning, Christian Beckstein (logo), Joshua L. Adelman, Henok Ademtew, Shobhit Agarwal, Aya M. Alaa, Irfan Alibay, Kazi Shudipto Amin, Anshul Angaria, Luís Pedro Borges Araújo, Balasubramanian, Utkarsh Bansal, Patricio Barletta, Leonardo Barneschi, Jonathan Barnoud, Estefania Barreto-Ojeda, Tone Bengtsen, Alejandro Bernardin, Ninad Bhat, Mateusz Bieniek, Kavya Bisht, Wouter Boomsma, Jose Borreguero, Cédric Bouysset, Kevin Boyd, Meet Brijwani, Bart Bruininks, Sébastien Buchoux, Sören von Bülow, Yantong Cai, David Caplan, Yuanyu Chang, Pratham Chauhan, Matthieu Chavent, Haochuan Chen, Xu Hong Chen, Kathleen Clark, Jennifer A Clark, Orion Cohen, Charlie Cook, Ruggero Cortini, Nicholas Craven, Ramon Crehuet, Davide Cruz, Robert Delgado, John Detlefs, Xavier Deupi, Jan Domanski, David L. Dotson, Mark D. Driver, Ali Ehlen, Daniel J. Evans, Shujie Fan, Bjarne Feddersen, Lennard van der Feltz, Jake Fennick, Philip Fowler, Guillaume Fraux, Anirvinya G, Ahmed Salah Ghoneim, Mikhail Glagolev, William Glass, Joseph Goose, Alexander Gorfer, Richard J. Gowers, Lukas Grossar, Abhinav Gupta, Akshay Gupta, Pratik Gupta, Benjamin Hall, Ameya Harmalkar, Ivan Hristov, Eugen Hruska, Kyle J. Huston, Siddharth Jain, Edis Jakupovic, Joe Jordan, Henrik Jäger, Uma D Kadam, Aditya Kamath, Jon Kapla, Haleema Khan, Navya Khare, Utsav Khatu, Andrew William King, Henry Kobin, Abhishek A. Kognole, Kosuke Kudo, Atharva Kulkarni, Manish Kumar, Mohit Kumar, Shubham Kumar, Alia Lescoulie, Max Linke, Philip Loche, Jinju Lu, Hugo MacDermott-Opeskin, Shaivi Malik, Egor Marin, Domenico Marson, Micaela Matta, Andrew R. McCluskey, Robert McGibbon, Rocco Meli, Manuel Nuno Melo, Marcelo C. R. Melo, Dominik &#39;Rathann&#39; Mierzejewski, Henry Mull, Morgan L. Nance, Fiona B. Naughton, Alex Nesterenko, Hai Nguyen, Sang Young Noh, Meghan Osato, Daniele Padula, Nabarun Pal, Mattia F. Palermo, Dimitrios Papageorgiou, Rafael R. Pappalardo, Vishal Parmar, Danny Parton, Shakul Pathak, Christian Pfaendner, Joshua L. Phillips, Marcelo D. Poleto, Hannah Pollak, Kashish Punjani, Michael Quevillon, Vedant Rathore, Tyler Reddy, Pedro Reis, Paul Rigor, Andrea Rizzi, Xiaoxu Ruan, Carlos Yanez S., Utkarsh Saxena, Moritz Schaeffler, Alexander Schlaich, Marcello Sega, Ricky Sexton, Sean L. Seyler, Faraaz Shah, Sulay Shah, Abhishek Shandilya, Shubham Sharma, Rishabh Shukla, Karthikeyan Singaravelan, Tamandeep Singh, Paul Smith, Andy Somogyi, Caio S. Souza, Shantanu Srivastava, Lukas Stelzl, Jan Stevens, Gorman Stock, Fenil Suchak, Ayush Suhane, Filip T. Szczypiński, Sukeerti T, Matthijs Tadema, Joao Miguel Correia Teixeira, Paarth Thadani, Matthew W. Thompson, Hao Tian, Matteo Tiberti, Zaheer Timol, Wiep van der Toorn, Mieczyslaw Torchala, Aditi Tripathi, Mark Verma, Josh Vermaas, Isaac Virshup, Lily Wang, Nestor Wendt, Zhiyi Wu, Tengyu Xie, Zhuyi Xue, Mingyi Xue, Alexander Yang, Juan Eiros Zamora, Johannes Zeman, Yibo Zhang, Raymond Zhao, Yuxuan Zhuang, and Oliver Beckstein.</p>
  </div>

  
 
<div class="footer"><p>Please see
    our <a href="https://www.mdanalysis.org/pages/privacy/">Privacy Policy</a>
    to learn how <a href="https://www.mdanalysis.org">MDAnalysis</a> collects data.</p>
    <script data-goatcounter="https://mdanalysis.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
</div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
    var versions_json_url = 'https://docs.mdanalysis.org/versions.json'
</script>

<div class="rst-versions" data-toggle="rst-versions" role="note"
     aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"></span>
        2.6.0
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
        <dl id="versionselector">
            <dt>Other Versions</dt>
        </dl>

    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>